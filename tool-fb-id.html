<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Tìm Facebook ID — GenZTech</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <style>
    html,body{scrollbar-width:none;-ms-overflow-style:none;cursor:none;-webkit-user-select:none;user-select:none;margin:0;padding:0;font-family:'Inter',sans-serif;background:#080c1e;color:#fff}
    html::-webkit-scrollbar,body::-webkit-scrollbar{display:none;width:0}
    .app-layout{display:flex;min-height:100vh;position:relative;z-index:1}
    .sidebar{width:240px;flex-shrink:0;background:rgba(10,14,39,.92);backdrop-filter:blur(20px);border-right:1px solid rgba(255,255,255,.06);display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:40}
    .sidebar-logo{padding:18px 18px 14px;border-bottom:1px solid rgba(255,255,255,.06);display:flex;align-items:center;gap:10px;text-decoration:none}
    .sidebar-logo img{width:34px;height:34px;border-radius:50%}
    .sidebar-logo span{font-size:14px;font-weight:700;letter-spacing:.5px;color:#fff}
    .sidebar-logo span em{color:#00d4ff;font-style:normal}
    .sidebar-nav{flex:1;padding:10px 0;overflow-y:auto}
    .nav-group-label{font-size:10px;font-weight:600;letter-spacing:1.2px;color:rgba(255,255,255,.3);text-transform:uppercase;padding:10px 18px 4px}
    .nav-item{display:flex;align-items:center;gap:10px;padding:9px 18px;font-size:13px;color:rgba(255,255,255,.6);text-decoration:none;transition:all .2s;border-left:2px solid transparent}
    .nav-item:hover{color:#fff;background:rgba(255,255,255,.04)}
    .nav-item.active{color:#00d4ff;background:rgba(0,212,255,.08);border-left-color:#00d4ff}
    .nav-item i{width:17px;text-align:center;font-size:14px}
    .nav-sub-item{display:flex;align-items:center;gap:10px;padding:7px 18px 7px 34px;font-size:12px;color:rgba(255,255,255,.5);text-decoration:none;transition:all .2s;border-left:2px solid transparent}
    .nav-sub-item:hover{color:#fff;background:rgba(255,255,255,.04)}
    .nav-sub-item.active{color:#00d4ff;background:rgba(0,212,255,.06);border-left-color:#00d4ff}
    .sidebar-footer{padding:14px 18px;border-top:1px solid rgba(255,255,255,.06)}
    .main-content{margin-left:240px;flex:1;display:flex;flex-direction:column;min-height:100vh}
    .topbar{position:sticky;top:0;z-index:30;background:rgba(10,14,39,.9);backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,.06);padding:0 24px;height:58px;display:flex;align-items:center;justify-content:space-between}
    .breadcrumb{font-size:12.5px;color:rgba(255,255,255,.4);display:flex;align-items:center;gap:6px}
    .breadcrumb span{color:#fff;font-weight:600}
    .btn{padding:7px 14px;border-radius:8px;font-size:12.5px;font-weight:600;border:none;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:6px;font-family:'Inter',sans-serif}
    .btn-primary{background:#1877f2;color:#fff}.btn-primary:hover{background:#1565d8}
    .btn-outline{background:transparent;color:rgba(255,255,255,.7);border:1px solid rgba(255,255,255,.15)}.btn-outline:hover{border-color:#00d4ff;color:#00d4ff}
    .btn-sm{padding:5px 12px;font-size:12px}
    .btn-icon{padding:6px 10px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);color:rgba(255,255,255,.6);border-radius:8px;cursor:pointer;font-size:13px;display:inline-flex;align-items:center;gap:5px;transition:all .2s;font-family:'Inter',sans-serif}.btn-icon:hover{background:rgba(255,255,255,.1);color:#fff}
    .page-body{padding:20px 24px;flex:1}
    .card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:12px;overflow:hidden;margin-bottom:16px}
    .card-header{padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.06);display:flex;align-items:center;justify-content:space-between}
    .card-title{font-size:13.5px;font-weight:700;display:flex;align-items:center;gap:8px}
    .card-body{padding:18px}
    .form-group{margin-bottom:14px}
    .form-label{font-size:11.5px;font-weight:600;color:rgba(255,255,255,.5);margin-bottom:6px;display:block;text-transform:uppercase;letter-spacing:.5px}
    .form-control{width:100%;background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.1);border-radius:8px;padding:9px 13px;color:#fff;font-size:13px;transition:border-color .2s;box-sizing:border-box;font-family:'Inter',sans-serif}
    .form-control:focus{outline:none;border-color:#38bdf8;box-shadow:0 0 0 3px rgba(56,189,248,.08)}
    .form-control::placeholder{color:rgba(255,255,255,.25)}
    textarea.form-control{resize:vertical;min-height:120px;line-height:1.6}
    .tab-bar{display:flex;gap:3px;padding:4px;background:rgba(0,0,0,.25);border-radius:10px;margin-bottom:18px}
    .tab-btn{flex:1;padding:8px 10px;border:none;border-radius:7px;background:transparent;color:rgba(255,255,255,.45);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:5px;font-family:'Inter',sans-serif}
    .tab-btn.active{background:rgba(56,189,248,.15);color:#38bdf8;box-shadow:0 0 0 1px rgba(56,189,248,.2)}
    .tab-pane{display:none}
    .tab-pane.active{display:block}
    /* Result */
    .result-box{background:rgba(56,189,248,.04);border:1px solid rgba(56,189,248,.2);border-radius:12px;padding:22px;text-align:center;margin-bottom:14px}
    .result-id-big{font-size:34px;font-weight:800;color:#38bdf8;letter-spacing:2px;font-family:monospace;margin-bottom:4px;word-break:break-all;line-height:1.2}
    .result-name{font-size:14px;font-weight:600;color:#fff;margin-bottom:12px}
    .result-meta{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-bottom:16px}
    .meta-chip{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:4px 12px;font-size:11.5px;color:rgba(255,255,255,.7);display:flex;align-items:center;gap:5px}
    .meta-chip i{color:#38bdf8;font-size:12px}
    .copy-actions{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
    .copy-btn{padding:9px 18px;border-radius:8px;font-size:12.5px;font-weight:600;border:none;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:6px;font-family:'Inter',sans-serif}
    .copy-btn-primary{background:linear-gradient(135deg,#1877f2,#38bdf8);color:#fff}
    .copy-btn-primary:hover{opacity:.9;transform:translateY(-1px)}
    .copy-btn-outline{background:rgba(255,255,255,.06);color:rgba(255,255,255,.7);border:1px solid rgba(255,255,255,.12)}
    .copy-btn-outline:hover{border-color:#38bdf8;color:#38bdf8}
    /* Bulk */
    .bulk-row{display:grid;grid-template-columns:1fr 160px 120px 40px;gap:8px;align-items:center;background:rgba(0,0,0,.2);border:1px solid rgba(255,255,255,.06);border-radius:8px;padding:10px 14px;margin-bottom:6px;transition:border-color .2s}
    .bulk-input{font-size:12px;color:rgba(255,255,255,.55);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .bulk-id{font-size:13px;font-weight:700;color:#38bdf8;font-family:monospace}
    .bulk-name{font-size:12px;color:rgba(255,255,255,.5);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    /* History */
    .history-item{background:rgba(0,0,0,.2);border:1px solid rgba(255,255,255,.06);border-radius:8px;padding:10px 14px;margin-bottom:6px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;transition:all .15s}
    .history-item:hover{border-color:rgba(56,189,248,.3);background:rgba(56,189,248,.04)}
    /* Spinner */
    .spinner{display:inline-block;width:14px;height:14px;border:2px solid rgba(255,255,255,.15);border-top-color:#38bdf8;border-radius:50%;animation:spin .6s linear infinite;flex-shrink:0}
    @keyframes spin{to{transform:rotate(360deg)}}
    /* Toast */
    #toast{position:fixed;bottom:24px;right:24px;z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none}
    .toast-item{background:rgba(15,23,42,.95);border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:11px 16px;font-size:13px;display:flex;align-items:center;gap:10px;min-width:240px;animation:slideIn .3s ease;box-shadow:0 8px 24px rgba(0,0,0,.5);pointer-events:auto}
    .toast-item.success{border-left:3px solid #22c55e}
    .toast-item.error{border-left:3px solid #ef4444}
    .toast-item.info{border-left:3px solid #38bdf8}
    @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:18px}
    @media(max-width:960px){.grid-2{grid-template-columns:1fr}}
    @media(max-width:768px){.sidebar{display:none}.main-content{margin-left:0}}
    .example-chip{font-size:11px;padding:3px 10px;background:rgba(56,189,248,.08);border:1px solid rgba(56,189,248,.15);border-radius:6px;cursor:pointer;color:#7dd3fc;transition:all .15s;display:inline-block}
    .example-chip:hover{background:rgba(56,189,248,.15);border-color:rgba(56,189,248,.3)}
    .empty-state{text-align:center;padding:36px 20px;color:rgba(255,255,255,.3)}
    .empty-state i{font-size:36px;display:block;margin-bottom:10px;opacity:.5}
    /* Search bar lớn - kiểu findmyfbid */
    .search-hero{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:20px;margin-bottom:18px}
    .search-input-wrap{display:flex;gap:10px;align-items:center}
    .search-input-big{flex:1;background:rgba(0,0,0,.35);border:1.5px solid rgba(255,255,255,.12);border-radius:10px;padding:13px 16px;color:#fff;font-size:14px;font-family:'Inter',sans-serif;transition:border-color .2s;outline:none}
    .search-input-big:focus{border-color:#38bdf8;box-shadow:0 0 0 3px rgba(56,189,248,.1)}
    .search-input-big::placeholder{color:rgba(255,255,255,.25)}
    .search-btn-big{padding:13px 22px;background:linear-gradient(135deg,#1877f2,#38bdf8);color:#fff;border:none;border-radius:10px;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:8px;white-space:nowrap;font-family:'Inter',sans-serif;transition:all .2s}
    .search-btn-big:hover{opacity:.9;transform:translateY(-1px)}
    .search-btn-big:disabled{opacity:.6;cursor:not-allowed;transform:none}
  
    /* -- Universe Background -- */
    canvas.bg-canvas{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0}
    #custom-cursor{position:fixed;width:20px;height:20px;border-radius:50%;border:2px solid rgba(0,212,255,.8);pointer-events:none;z-index:9999;transform:translate(-50%,-50%);transition:opacity .3s;opacity:0;mix-blend-mode:screen}
    .nebula-overlay{position:fixed;inset:0;pointer-events:none;z-index:0;background:radial-gradient(ellipse 80% 60% at 20% 30%,rgba(24,119,242,.07) 0%,transparent 60%),radial-gradient(ellipse 60% 50% at 80% 70%,rgba(0,212,255,.06) 0%,transparent 55%),radial-gradient(ellipse 50% 40% at 50% 10%,rgba(139,92,246,.05) 0%,transparent 50%)}
  </style>
</head>
<body>
  <!-- Universe Background -->
  <canvas class="bg-canvas" id="gz-stars"></canvas>
  <canvas class="bg-canvas" id="gz-particles"></canvas>
  <div class="nebula-overlay"></div>
  <div id="custom-cursor"></div>
<div id="toast"></div>

<div class="app-layout">
  <aside class="sidebar">
      <a href="index.html" class="sidebar-logo">
        <img src="https://ui-avatars.com/api/?name=GZ&background=1877f2&color=fff&bold=true" alt="logo">
        <span>GENZ<em>TECH</em></span>
      </a>
      <nav class="sidebar-nav">
        <div class="nav-group-label">Tổng Quan</div>
        <a href="maindashboard.html" class="nav-item"><i class="bi bi-grid-1x2-fill"></i> Dashboard</a>
        <div class="nav-group-label">Công Cụ</div>
        <a href="auto-post.html" class="nav-item"><i class="bi bi-send"></i> Tự Động Đăng Bài</a>
        <a href="ads-assistant.html" class="nav-item" onclick="toggleSubNav(event,'subNavAds')">
          <i class="bi bi-megaphone"></i> Trợ Lý Quảng Cáo
          <i class="bi bi-chevron-down" id="subNavAdsArrow" style="margin-left:auto;font-size:11px;transition:transform .2s"></i>
        </a>
        <div id="subNavAds" style="display:flex;flex-direction:column">
          <a href="tool-ad-account.html" class="nav-sub-item"><i class="bi bi-shield-check"></i> Kiểm Tra TKQC</a>
          <a href="tool-fb-id.html" class="nav-sub-item active"><i class="bi bi-person-badge"></i> Tìm Facebook ID</a>
          <a href="tool-budget.html" class="nav-sub-item"><i class="bi bi-graph-up-arrow"></i> Phân Tích Ngân Sách</a>
          <a href="tool-translate.html" class="nav-sub-item"><i class="bi bi-translate"></i> Dịch Thuật</a>
          <a href="tool-ads-finder.html" class="nav-sub-item"><i class="bi bi-binoculars"></i> Ads Finder</a>
          <a href="tool-policy.html" class="nav-sub-item"><i class="bi bi-journal-text"></i> Chính Sách FB</a>
          <a href="tool-cookie.html" class="nav-sub-item"><i class="bi bi-cookie"></i> Quản Lý Cookie</a>
        </div>
        <a href="#" class="nav-item" onclick="openSettings()"><i class="bi bi-gear"></i> Cài Đặt</a>
      </nav>
      <div class="sidebar-footer">
      <div id="gtUserSidebar" style="display:none"></div>
        <div class="conn-status" id="connStatus">
          <div class="conn-dot" id="connDot"></div>
          <span id="connText">Chưa kết nối</span>
        </div>
      </div>
    </aside>

  <div class="main-content">
    <div class="topbar">
      <div class="breadcrumb">
        <a href="ads-assistant.html" style="color:rgba(255,255,255,.4);text-decoration:none">Trợ Lý QC</a>
        <i class="bi bi-chevron-right" style="font-size:10px"></i>
        <span>Tìm Facebook ID</span>
      </div>
      <div style="display:flex;align-items:center;gap:8px">
        <div id="userBadge" style="display:none;align-items:center;gap:8px;font-size:12.5px"></div>
        <button class="btn-icon" onclick="exportHistory()" title="Xuất lịch sử CSV"><i class="bi bi-download"></i></button>
        <button class="btn-icon" onclick="clearHistory()" title="Xóa lịch sử"><i class="bi bi-trash"></i></button>
      </div>
    </div>

    <div class="page-body">

      <!-- Tabs -->
      <div class="tab-bar">
        <button class="tab-btn active" id="tabSingle" onclick="switchTab('single')"><i class="bi bi-person"></i> Tra Cứu Đơn Lẻ</button>
        <button class="tab-btn" id="tabBulk" onclick="switchTab('bulk')"><i class="bi bi-people"></i> Tra Cứu Hàng Loạt</button>
        <button class="tab-btn" id="tabHistory" onclick="switchTab('history')">
          <i class="bi bi-clock-history"></i> Lịch Sử
          <span id="historyCount" style="background:rgba(56,189,248,.2);color:#38bdf8;font-size:10px;padding:1px 7px;border-radius:20px;margin-left:2px">0</span>
        </button>
      </div>

      <!-- -- Tab: Single -- -->
      <div id="paneSingle" class="tab-pane active">

        <!-- Search hero -->
        <div class="search-hero">
          <div style="font-size:11px;color:rgba(255,255,255,.35);text-transform:uppercase;letter-spacing:.8px;margin-bottom:10px">
            <i class="bi bi-person-badge" style="color:#38bdf8"></i> Nhập link hoặc username Facebook
          </div>
          <div class="search-input-wrap">
            <input type="text" class="search-input-big" id="fbInput"
              placeholder="https://facebook.com/username hoặc username..."
              onkeydown="if(event.key==='Enter')doFind()" autocomplete="off" spellcheck="false">
            <button class="search-btn-big" onclick="doFind()" id="findBtn">
              <i class="bi bi-search"></i> Tìm ID
            </button>
          </div>
          <div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:10px">
            <span style="font-size:11px;color:rgba(255,255,255,.3)">Ví dụ:</span>
            <span class="example-chip" onclick="setExample('https://facebook.com/zuck')">facebook.com/zuck</span>
            <span class="example-chip" onclick="setExample('https://www.facebook.com/profile.php?id=4')">profile.php?id=4</span>
            <span class="example-chip" onclick="setExample('https://www.facebook.com/groups/123456789')">groups/ID</span>
            <span class="example-chip" onclick="setExample('https://www.facebook.com/pages/PageName/123456789')">pages/Name/ID</span>
          </div>
        </div>

        <div class="grid-2">
          <!-- Result / Loading / Empty -->
          <div>
            <div id="loadingCard" style="display:none">
              <div class="card">
                <div class="card-body" style="display:flex;align-items:center;gap:12px;color:rgba(255,255,255,.4);font-size:13px;padding:28px">
                  <span class="spinner"></span> Đang tra cứu Facebook ID...
                </div>
              </div>
            </div>

            <div id="resultCard" style="display:none">
              <div class="card">
                <div class="card-header">
                  <div class="card-title"><i class="bi bi-check-circle-fill" style="color:#4ade80"></i> Kết Quả</div>
                  <button class="btn btn-outline btn-sm" onclick="openProfile()"><i class="bi bi-box-arrow-up-right"></i> Mở trang</button>
                </div>
                <div class="card-body">
                  <div class="result-box">
                    <div style="font-size:10px;color:rgba(255,255,255,.35);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Facebook ID</div>
                    <div class="result-id-big" id="resultId">—</div>
                    <div class="result-name" id="resultName"></div>
                    <div class="result-meta" id="resultMeta"></div>
                    <div class="copy-actions">
                      <button class="copy-btn copy-btn-primary" onclick="copyId()">
                        <i class="bi bi-clipboard"></i> Copy ID
                      </button>
                      <button class="copy-btn copy-btn-outline" onclick="copyLink()">
                        <i class="bi bi-link-45deg"></i> Copy Link
                      </button>
                    </div>
                  </div>
                  <div id="resultExtra" style="font-size:12px;color:rgba(255,255,255,.4);background:rgba(0,0,0,.2);border-radius:8px;padding:10px 12px;line-height:1.7"></div>
                </div>
              </div>
            </div>

            <div id="emptyCard">
              <div class="card">
                <div class="card-body">
                  <div class="empty-state">
                    <i class="bi bi-person-badge"></i>
                    <div style="font-size:13px">Nhập link Facebook phía trên và nhấn <strong style="color:#38bdf8">Tìm ID</strong></div>
                    <div style="font-size:11.5px;margin-top:6px;color:rgba(255,255,255,.25)">Không cần đăng nhập · Không cần Access Token</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Info panel -->
          <div>
            <div class="card">
              <div class="card-header">
                <div class="card-title"><i class="bi bi-info-circle" style="color:#a78bfa"></i> Cách hoạt động</div>
              </div>
              <div class="card-body" style="font-size:12.5px;color:rgba(255,255,255,.5);line-height:1.9">
                <div style="margin-bottom:10px">
                  <i class="bi bi-1-circle-fill" style="color:#38bdf8"></i>
                  <strong style="color:rgba(255,255,255,.75)"> URL có ID số sẵn</strong><br>
                  <span style="padding-left:20px;display:block">Trích xuất trực tiếp từ URL — nhanh nhất, không cần gọi API</span>
                </div>
                <div style="margin-bottom:10px">
                  <i class="bi bi-2-circle-fill" style="color:#38bdf8"></i>
                  <strong style="color:rgba(255,255,255,.75)"> URL dùng username</strong><br>
                  <span style="padding-left:20px;display:block">Backend tự động scrape HTML trang Facebook để tìm ID ẩn trong source code</span>
                </div>
                <div>
                  <i class="bi bi-3-circle-fill" style="color:#38bdf8"></i>
                  <strong style="color:rgba(255,255,255,.75)"> Hỗ trợ</strong><br>
                  <span style="padding-left:20px;display:block">Profile cá nhân · Page · Group · App</span>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div class="card-title"><i class="bi bi-clock-history" style="color:#38bdf8"></i> Tra cứu gần đây</div>
              </div>
              <div class="card-body" id="recentList" style="padding:12px">
                <div style="text-align:center;color:rgba(255,255,255,.25);font-size:12px;padding:16px 0">Chưa có tra cứu nào</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- -- Tab: Bulk -- -->
      <div id="paneBulk" class="tab-pane">
        <div class="card">
          <div class="card-header">
            <div class="card-title"><i class="bi bi-people" style="color:#38bdf8"></i> Tra Cứu Hàng Loạt</div>
            <div style="display:flex;gap:8px">
              <button class="btn btn-outline btn-sm" onclick="exportBulkCSV()"><i class="bi bi-download"></i> Xuất CSV</button>
              <button class="btn btn-primary btn-sm" onclick="doBulkFind()" id="bulkBtn"><i class="bi bi-search"></i> Tra Cứu Tất Cả</button>
            </div>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label class="form-label">Danh sách link/username <span style="color:rgba(255,255,255,.3);text-transform:none;letter-spacing:0;font-weight:400">(mỗi dòng một link, tối đa 50)</span></label>
              <textarea class="form-control" id="bulkInput"
                placeholder="https://facebook.com/page1&#10;https://facebook.com/page2&#10;username3&#10;..."
                style="min-height:130px;font-size:12px;font-family:monospace"></textarea>
            </div>
            <div style="font-size:12px;color:rgba(255,255,255,.3);display:flex;align-items:center;gap:6px">
              <i class="bi bi-shield-check" style="color:#4ade80"></i>
              Không cần Access Token · Backend tự động xử lý
            </div>
          </div>
        </div>
        <div id="bulkResults"></div>
      </div>

      <!-- -- Tab: History -- -->
      <div id="paneHistory" class="tab-pane">
        <div class="card">
          <div class="card-header">
            <div class="card-title"><i class="bi bi-clock-history" style="color:#38bdf8"></i> Lịch Sử Tra Cứu</div>
            <div style="display:flex;gap:8px">
              <button class="btn btn-outline btn-sm" onclick="exportHistory()"><i class="bi bi-download"></i> Xuất CSV</button>
              <button class="btn btn-outline btn-sm" onclick="clearHistory()" style="color:#f87171;border-color:rgba(248,113,113,.2)"><i class="bi bi-trash"></i> Xóa tất cả</button>
            </div>
          </div>
          <div class="card-body" id="historyList">
            <div class="empty-state"><i class="bi bi-clock-history"></i>Chưa có lịch sử tra cứu</div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
const API_BASE = 'https://genztech-production.up.railway.app';
let _history = JSON.parse(localStorage.getItem('genz_fbid_history') || '[]');
let _lastResult = null;

// -- Core lookup — gọi backend scrape-id --
async function lookupId(input) {
  if (!input) throw new Error('Link không hợp lệ');
  const r = await fetch(`${API_BASE}/api/facebook/scrape-id?url=${encodeURIComponent(input.trim())}`);
  const d = await r.json();
  if (!r.ok) throw new Error(d.error || 'Lỗi server');
  return {
    id: d.id,
    name: d.name || extractUsername(input),
    type: typeLabel(d.type),
    source: d.source,
    link: d.url || `https://facebook.com/${d.id}`
  };
}

function extractUsername(link) {
  try {
    const u = new URL(link.startsWith('http') ? link : 'https://facebook.com/' + link);
    const parts = u.pathname.split('/').filter(Boolean);
    return parts[parts.length - 1] || link;
  } catch { return link; }
}

function typeLabel(t) {
  if (t === 'page') return 'Page';
  if (t === 'group') return 'Group';
  return 'Profile / Tài khoản';
}

// -- UI: Single --
function setExample(val) {
  document.getElementById('fbInput').value = val;
  document.getElementById('fbInput').focus();
}

async function doFind() {
  const input = document.getElementById('fbInput').value.trim();
  if (!input) { toast('Vui lòng nhập link hoặc username', 'error'); return; }

  const btn = document.getElementById('findBtn');
  btn.innerHTML = '<span class="spinner"></span> Đang tìm...';
  btn.disabled = true;
  document.getElementById('resultCard').style.display = 'none';
  document.getElementById('emptyCard').style.display = 'none';
  document.getElementById('loadingCard').style.display = 'block';

  try {
    const result = await lookupId(input);
    _lastResult = result;
    showResult(result);

    _history.unshift({ input, ...result, time: Date.now() });
    if (_history.length > 200) _history.pop();
    localStorage.setItem('genz_fbid_history', JSON.stringify(_history));
    updateHistoryCount();
    renderRecent();

    toast('Tìm thấy ID!', 'success');
  } catch(e) {
    document.getElementById('emptyCard').style.display = 'block';
    toast('Lỗi: ' + e.message, 'error');
  } finally {
    document.getElementById('loadingCard').style.display = 'none';
    btn.innerHTML = '<i class="bi bi-search"></i> Tìm ID';
    btn.disabled = false;
  }
}

function showResult(r) {
  document.getElementById('resultId').textContent = r.id;
  document.getElementById('resultName').textContent = r.name || '';

  const meta = [];
  if (r.type) meta.push(`<span class="meta-chip"><i class="bi bi-person"></i>${r.type}</span>`);
  if (r.source === 'url_extract') meta.push(`<span class="meta-chip"><i class="bi bi-link-45deg"></i>Trích từ URL</span>`);
  if (r.source === 'html_scrape') meta.push(`<span class="meta-chip"><i class="bi bi-code-slash"></i>Scrape HTML</span>`);
  document.getElementById('resultMeta').innerHTML = meta.join('');

  document.getElementById('resultExtra').innerHTML =
    '<i class="bi bi-graph-up" style="color:#38bdf8"></i> Dùng ID này trong Facebook Ads Manager để nhắm mục tiêu, tạo Custom Audience, hoặc exclude trang/nhóm cụ thể.';

  document.getElementById('resultCard').style.display = 'block';
  document.getElementById('emptyCard').style.display = 'none';
  gsap.fromTo('#resultCard', {opacity:0, y:10}, {opacity:1, y:0, duration:.3, ease:'power2.out'});
}

function copyId() {
  if (!_lastResult) return;
  navigator.clipboard.writeText(_lastResult.id).then(() => toast('Đã copy ID: ' + _lastResult.id, 'success'));
}
function copyLink() {
  if (!_lastResult) return;
  navigator.clipboard.writeText(_lastResult.link).then(() => toast('Đã copy link!', 'success'));
}
function openProfile() {
  if (!_lastResult) return;
  window.open(_lastResult.link, '_blank');
}

function renderRecent() {
  const el = document.getElementById('recentList');
  if (!_history.length) {
    el.innerHTML = '<div style="text-align:center;color:rgba(255,255,255,.25);font-size:12px;padding:16px 0">Chưa có tra cứu nào</div>';
    return;
  }
  el.innerHTML = _history.slice(0, 5).map((h, i) => `
    <div onclick="reuseHistory(${i})" style="display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid rgba(255,255,255,.04);cursor:pointer" class="history-item" style="border-radius:0;background:none;border:none;border-bottom:1px solid rgba(255,255,255,.04)">
      <div style="flex:1;min-width:0">
        <div style="font-size:11.5px;color:rgba(255,255,255,.45);overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${h.input}</div>
        <div style="font-size:13px;font-weight:700;color:#38bdf8;font-family:monospace">${h.id}</div>
      </div>
      <button onclick="event.stopPropagation();navigator.clipboard.writeText('${h.id}');toast('Đã copy!','success')"
        style="background:rgba(56,189,248,.1);border:1px solid rgba(56,189,248,.2);border-radius:5px;padding:3px 8px;color:#38bdf8;cursor:pointer;font-size:11px;font-family:Inter,sans-serif;margin-left:8px;flex-shrink:0">
        <i class="bi bi-clipboard"></i>
      </button>
    </div>`).join('');
}

// -- UI: Bulk --
async function doBulkFind() {
  const lines = document.getElementById('bulkInput').value.split('\n').map(l => l.trim()).filter(Boolean);
  if (!lines.length) { toast('Vui lòng nhập danh sách link', 'error'); return; }
  if (lines.length > 50) { toast('Tối đa 50 link mỗi lần', 'error'); return; }

  const btn = document.getElementById('bulkBtn');
  btn.innerHTML = '<span class="spinner"></span> Đang tra cứu...';
  btn.disabled = true;

  const resultsDiv = document.getElementById('bulkResults');
  resultsDiv.innerHTML = '';
  let successCount = 0;

  for (let i = 0; i < lines.length; i++) {
    const line = lines[i];
    const row = document.createElement('div');
    row.className = 'bulk-row';
    row.innerHTML = `<div class="bulk-input" title="${line}">${line}</div><span class="spinner"></span><span class="bulk-name" style="color:rgba(255,255,255,.3)">Đang tra...</span><span></span>`;
    resultsDiv.appendChild(row);

    try {
      const r = await lookupId(line);
      successCount++;
      row.innerHTML = `
        <div class="bulk-input" title="${line}">${line}</div>
        <div class="bulk-id">${r.id}</div>
        <div class="bulk-name">${r.name || '—'}</div>
        <div>
          <button onclick="navigator.clipboard.writeText('${r.id}');toast('Đã copy!','success')"
            style="background:rgba(56,189,248,.12);border:1px solid rgba(56,189,248,.2);border-radius:5px;padding:3px 8px;color:#38bdf8;cursor:pointer;font-size:11px;font-family:Inter,sans-serif">
            <i class="bi bi-clipboard"></i>
          </button>
        </div>`;
      row.style.borderColor = 'rgba(34,197,94,.2)';
    } catch(e) {
      row.innerHTML = `<div class="bulk-input" title="${line}">${line}</div><div style="color:#f87171;font-size:12px">Lỗi</div><div style="font-size:11px;color:#f87171">${e.message}</div><span></span>`;
      row.style.borderColor = 'rgba(239,68,68,.2)';
    }

    if (i < lines.length - 1) await new Promise(r => setTimeout(r, 400));
  }

  btn.innerHTML = '<i class="bi bi-search"></i> Tra Cứu Tất Cả';
  btn.disabled = false;
  toast(`Hoàn thành ${successCount}/${lines.length} tra cứu`, 'success');
}

function exportBulkCSV() {
  const rows = document.querySelectorAll('.bulk-row');
  if (!rows.length) { toast('Không có dữ liệu để xuất', 'error'); return; }
  const lines = ['Input,ID,Tên'];
  rows.forEach(r => {
    const cells = r.querySelectorAll('div');
    lines.push(`"${cells[0]?.textContent?.trim()||''}","${cells[1]?.textContent?.trim()||''}","${cells[2]?.textContent?.trim()||''}"`);
  });
  downloadCSV(lines.join('\n'), `fbid_bulk_${Date.now()}.csv`);
}

// -- UI: History --
function updateHistoryCount() {
  document.getElementById('historyCount').textContent = _history.length;
}

function renderHistory() {
  const el = document.getElementById('historyList');
  if (!_history.length) {
    el.innerHTML = '<div class="empty-state"><i class="bi bi-clock-history"></i>Chưa có lịch sử tra cứu</div>';
    return;
  }
  el.innerHTML = _history.map((h, i) => `
    <div class="history-item" onclick="reuseHistory(${i})">
      <div style="flex:1;min-width:0">
        <div style="font-size:12px;color:rgba(255,255,255,.45);overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${h.input}</div>
        <div style="font-size:15px;font-weight:700;color:#38bdf8;font-family:monospace;margin:2px 0">${h.id}</div>
        <div style="font-size:11px;color:rgba(255,255,255,.3)">${h.name||'—'} · ${new Date(h.time).toLocaleString('vi-VN')}</div>
      </div>
      <div style="display:flex;gap:6px;flex-shrink:0;margin-left:10px">
        <button onclick="event.stopPropagation();navigator.clipboard.writeText('${h.id}');toast('Đã copy!','success')"
          style="background:rgba(56,189,248,.1);border:1px solid rgba(56,189,248,.2);border-radius:6px;padding:5px 10px;color:#38bdf8;cursor:pointer;font-size:11px;font-family:Inter,sans-serif">
          <i class="bi bi-clipboard"></i>
        </button>
        <button onclick="event.stopPropagation();deleteHistory(${i})"
          style="background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.15);border-radius:6px;padding:5px 10px;color:#f87171;cursor:pointer;font-size:11px;font-family:Inter,sans-serif">
          <i class="bi bi-trash"></i>
        </button>
      </div>
    </div>`).join('');
}

function reuseHistory(i) {
  document.getElementById('fbInput').value = _history[i].input;
  switchTab('single');
  doFind();
}

function deleteHistory(i) {
  _history.splice(i, 1);
  localStorage.setItem('genz_fbid_history', JSON.stringify(_history));
  updateHistoryCount();
  renderHistory();
  renderRecent();
}

function clearHistory() {
  if (!_history.length) { toast('Lịch sử đã trống', 'info'); return; }
  _history = [];
  localStorage.removeItem('genz_fbid_history');
  updateHistoryCount();
  renderHistory();
  renderRecent();
  toast('Đã xóa lịch sử', 'info');
}

function exportHistory() {
  if (!_history.length) { toast('Không có dữ liệu để xuất', 'error'); return; }
  const lines = ['Input,ID,Tên,Loại,Thời gian'];
  _history.forEach(h => {
    lines.push(`"${h.input}","${h.id}","${h.name||''}","${h.type||''}","${new Date(h.time).toLocaleString('vi-VN')}"`);
  });
  downloadCSV(lines.join('\n'), `fbid_history_${Date.now()}.csv`);
}

// -- UI: Tabs --
function switchTab(tab) {
  ['single','bulk','history'].forEach(t => {
    const cap = t.charAt(0).toUpperCase() + t.slice(1);
    document.getElementById('pane' + cap).classList.toggle('active', t === tab);
    document.getElementById('tab' + cap).classList.toggle('active', t === tab);
  });
  if (tab === 'history') renderHistory();
}

// -- Helpers --
function toast(msg, type='info') {
  const el = document.createElement('div');
  el.className = `toast-item ${type}`;
  const icons = {success:'check-circle-fill', error:'x-circle-fill', info:'info-circle-fill'};
  el.innerHTML = `<i class="bi bi-${icons[type]||'info-circle-fill'}" style="color:${type==='success'?'#4ade80':type==='error'?'#f87171':'#38bdf8'}"></i> ${msg}`;
  document.getElementById('toast').appendChild(el);
  setTimeout(() => el.remove(), 3500);
}

function downloadCSV(csv, filename) {
  const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
  toast('Đã xuất CSV!', 'success');
}

function toggleSubNav(e, id) {
  e.preventDefault();
  const el = document.getElementById(id);
  const arrow = document.getElementById(id + 'Arrow');
  const isOpen = el.style.display !== 'none';
  el.style.display = isOpen ? 'none' : 'block';
  if (arrow) arrow.style.transform = isOpen ? '' : 'rotate(180deg)';
}

// -- Init --
document.addEventListener('DOMContentLoaded', () => {
  updateHistoryCount();
  renderRecent();
});
</script>

<!-- Background + cursor -->


<script id="gz-universe-bg">
(function(){
  'use strict';
  const isMobile = /Mobi|Android/i.test(navigator.userAgent);

  // -- Stars Canvas --
  const cs = document.getElementById('gz-stars');
  if (!cs) return;
  const ctxS = cs.getContext('2d');
  function resizeS(){ cs.width=window.innerWidth; cs.height=window.innerHeight; }
  resizeS();
  const stars = [];
  const N = isMobile ? 80 : 180;
  for(let i=0;i<N;i++){
    stars.push({
      x: Math.random()*cs.width, y: Math.random()*cs.height,
      r: Math.random()*1.6+0.2,
      a: Math.random(), da: (Math.random()-0.5)*0.004,
      vx: (Math.random()-0.5)*0.07, vy: (Math.random()-0.5)*0.07,
      hue: [210,195,270,180][Math.floor(Math.random()*4)] // xanh dương, cyan, tím, xanh lá
    });
  }
  function animStars(){
    ctxS.clearRect(0,0,cs.width,cs.height);
    stars.forEach(s=>{
      s.x+=s.vx; s.y+=s.vy; s.a+=s.da;
      if(s.a<0.08) s.da=Math.abs(s.da);
      if(s.a>0.95) s.da=-Math.abs(s.da);
      if(s.x<0) s.x=cs.width; if(s.x>cs.width) s.x=0;
      if(s.y<0) s.y=cs.height; if(s.y>cs.height) s.y=0;
      const g=ctxS.createRadialGradient(s.x,s.y,0,s.x,s.y,s.r*2.5);
      g.addColorStop(0,`hsla(${s.hue},100%,90%,${s.a*0.9})`);
      g.addColorStop(0.5,`hsla(${s.hue},100%,70%,${s.a*0.4})`);
      g.addColorStop(1,`hsla(${s.hue},100%,60%,0)`);
      ctxS.fillStyle=g;
      ctxS.beginPath(); ctxS.arc(s.x,s.y,s.r*2.5,0,Math.PI*2); ctxS.fill();
    });
    requestAnimationFrame(animStars);
  }
  animStars();

  // -- Data Particles Canvas --
  const cp = document.getElementById('gz-particles');
  if(!cp) return;
  const ctxP = cp.getContext('2d');
  function resizeP(){ cp.width=window.innerWidth; cp.height=window.innerHeight; }
  resizeP();
  const parts = [];
  const NP = isMobile ? 8 : 18;
  for(let i=0;i<NP;i++){
    parts.push({
      x:0, y:0,
      r: Math.random()*2.5+1,
      cx: Math.random()*cp.width, cy: Math.random()*cp.height,
      rx: Math.random()*120+40, ry: Math.random()*120+40,
      angle: Math.random()*Math.PI*2,
      speed: Math.random()*0.008+0.004,
      pulse: Math.random()*Math.PI*2, ps: Math.random()*0.02+0.01,
      color: [[24,119,242],[0,212,255],[139,92,246],[6,182,212]][Math.floor(Math.random()*4)]
    });
  }
  function animParts(){
    ctxP.clearRect(0,0,cp.width,cp.height);
    parts.forEach(p=>{
      p.angle+=p.speed;
      p.x=p.cx+Math.cos(p.angle)*p.rx;
      p.y=p.cy+Math.sin(p.angle)*p.ry;
      p.pulse+=p.ps;
      const ps=1+Math.sin(p.pulse)*0.5;
      const [r,g,b]=p.color;
      const grd=ctxP.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r*ps*4);
      grd.addColorStop(0,`rgba(${r},${g},${b},${0.75*ps})`);
      grd.addColorStop(0.4,`rgba(${r},${g},${b},${0.3*ps})`);
      grd.addColorStop(1,`rgba(${r},${g},${b},0)`);
      ctxP.fillStyle=grd;
      ctxP.beginPath(); ctxP.arc(p.x,p.y,p.r*ps*4,0,Math.PI*2); ctxP.fill();
    });
    requestAnimationFrame(animParts);
  }
  animParts();

  // -- Custom Cursor --
  const cur=document.getElementById('custom-cursor');
  if(cur && !('ontouchstart' in window)){
    let mx=0,my=0,cx=0,cy=0,shown=false;
    document.body.style.cursor='none';
    document.addEventListener('mousemove',e=>{
      mx=e.clientX; my=e.clientY;
      if(!shown){ shown=true; cur.style.opacity='1'; }
    });
    document.addEventListener('mouseleave',()=>{ shown=false; cur.style.opacity='0'; });
    function animCur(){ if(shown){ cx+=(mx-cx)*0.15; cy+=(my-cy)*0.15; cur.style.left=cx+'px'; cur.style.top=cy+'px'; } requestAnimationFrame(animCur); }
    animCur();
  }

  // -- Resize handler --
  window.addEventListener('resize',()=>{ resizeS(); resizeP(); });
})();
</script>
  <script src="js/auth-common.js"></script>
</body>
</html>

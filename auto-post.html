<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Genztech ‚Äî T·ª± ƒê·ªông ƒêƒÉng B√†i Facebook</title>
  <link rel="stylesheet" href="css/main.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <style>
    /* ====================================================
       RESET & BASE
    ==================================================== */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --space:       #020408;
      --surface-1:   rgba(255,255,255,0.03);
      --surface-2:   rgba(255,255,255,0.06);
      --border:      rgba(255,255,255,0.08);
      --border-blue: rgba(24,119,242,0.35);
      --blue:        #1877F2;
      --blue-light:  #60a5fa;
      --cyan:        #00D4FF;
      --violet:      #9D50BB;
      --green:       #22c55e;
      --yellow:      #f59e0b;
      --red:         #ef4444;
      --text-1:      #ffffff;
      --text-2:      rgba(255,255,255,0.65);
      --text-3:      rgba(255,255,255,0.35);
      --radius-sm:   8px;
      --radius-md:   14px;
      --radius-lg:   20px;
      --radius-xl:   28px;
    }

    html, body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--space-black, #0A0E27);
      color: var(--text-1);
      scrollbar-width: none;
      -ms-overflow-style: none;
      overflow-x: hidden;
      cursor: none !important;
    }
    html::-webkit-scrollbar, body::-webkit-scrollbar { display: none; }
    @media (hover: none) and (pointer: coarse) {
      body { cursor: auto !important; }
      #custom-cursor { display: none !important; }
    }

    /* ====================================================
       TOPBAR background override ‚Äî use homepage space-black
    ==================================================== */
    .topbar { background: rgba(10,14,39,0.8) !important; }
    .sidebar { background: rgba(10,14,39,0.6) !important; }

    /* ====================================================
       LAYOUT
    ==================================================== */
    .app-wrapper {
      position: relative; z-index: 10;
      display: flex; flex-direction: column;
      min-height: 100vh;
    }

    /* ====================================================
       TOPBAR
    ==================================================== */
    .topbar {
      position: fixed; top: 0; left: 0; right: 0;
      height: 64px; z-index: 200;
      background: rgba(2,4,8,0.8);
      backdrop-filter: blur(24px);
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center;
      padding: 0 24px; gap: 16px;
    }
    .topbar-brand {
      display: flex; align-items: center; gap: 10px;
      font-size: 18px; font-weight: 800;
      text-decoration: none; color: var(--text-1);
      letter-spacing: -0.5px;
    }
    .topbar-brand img { width: 32px; height: 32px; border-radius: 50%; }
    .topbar-sep { color: var(--text-3); font-size: 18px; }
    .topbar-title { font-size: 14px; font-weight: 500; color: var(--text-2); }
    .topbar-right { margin-left: auto; display: flex; align-items: center; gap: 10px; }

    .conn-pill {
      display: flex; align-items: center; gap: 8px;
      padding: 6px 14px; border-radius: 20px;
      background: var(--surface-1);
      border: 1px solid var(--border);
      font-size: 13px; color: var(--text-2);
    }
    .conn-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--red); }
    .conn-dot.on { background: var(--green); box-shadow: 0 0 6px var(--green); }

    /* ====================================================
       SIDEBAR
    ==================================================== */
    .sidebar {
      position: fixed; top: 64px; left: 0;
      width: 240px; height: calc(100vh - 64px);
      background: rgba(2,4,8,0.6);
      backdrop-filter: blur(20px);
      border-right: 1px solid var(--border);
      overflow-y: auto; z-index: 100;
      padding: 20px 12px;
      scrollbar-width: none;
    }
    .sidebar::-webkit-scrollbar { display: none; }

    .nav-section-label {
      font-size: 10px; font-weight: 700;
      letter-spacing: 1.2px; text-transform: uppercase;
      color: var(--text-3); padding: 0 10px;
      margin: 16px 0 6px;
    }
    .nav-item {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 12px; border-radius: var(--radius-sm);
      font-size: 13px; font-weight: 500;
      color: var(--text-2); cursor: pointer;
      text-decoration: none;
      transition: all .15s;
      border: 1px solid transparent;
    }
    .nav-item i { font-size: 16px; width: 20px; text-align: center; flex-shrink: 0; }
    .nav-item:hover { background: var(--surface-2); color: var(--text-1); }
    .nav-item.active {
      background: rgba(24,119,242,0.12);
      border-color: rgba(24,119,242,0.25);
      color: var(--blue-light);
    }
    .nav-item .badge-count {
      margin-left: auto; font-size: 11px; font-weight: 700;
      background: var(--blue); color: #fff;
      padding: 1px 7px; border-radius: 10px;
    }

    .sidebar-user {
      margin-bottom: 16px; padding: 14px;
      background: var(--surface-1);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
    }
    .sidebar-user img { width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--border-blue); }
    .sidebar-user-name { font-size: 13px; font-weight: 600; }
    .sidebar-user-sub { font-size: 11px; color: var(--text-3); margin-top: 2px; }

    /* ====================================================
       MAIN CONTENT
    ==================================================== */
    .main {
      margin-left: 240px;
      padding: 88px 28px 40px;
      min-height: 100vh;
    }

    /* ====================================================
       PAGE HEADER
    ==================================================== */
    .page-header { margin-bottom: 28px; }
    .page-header h1 {
      font-size: 28px; font-weight: 800;
      background: linear-gradient(135deg, #fff 30%, #93c5fd 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px; line-height: 1.2;
    }
    .page-header p { font-size: 14px; color: var(--text-3); margin-top: 6px; }

    /* ====================================================
       STATS ROW
    ==================================================== */
    .stats-row {
      display: grid; grid-template-columns: repeat(4, 1fr);
      gap: 14px; margin-bottom: 28px;
    }
    .stat-card {
      background: var(--surface-1);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 18px 20px;
      position: relative; overflow: hidden;
      transition: border-color .2s;
    }
    .stat-card:hover { border-color: rgba(24,119,242,0.3); }
    .stat-card::before {
      content: ''; position: absolute;
      top: 0; left: 0; right: 0; height: 2px;
    }
    .stat-card.blue::before { background: linear-gradient(90deg, var(--blue), var(--cyan)); }
    .stat-card.yellow::before { background: linear-gradient(90deg, var(--yellow), #fbbf24); }
    .stat-card.green::before { background: linear-gradient(90deg, var(--green), #4ade80); }
    .stat-card.red::before { background: linear-gradient(90deg, var(--red), #f87171); }

    .stat-icon {
      width: 36px; height: 36px; border-radius: var(--radius-sm);
      display: flex; align-items: center; justify-content: center;
      font-size: 17px; margin-bottom: 12px;
    }
    .stat-num {
      font-size: 30px; font-weight: 800; line-height: 1;
      font-variant-numeric: tabular-nums;
    }
    .stat-label { font-size: 12px; color: var(--text-3); margin-top: 4px; }

    /* ====================================================
       GRID LAYOUT
    ==================================================== */
    .content-grid {
      display: grid;
      grid-template-columns: 1fr 340px;
      gap: 20px;
      align-items: start;
    }
    .left-col { display: flex; flex-direction: column; gap: 20px; }
    .right-col { display: flex; flex-direction: column; gap: 20px; }

    /* ====================================================
       CARD
    ==================================================== */
    .card {
      background: var(--surface-1);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 24px;
      transition: border-color .2s;
    }
    .card:hover { border-color: rgba(24,119,242,0.2); }
    .card.violet-glow { border-color: rgba(157,80,187,0.2); }
    .card.violet-glow:hover { border-color: rgba(157,80,187,0.4); }
    .card.cyan-glow { border-color: rgba(0,212,255,0.15); }

    .card-header {
      display: flex; align-items: center; gap: 12px;
      margin-bottom: 6px;
    }
    .card-icon {
      width: 38px; height: 38px; border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px; flex-shrink: 0;
    }
    .card-title { font-size: 16px; font-weight: 700; }
    .card-sub { font-size: 12px; color: var(--text-3); margin-bottom: 20px; margin-left: 50px; }

    /* ====================================================
       FORM ELEMENTS
    ==================================================== */
    .field { margin-bottom: 16px; }
    .field-label {
      font-size: 12px; font-weight: 600;
      color: var(--text-2); margin-bottom: 7px;
      display: flex; align-items: center; gap: 6px;
    }
    .field-label i { font-size: 13px; }

    .gz-input, .gz-select, .gz-textarea {
      width: 100%;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-1);
      font-family: inherit;
      font-size: 13px;
      padding: 10px 14px;
      outline: none;
      transition: border-color .15s, box-shadow .15s, background .15s;
      -webkit-appearance: none;
    }
    .gz-input:focus, .gz-select:focus, .gz-textarea:focus {
      border-color: var(--blue);
      box-shadow: 0 0 0 3px rgba(24,119,242,0.12);
      background: rgba(24,119,242,0.04);
    }
    .gz-input::placeholder, .gz-textarea::placeholder { color: var(--text-3); }
    .gz-textarea { resize: none; line-height: 1.6; }
    .gz-select option { background: #0d1117; }

    .char-counter {
      font-size: 11px; color: var(--text-3);
      text-align: right; margin-top: 5px;
    }
    .char-counter.warn { color: var(--yellow); }
    .char-counter.danger { color: var(--red); }

    /* ====================================================
       BUTTONS
    ==================================================== */
    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      gap: 7px; padding: 10px 20px;
      border-radius: var(--radius-sm); font-size: 13px;
      font-weight: 600; font-family: inherit;
      cursor: pointer; border: none;
      transition: all .15s; white-space: nowrap;
    }
    .btn:disabled { opacity: .45; cursor: not-allowed; transform: none !important; }
    .btn i { font-size: 15px; }

    .btn-primary {
      background: linear-gradient(135deg, #1877F2, #0052cc);
      color: #fff;
    }
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 8px 24px rgba(24,119,242,0.4);
    }

    .btn-ai {
      background: linear-gradient(135deg, #9D50BB, #6E48AA);
      color: #fff;
    }
    .btn-ai:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 8px 24px rgba(157,80,187,0.4);
    }

    .btn-ghost {
      background: var(--surface-2);
      border: 1px solid var(--border);
      color: var(--text-2);
    }
    .btn-ghost:hover:not(:disabled) {
      background: rgba(255,255,255,0.1);
      color: var(--text-1);
    }

    .btn-success {
      background: rgba(34,197,94,0.15);
      border: 1px solid rgba(34,197,94,0.3);
      color: #4ade80;
    }
    .btn-success:hover:not(:disabled) { background: rgba(34,197,94,0.25); }

    .btn-danger {
      background: rgba(239,68,68,0.12);
      border: 1px solid rgba(239,68,68,0.25);
      color: #f87171;
    }
    .btn-danger:hover:not(:disabled) { background: rgba(239,68,68,0.22); }

    .btn-sm { padding: 6px 12px; font-size: 12px; }
    .btn-lg { padding: 13px 28px; font-size: 14px; }
    .btn-full { width: 100%; }

    /* ====================================================
       TOGGLE
    ==================================================== */
    .toggle-row {
      display: flex; align-items: center; gap: 10px;
      margin-bottom: 4px;
    }
    .toggle-wrap { position: relative; width: 42px; height: 23px; flex-shrink: 0; }
    .toggle-wrap input { opacity: 0; width: 0; height: 0; position: absolute; }
    .toggle-track {
      position: absolute; inset: 0;
      background: rgba(255,255,255,0.12);
      border-radius: 23px; cursor: pointer;
      transition: background .2s;
    }
    .toggle-track::before {
      content: ''; position: absolute;
      width: 17px; height: 17px;
      background: #fff; border-radius: 50%;
      top: 3px; left: 3px;
      transition: transform .2s;
    }
    .toggle-wrap input:checked + .toggle-track { background: var(--blue); }
    .toggle-wrap input:checked + .toggle-track::before { transform: translateX(19px); }
    .toggle-label { font-size: 13px; color: var(--text-2); }

    /* ====================================================
       EMOJI QUICK BAR
    ==================================================== */
    .emoji-bar { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px; }
    .emoji-btn {
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 7px; padding: 5px 9px;
      font-size: 15px; cursor: pointer;
      transition: all .15s; color: var(--text-1);
      font-family: inherit;
    }
    .emoji-btn:hover { background: rgba(255,255,255,0.12); transform: scale(1.1); }

    /* ====================================================
       IMAGE UPLOAD
    ==================================================== */
    .upload-zone {
      border: 2px dashed var(--border);
      border-radius: var(--radius-md);
      padding: 28px 20px; text-align: center;
      cursor: pointer; transition: all .2s;
      position: relative; overflow: hidden;
    }
    .upload-zone:hover {
      border-color: rgba(24,119,242,0.5);
      background: rgba(24,119,242,0.03);
    }
    .upload-zone.has-image { border-style: solid; border-color: rgba(24,119,242,0.3); padding: 0; }
    .upload-zone img { width: 100%; max-height: 220px; object-fit: cover; border-radius: 12px; display: block; }
    .upload-icon { font-size: 32px; color: var(--text-3); margin-bottom: 8px; display: block; }
    .upload-text { font-size: 13px; color: var(--text-3); }
    .upload-sub { font-size: 11px; color: var(--text-3); margin-top: 4px; opacity: .6; }

    /* ====================================================
       PAGE SELECTOR
    ==================================================== */
    .page-card {
      display: flex; align-items: center; gap: 12px;
      padding: 12px 14px; border-radius: var(--radius-md);
      border: 1px solid var(--border);
      cursor: pointer; transition: all .15s;
      margin-bottom: 8px;
    }
    .page-card:hover { border-color: rgba(24,119,242,0.35); background: rgba(24,119,242,0.04); }
    .page-card.selected { border-color: rgba(24,119,242,0.5); background: rgba(24,119,242,0.08); }
    .page-avatar {
      width: 42px; height: 42px; border-radius: 50%;
      background: linear-gradient(135deg, var(--blue), var(--cyan));
      display: flex; align-items: center; justify-content: center;
      font-size: 18px; flex-shrink: 0; overflow: hidden;
    }
    .page-avatar img { width: 100%; height: 100%; object-fit: cover; }
    .page-name { font-size: 13px; font-weight: 600; }
    .page-id { font-size: 11px; color: var(--text-3); margin-top: 2px; }
    .page-check { margin-left: auto; color: var(--blue-light); font-size: 18px; }

    /* ====================================================
       SCHEDULE PREVIEW
    ==================================================== */
    .schedule-preview {
      background: rgba(24,119,242,0.07);
      border: 1px solid rgba(24,119,242,0.2);
      border-radius: var(--radius-sm);
      padding: 12px 14px; font-size: 12px;
      color: #93c5fd; margin-top: 12px;
      display: flex; align-items: center; gap: 8px;
    }

    /* ====================================================
       BEST TIME CHIPS
    ==================================================== */
    .time-chips { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
    .time-chip {
      background: rgba(24,119,242,0.1);
      border: 1px solid rgba(24,119,242,0.2);
      border-radius: 20px; padding: 4px 12px;
      font-size: 12px; color: var(--blue-light);
      cursor: pointer; transition: all .15s;
    }
    .time-chip:hover { background: rgba(24,119,242,0.2); }

    /* ====================================================
       HASHTAG CHIPS
    ==================================================== */
    .hashtag-wrap { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
    .hashtag-chip {
      background: rgba(157,80,187,0.1);
      border: 1px solid rgba(157,80,187,0.2);
      border-radius: 20px; padding: 4px 12px;
      font-size: 12px; color: #c084fc;
      cursor: pointer; transition: all .15s;
      display: flex; align-items: center; gap: 5px;
    }
    .hashtag-chip:hover { background: rgba(157,80,187,0.2); }
    .hashtag-chip.used { opacity: .4; }

    /* ====================================================
       AI SUGGESTIONS
    ==================================================== */
    .ai-card {
      background: rgba(157,80,187,0.06);
      border: 1px solid rgba(157,80,187,0.18);
      border-radius: var(--radius-md);
      padding: 16px; cursor: pointer;
      transition: all .15s; margin-bottom: 10px;
    }
    .ai-card:hover { border-color: rgba(157,80,187,0.4); background: rgba(157,80,187,0.1); }
    .ai-card-label { font-size: 11px; font-weight: 700; color: #c084fc; margin-bottom: 8px; letter-spacing: .5px; }
    .ai-card-text { font-size: 13px; color: var(--text-2); line-height: 1.65; }

    /* ====================================================
       TYPING DOTS
    ==================================================== */
    .typing { display: flex; align-items: center; gap: 5px; padding: 12px 0; }
    .typing span {
      width: 7px; height: 7px; border-radius: 50%;
      background: var(--violet); display: block;
      animation: tdot 1.2s infinite;
    }
    .typing span:nth-child(2) { animation-delay: .2s; }
    .typing span:nth-child(3) { animation-delay: .4s; }
    @keyframes tdot {
      0%,80%,100% { transform: translateY(0); opacity: .5; }
      40% { transform: translateY(-8px); opacity: 1; }
    }

    /* ====================================================
       POST LIST
    ==================================================== */
    .post-list { display: flex; flex-direction: column; gap: 10px; }
    .post-item {
      background: rgba(255,255,255,0.025);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 16px 18px;
      transition: border-color .15s;
    }
    .post-item:hover { border-color: rgba(24,119,242,0.25); }
    .post-item-header { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px; }
    .post-item-content { font-size: 13px; color: var(--text-2); line-height: 1.6; }
    .post-item-footer {
      display: flex; align-items: center; justify-content: space-between;
      margin-top: 12px; padding-top: 10px;
      border-top: 1px solid var(--border);
    }
    .post-item-time { font-size: 11px; color: var(--text-3); display: flex; align-items: center; gap: 5px; }

    /* ====================================================
       BADGES
    ==================================================== */
    .badge {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 3px 10px; border-radius: 20px;
      font-size: 11px; font-weight: 600;
    }
    .badge-pending { background: rgba(245,158,11,0.12); color: #fbbf24; border: 1px solid rgba(245,158,11,0.25); }
    .badge-posted  { background: rgba(34,197,94,0.12);  color: #4ade80; border: 1px solid rgba(34,197,94,0.25); }
    .badge-failed  { background: rgba(239,68,68,0.12);  color: #f87171; border: 1px solid rgba(239,68,68,0.25); }
    .badge-draft   { background: rgba(148,163,184,0.1); color: #94a3b8; border: 1px solid rgba(148,163,184,0.2); }

    /* ====================================================
       DIVIDER
    ==================================================== */
    .divider { border: none; border-top: 1px solid var(--border); margin: 18px 0; }
    .glow-line {
      height: 1px; margin: 20px 0;
      background: linear-gradient(90deg, transparent, var(--blue), var(--cyan), transparent);
    }

    /* ====================================================
       SPINNER
    ==================================================== */
    .spinner {
      width: 16px; height: 16px;
      border: 2px solid rgba(255,255,255,0.2);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin .7s linear infinite;
      display: inline-block; flex-shrink: 0;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ====================================================
       TOAST
    ==================================================== */
    #toast-box {
      position: fixed; bottom: 24px; right: 24px;
      z-index: 9999; display: flex; flex-direction: column; gap: 8px;
    }
    .toast {
      display: flex; align-items: center; gap: 12px;
      padding: 13px 18px; border-radius: var(--radius-md);
      background: rgba(10,14,22,0.96);
      border: 1px solid var(--border);
      backdrop-filter: blur(20px);
      font-size: 13px; min-width: 260px;
      animation: toast-in .25s ease;
    }
    .toast.success { border-color: rgba(34,197,94,0.4); }
    .toast.error   { border-color: rgba(239,68,68,0.4); }
    .toast.info    { border-color: rgba(24,119,242,0.4); }
    @keyframes toast-in {
      from { transform: translateX(60px); opacity: 0; }
      to   { transform: translateX(0); opacity: 1; }
    }

    /* ====================================================
       MODAL
    ==================================================== */
    .modal-bg {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.75);
      backdrop-filter: blur(10px);
      z-index: 500; display: flex;
      align-items: center; justify-content: center;
      padding: 20px;
    }
    .modal-box {
      background: #0b0f17;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: var(--radius-xl);
      padding: 32px; width: 100%; max-width: 460px;
      position: relative;
    }
    .modal-close {
      position: absolute; top: 16px; right: 16px;
      background: none; border: none; color: var(--text-3);
      font-size: 20px; cursor: pointer;
      transition: color .15s;
    }
    .modal-close:hover { color: var(--text-1); }
    .modal-title { font-size: 18px; font-weight: 700; margin-bottom: 6px; }
    .modal-sub { font-size: 13px; color: var(--text-3); margin-bottom: 20px; }

    /* ====================================================
       FB PREVIEW
    ==================================================== */
    .fb-preview {
      background: #1a1f2e;
      border: 1px solid rgba(255,255,255,0.07);
      border-radius: var(--radius-md);
      padding: 16px; font-size: 13px;
    }
    .fb-preview-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
    .fb-avatar {
      width: 38px; height: 38px; border-radius: 50%;
      background: linear-gradient(135deg, var(--blue), var(--cyan));
      display: flex; align-items: center; justify-content: center;
      font-size: 17px; flex-shrink: 0;
    }
    .fb-page-name { font-size: 13px; font-weight: 600; }
    .fb-meta { font-size: 11px; color: var(--text-3); margin-top: 2px; }
    .fb-content { font-size: 14px; line-height: 1.65; color: rgba(255,255,255,0.85); white-space: pre-wrap; }
    .fb-actions {
      display: flex; gap: 20px; margin-top: 14px;
      padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.07);
    }
    .fb-action { font-size: 12px; color: var(--text-3); display: flex; align-items: center; gap: 5px; }

    /* ====================================================
       TABS
    ==================================================== */
    .tab-bar { display: flex; gap: 4px; margin-bottom: 16px; }
    .tab-btn {
      padding: 8px 16px; border-radius: var(--radius-sm);
      font-size: 13px; font-weight: 500;
      cursor: pointer; border: 1px solid transparent;
      color: var(--text-3); background: none;
      font-family: inherit; transition: all .15s;
    }
    .tab-btn:hover { color: var(--text-2); background: var(--surface-2); }
    .tab-btn.active {
      background: rgba(24,119,242,0.12);
      border-color: rgba(24,119,242,0.3);
      color: var(--blue-light);
    }

    /* ====================================================
       SCROLLABLE LIST
    ==================================================== */
    .scroll-list {
      max-height: 480px; overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(24,119,242,0.3) transparent;
    }
    .scroll-list::-webkit-scrollbar { width: 3px; }
    .scroll-list::-webkit-scrollbar-thumb { background: rgba(24,119,242,0.3); border-radius: 3px; }

    /* ====================================================
       TIPS LIST
    ==================================================== */
    .tips-list { list-style: none; }
    .tips-list li {
      display: flex; gap: 8px; align-items: flex-start;
      font-size: 12px; color: var(--text-3);
      padding: 5px 0;
      border-bottom: 1px solid rgba(255,255,255,0.04);
    }
    .tips-list li:last-child { border-bottom: none; }
    .tips-list .dot { color: var(--cyan); font-size: 14px; flex-shrink: 0; line-height: 1.4; }

    /* ====================================================
       ANALYTICS
    ==================================================== */
    .ana-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
      font-size: 13px;
    }
    .ana-row:last-child { border-bottom: none; }
    .ana-label { color: var(--text-3); }
    .ana-val { font-weight: 700; }

    /* ====================================================
       SETTINGS
    ==================================================== */
    .setting-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 16px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .setting-row:last-child { border-bottom: none; }
    .setting-title { font-size: 13px; font-weight: 600; }
    .setting-desc { font-size: 12px; color: var(--text-3); margin-top: 3px; }

    /* ====================================================
       EMPTY STATE
    ==================================================== */
    .empty-state {
      text-align: center; padding: 48px 20px;
    }
    .empty-state i { font-size: 40px; color: var(--text-3); display: block; margin-bottom: 12px; }
    .empty-state p { font-size: 13px; color: var(--text-3); margin-bottom: 16px; }

    /* ====================================================
       RESPONSIVE
    ==================================================== */
    @media (max-width: 1100px) {
      .content-grid { grid-template-columns: 1fr; }
      .right-col { display: grid; grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 768px) {
      .sidebar { display: none; }
      .main { margin-left: 0; padding: 80px 16px 32px; }
      .stats-row { grid-template-columns: repeat(2,1fr); }
      .right-col { grid-template-columns: 1fr; }
    }

    /* ====================================================
       MISC
    ==================================================== */
    .hidden { display: none !important; }
    .flex { display: flex; }
    .items-center { align-items: center; }
    .gap-2 { gap: 8px; }
    .gap-3 { gap: 12px; }
    .mt-2 { margin-top: 8px; }
    .mt-3 { margin-top: 12px; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .text-xs { font-size: 11px; }
    .text-sm { font-size: 13px; }
    .text-muted { color: var(--text-3); }
    .font-bold { font-weight: 700; }
    .w-full { width: 100%; }
  </style>
</head>
<body>

<!-- Multi-Layer Starfield Canvas (same as homepage) -->
<canvas id="starfield-far" class="fixed inset-0 pointer-events-none" style="z-index:0;"></canvas>
<canvas id="starfield-mid" class="fixed inset-0 pointer-events-none" style="z-index:1;"></canvas>
<canvas id="starfield-near" class="fixed inset-0 pointer-events-none" style="z-index:2;"></canvas>
<canvas id="constellation-lines" class="fixed inset-0 pointer-events-none" style="z-index:3;"></canvas>
<canvas id="data-particles" class="fixed inset-0 pointer-events-none" style="z-index:4;"></canvas>

<!-- Cosmic Fog -->
<div class="fixed inset-0 pointer-events-none opacity-30" style="z-index:5;">
  <div class="cosmic-fog"></div>
</div>

<!-- Noise Texture -->
<div class="fixed inset-0 pointer-events-none noise-overlay opacity-10" style="z-index:6;"></div>

<!-- Custom Cursor (same as homepage) -->
<div id="custom-cursor" class="fixed pointer-events-none" style="z-index:9999;opacity:0;transition:opacity 0.3s;transform:translate(-50%,-50%);will-change:transform;">
  <img src="images/logo.png" alt="Genztech Cursor"
    style="width:40px;height:40px;object-fit:cover;border-radius:50%;filter:drop-shadow(0 0 8px rgba(0,212,255,0.8));pointer-events:none;">
</div>

<!-- Toast -->
<div id="toast-box"></div>

<!-- ===================== TOPBAR ===================== -->
<header class="topbar">
  <a href="maindashboard.html" class="topbar-brand">
    <img src="images/logo.png" alt="GZ">
    GENZTECH
  </a>
  <span class="topbar-sep">/</span>
  <span class="topbar-title">T·ª± ƒê·ªông ƒêƒÉng B√†i</span>

  <div class="topbar-right">
    <div class="conn-pill" id="conn-pill">
      <span class="conn-dot" id="conn-dot"></span>
      <span id="conn-text">Ch∆∞a k·∫øt n·ªëi</span>
    </div>
    <button class="btn btn-primary" onclick="openModal('modal-connect')" id="btn-connect">
      <i class="bi bi-facebook"></i> K·∫øt n·ªëi Facebook
    </button>
    <a href="maindashboard.html" class="btn btn-ghost">
      <i class="bi bi-grid-3x3-gap"></i> Dashboard
    </a>
  </div>
</header>

<!-- ===================== SIDEBAR ===================== -->
<aside class="sidebar">
  <!-- User info (hidden until connected) -->
  <div class="sidebar-user hidden" id="sidebar-user">
    <div class="flex items-center gap-2">
      <img id="sb-avatar" src="" alt="">
      <div>
        <div class="sidebar-user-name" id="sb-name">‚Äî</div>
        <div class="sidebar-user-sub">ƒê√£ k·∫øt n·ªëi Facebook</div>
      </div>
    </div>
  </div>

  <div class="nav-section-label">So·∫°n & ƒêƒÉng</div>
  <a class="nav-item active" id="nav-create" onclick="switchTab('create')">
    <i class="bi bi-pencil-square"></i> T·∫°o b√†i vi·∫øt
  </a>
  <a class="nav-item" id="nav-schedule" onclick="switchTab('schedule')">
    <i class="bi bi-calendar3"></i> L·ªãch ƒëƒÉng b√†i
    <span class="badge-count" id="nav-badge-schedule">0</span>
  </a>
  <a class="nav-item" id="nav-history" onclick="switchTab('history')">
    <i class="bi bi-clock-history"></i> L·ªãch s·ª≠
  </a>
  <a class="nav-item" id="nav-analytics" onclick="switchTab('analytics')">
    <i class="bi bi-bar-chart-line"></i> Th·ªëng k√™
  </a>

  <div class="nav-section-label">C√¥ng c·ª• AI</div>
  <a class="nav-item" onclick="focusAI()">
    <i class="bi bi-magic"></i> T·∫°o n·ªôi dung AI
  </a>
  <a class="nav-item" onclick="quickHashtag()">
    <i class="bi bi-hash"></i> G·ª£i √Ω hashtag
  </a>

  <div class="nav-section-label">H·ªá th·ªëng</div>
  <a class="nav-item" id="nav-settings" onclick="switchTab('settings')">
    <i class="bi bi-gear"></i> C√†i ƒë·∫∑t
  </a>
  <a class="nav-item" href="maindashboard.html">
    <i class="bi bi-arrow-left-circle"></i> Quay l·∫°i
  </a>
</aside>

<!-- ===================== MAIN ===================== -->
<main class="main">

  <!-- Page Header -->
  <div class="page-header">
    <h1>T·ª± ƒê·ªông ƒêƒÉng B√†i Facebook</h1>
    <p>So·∫°n n·ªôi dung, l√™n l·ªãch v√† ƒëƒÉng b√†i t·ª± ƒë·ªông v·ªõi s·ª©c m·∫°nh AI ‚Äî ti·∫øt ki·ªám h√†ng gi·ªù m·ªói ng√†y</p>
  </div>

  <!-- Stats Row -->
  <div class="stats-row">
    <div class="stat-card blue">
      <div class="stat-icon" style="background:rgba(24,119,242,0.15);color:#60a5fa;"><i class="bi bi-file-text"></i></div>
      <div class="stat-num" id="s-total">0</div>
      <div class="stat-label">T·ªïng b√†i vi·∫øt</div>
    </div>
    <div class="stat-card yellow">
      <div class="stat-icon" style="background:rgba(245,158,11,0.15);color:#fbbf24;"><i class="bi bi-clock"></i></div>
      <div class="stat-num" id="s-scheduled" style="color:#fbbf24;">0</div>
      <div class="stat-label">Ch·ªù ƒëƒÉng</div>
    </div>
    <div class="stat-card green">
      <div class="stat-icon" style="background:rgba(34,197,94,0.15);color:#4ade80;"><i class="bi bi-check-circle"></i></div>
      <div class="stat-num" id="s-posted" style="color:#4ade80;">0</div>
      <div class="stat-label">ƒê√£ ƒëƒÉng</div>
    </div>
    <div class="stat-card red">
      <div class="stat-icon" style="background:rgba(239,68,68,0.15);color:#f87171;"><i class="bi bi-x-circle"></i></div>
      <div class="stat-num" id="s-failed" style="color:#f87171;">0</div>
      <div class="stat-label">Th·∫•t b·∫°i</div>
    </div>
  </div>

  <!-- =========== TAB: T·∫†O B√ÄI VI·∫æT =========== -->
  <div id="tab-create">
    <div class="content-grid">

      <!-- LEFT COL -->
      <div class="left-col">

        <!-- So·∫°n n·ªôi dung -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background:rgba(24,119,242,0.15);color:#60a5fa;"><i class="bi bi-pencil-square"></i></div>
            <div class="card-title">So·∫°n n·ªôi dung b√†i vi·∫øt</div>
          </div>
          <div class="card-sub">Vi·∫øt th·ªß c√¥ng ho·∫∑c ƒë·ªÉ AI t·∫°o n·ªôi dung h·∫•p d·∫´n cho b·∫°n</div>

          <!-- Page selector -->
          <div class="field">
            <div class="field-label"><i class="bi bi-flag"></i> Ch·ªçn Facebook Page ƒëƒÉng b√†i</div>
            <div id="page-list">
              <div style="border:1px dashed var(--border);border-radius:var(--radius-md);padding:20px;text-align:center;">
                <i class="bi bi-facebook" style="font-size:28px;color:var(--text-3);display:block;margin-bottom:8px;"></i>
                <p class="text-sm text-muted">K·∫øt n·ªëi Facebook ƒë·ªÉ ch·ªçn Page</p>
                <button class="btn btn-primary btn-sm mt-2" onclick="openModal('modal-connect')">
                  <i class="bi bi-plug"></i> K·∫øt n·ªëi ngay
                </button>
              </div>
            </div>
          </div>

          <hr class="divider">

          <!-- Textarea -->
          <div class="field">
            <div class="field-label"><i class="bi bi-text-paragraph"></i> N·ªôi dung b√†i vi·∫øt</div>
            <textarea id="post-content" class="gz-textarea" rows="8"
              placeholder="Nh·∫≠p n·ªôi dung b√†i vi·∫øt c·ªßa b·∫°n t·∫°i ƒë√¢y...&#10;&#10;üí° M·∫πo: Nh·∫•n n√∫t AI b√™n d∆∞·ªõi ƒë·ªÉ t·∫°o n·ªôi dung t·ª± ƒë·ªông t·ª´ ch·ªß ƒë·ªÅ c·ªßa b·∫°n"
              oninput="onContentInput()"></textarea>
            <div class="char-counter" id="char-count">0 / 63,206 k√Ω t·ª±</div>
          </div>

          <!-- Emoji bar -->
          <div class="emoji-bar">
            <button class="emoji-btn" onclick="addEmoji('üî•')" title="Hot">üî•</button>
            <button class="emoji-btn" onclick="addEmoji('üí°')" title="√ù t∆∞·ªüng">üí°</button>
            <button class="emoji-btn" onclick="addEmoji('üöÄ')" title="TƒÉng tr∆∞·ªüng">üöÄ</button>
            <button class="emoji-btn" onclick="addEmoji('‚úÖ')" title="X√°c nh·∫≠n">‚úÖ</button>
            <button class="emoji-btn" onclick="addEmoji('üí∞')" title="Ti·ªÅn">üí∞</button>
            <button class="emoji-btn" onclick="addEmoji('üéØ')" title="M·ª•c ti√™u">üéØ</button>
            <button class="emoji-btn" onclick="addEmoji('üì¢')" title="Th√¥ng b√°o">üì¢</button>
            <button class="emoji-btn" onclick="addEmoji('‚ö°')" title="Nhanh">‚ö°</button>
            <button class="emoji-btn" onclick="addEmoji('üéÅ')" title="Qu√†">üéÅ</button>
            <button class="emoji-btn" onclick="addEmoji('‚ù§Ô∏è')" title="Y√™u th√≠ch">‚ù§Ô∏è</button>
            <button class="emoji-btn" onclick="addEmoji('üëá')" title="CTA">üëá</button>
            <button class="emoji-btn" onclick="addEmoji('üìå')" title="Ghim">üìå</button>
          </div>

          <!-- Hashtag area -->
          <div id="hashtag-area" class="hidden">
            <div class="field-label"><i class="bi bi-hash"></i> Hashtag g·ª£i √Ω ‚Äî nh·∫•p ƒë·ªÉ th√™m v√†o b√†i</div>
            <div class="hashtag-wrap" id="hashtag-chips"></div>
            <hr class="divider">
          </div>

          <!-- Image upload -->
          <div class="field">
            <div class="field-label"><i class="bi bi-image"></i> H√¨nh ·∫£nh ƒë√≠nh k√®m <span class="text-muted">(t√πy ch·ªçn)</span></div>
            <div class="upload-zone" id="upload-zone" onclick="document.getElementById('img-file').click()">
              <div id="upload-placeholder">
                <i class="upload-icon bi bi-cloud-arrow-up"></i>
                <p class="upload-text">K√©o th·∫£ ·∫£nh v√†o ƒë√¢y ho·∫∑c nh·∫•p ƒë·ªÉ ch·ªçn</p>
                <p class="upload-sub">PNG, JPG, GIF, WEBP ‚Äî t·ªëi ƒëa 10MB</p>
              </div>
              <img id="img-preview" src="" alt="" style="display:none;">
            </div>
            <input type="file" id="img-file" accept="image/*" class="hidden" onchange="onImageSelect(event)">
            <button id="btn-remove-img" class="btn btn-danger btn-sm mt-2 hidden" onclick="removeImage()">
              <i class="bi bi-trash"></i> X√≥a ·∫£nh
            </button>
          </div>

          <!-- Link -->
          <div class="field">
            <div class="field-label"><i class="bi bi-link-45deg"></i> ƒê∆∞·ªùng d·∫´n <span class="text-muted">(t√πy ch·ªçn)</span></div>
            <input type="url" id="post-link" class="gz-input" placeholder="https://example.com/trang-san-pham">
          </div>
        </div>

        <!-- AI Generator -->
        <div class="card violet-glow" id="ai-section">
          <div class="card-header">
            <div class="card-icon" style="background:rgba(157,80,187,0.15);color:#c084fc;"><i class="bi bi-magic"></i></div>
            <div class="card-title">AI T·∫°o N·ªôi Dung</div>
          </div>
          <div class="card-sub">M√¥ t·∫£ √Ω t∆∞·ªüng ‚Äî AI s·∫Ω vi·∫øt 3 phi√™n b·∫£n b√†i ho√†n ch·ªânh, b·∫°n ch·ªâ c·∫ßn ch·ªçn</div>

          <div class="field">
            <div class="field-label"><i class="bi bi-lightbulb"></i> Ch·ªß ƒë·ªÅ / √ù t∆∞·ªüng b√†i vi·∫øt</div>
            <input type="text" id="ai-topic" class="gz-input" id="ai-topic"
              placeholder="VD: Ra m·∫Øt s·∫£n ph·∫©m m·ªõi, khuy·∫øn m√£i 50%, tips kinh doanh online...">
          </div>

          <div class="grid-2">
            <div class="field">
              <div class="field-label"><i class="bi bi-chat-quote"></i> Gi·ªçng vƒÉn</div>
              <select id="ai-tone" class="gz-select">
                <option value="professional">üé© Chuy√™n nghi·ªáp</option>
                <option value="friendly" selected>üòä Th√¢n thi·ªán</option>
                <option value="exciting">üî• H√†o h·ª©ng</option>
                <option value="informative">üìö Th√¥ng tin</option>
                <option value="humorous">üòÑ H√†i h∆∞·ªõc</option>
                <option value="urgent">‚ö° Kh·∫©n c·∫•p</option>
                <option value="storytelling">üìñ K·ªÉ chuy·ªán</option>
              </select>
            </div>
            <div class="field">
              <div class="field-label"><i class="bi bi-building"></i> Ng√†nh ngh·ªÅ</div>
              <select id="ai-industry" class="gz-select">
                <option value="general" selected>üåê T·ªïng qu√°t</option>
                <option value="ecommerce">üõí Th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠</option>
                <option value="food">üçú ·∫®m th·ª±c & Nh√† h√†ng</option>
                <option value="fashion">üëó Th·ªùi trang</option>
                <option value="tech">üíª C√¥ng ngh·ªá</option>
                <option value="beauty">üíÑ L√†m ƒë·∫πp & Spa</option>
                <option value="education">üéì Gi√°o d·ª•c</option>
                <option value="realestate">üè† B·∫•t ƒë·ªông s·∫£n</option>
                <option value="fitness">üí™ Th·ªÉ h√¨nh & S·ª©c kh·ªèe</option>
                <option value="travel">‚úàÔ∏è Du l·ªãch</option>
                <option value="finance">üí≥ T√†i ch√≠nh</option>
              </select>
            </div>
          </div>

          <div class="field">
            <div class="field-label"><i class="bi bi-rulers"></i> ƒê·ªô d√†i b√†i vi·∫øt</div>
            <div class="tab-bar">
              <button class="tab-btn active" id="len-short" onclick="setLen('short')">Ng·∫Øn ~100 t·ª´</button>
              <button class="tab-btn" id="len-medium" onclick="setLen('medium')">V·ª´a ~200 t·ª´</button>
              <button class="tab-btn" id="len-long" onclick="setLen('long')">D√†i ~400 t·ª´</button>
            </div>
          </div>

          <div class="flex gap-3">
            <button class="btn btn-ai" style="flex:1;" onclick="runAI()" id="btn-ai">
              <i class="bi bi-magic"></i> T·∫°o n·ªôi dung v·ªõi AI
            </button>
            <button class="btn btn-ghost" onclick="runHashtag()" id="btn-hashtag">
              <i class="bi bi-hash"></i> Hashtag
            </button>
          </div>

          <!-- AI loading -->
          <div id="ai-loading" class="hidden" style="text-align:center;padding:12px 0;">
            <div class="typing" style="justify-content:center;">
              <span></span><span></span><span></span>
            </div>
            <p class="text-sm text-muted">AI ƒëang t·∫°o n·ªôi dung...</p>
          </div>

          <!-- AI results -->
          <div id="ai-results" class="hidden mt-3">
            <div class="field-label" style="margin-bottom:10px;"><i class="bi bi-stars"></i> Nh·∫•p v√†o phi√™n b·∫£n b·∫°n mu·ªën d√πng</div>
            <div id="ai-list"></div>
          </div>
        </div>

      </div><!-- /left-col -->

      <!-- RIGHT COL -->
      <div class="right-col">

        <!-- Schedule card -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background:rgba(245,158,11,0.15);color:#fbbf24;"><i class="bi bi-calendar3"></i></div>
            <div class="card-title">L√™n l·ªãch ƒëƒÉng b√†i</div>
          </div>
          <div class="card-sub">Ch·ªçn th·ªùi ƒëi·ªÉm ƒëƒÉng ho·∫∑c ƒëƒÉng ngay l·∫≠p t·ª©c</div>

          <div class="toggle-row" style="margin-bottom:16px;">
            <label class="toggle-wrap">
              <input type="checkbox" id="toggle-schedule" onchange="onToggleSchedule()">
              <span class="toggle-track"></span>
            </label>
            <span class="toggle-label">L√™n l·ªãch ƒëƒÉng sau</span>
          </div>

          <div id="schedule-fields" class="hidden">
            <div class="field">
              <div class="field-label"><i class="bi bi-calendar-event"></i> Ng√†y ƒëƒÉng</div>
              <input type="date" id="sch-date" class="gz-input" onchange="updateSchPreview()">
            </div>
            <div class="field">
              <div class="field-label"><i class="bi bi-clock"></i> Gi·ªù ƒëƒÉng</div>
              <input type="time" id="sch-time" class="gz-input" onchange="updateSchPreview()">
            </div>

            <div class="field-label" style="margin-bottom:4px;"><i class="bi bi-star"></i> Gi·ªù v√†ng</div>
            <div class="time-chips">
              <span class="time-chip" onclick="setTime('08:00')">‚è∞ 8:00</span>
              <span class="time-chip" onclick="setTime('12:00')">‚è∞ 12:00</span>
              <span class="time-chip" onclick="setTime('18:00')">‚è∞ 18:00</span>
              <span class="time-chip" onclick="setTime('20:00')">‚è∞ 20:00</span>
              <span class="time-chip" onclick="setTime('21:30')">‚è∞ 21:30</span>
            </div>

            <div class="schedule-preview hidden" id="sch-preview">
              <i class="bi bi-calendar-check"></i>
              <span id="sch-preview-text"></span>
            </div>

            <hr class="divider">

            <div class="field">
              <div class="field-label"><i class="bi bi-arrow-repeat"></i> L·∫∑p l·∫°i</div>
              <select id="sch-repeat" class="gz-select">
                <option value="none">Kh√¥ng l·∫∑p l·∫°i</option>
                <option value="daily">H√†ng ng√†y</option>
                <option value="weekly">H√†ng tu·∫ßn</option>
                <option value="monthly">H√†ng th√°ng</option>
              </select>
            </div>
          </div>

          <div class="field">
            <div class="field-label"><i class="bi bi-layout-text-window"></i> Lo·∫°i b√†i ƒëƒÉng</div>
            <select id="post-type" class="gz-select">
              <option value="feed">üì∞ B√†i vi·∫øt th∆∞·ªùng (Feed)</option>
              <option value="story">üì± Story</option>
              <option value="reel">üé¨ Reels</option>
            </select>
          </div>

          <hr class="divider">

          <div style="display:flex;flex-direction:column;gap:8px;">
            <button class="btn btn-primary btn-lg btn-full" onclick="onPublish()" id="btn-publish">
              <i class="bi bi-send-fill"></i>
              <span id="btn-publish-text">ƒêƒÉng ngay</span>
            </button>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
              <button class="btn btn-ghost btn-full" onclick="saveDraft()">
                <i class="bi bi-save"></i> L∆∞u nh√°p
              </button>
              <button class="btn btn-ghost btn-full" onclick="openPreview()">
                <i class="bi bi-eye"></i> Xem tr∆∞·ªõc
              </button>
            </div>
          </div>
        </div>

        <!-- Tips card -->
        <div class="card cyan-glow">
          <div class="card-header">
            <div class="card-icon" style="background:rgba(0,212,255,0.12);color:#22d3ee;"><i class="bi bi-lightbulb"></i></div>
            <div class="card-title">M·∫πo ƒëƒÉng b√†i hi·ªáu qu·∫£</div>
          </div>
          <div class="card-sub">T·ªëi ∆∞u t∆∞∆°ng t√°c v·ªõi c√°c tips t·ª´ chuy√™n gia</div>
          <ul class="tips-list">
            <li><span class="dot">‚ú¶</span> ƒêƒÉng v√†o gi·ªù v√†ng: 8h, 12h, 18h, 20-21h</li>
            <li><span class="dot">‚ú¶</span> D√πng 3‚Äì5 hashtag li√™n quan, kh√¥ng spam</li>
            <li><span class="dot">‚ú¶</span> ·∫¢nh/video tƒÉng t∆∞∆°ng t√°c l√™n 3‚Äì5 l·∫ßn</li>
            <li><span class="dot">‚ú¶</span> ƒê·∫∑t c√¢u h·ªèi ƒë·ªÉ k√≠ch th√≠ch b√¨nh lu·∫≠n</li>
            <li><span class="dot">‚ú¶</span> Lu√¥n c√≥ Call-to-Action r√µ r√†ng</li>
            <li><span class="dot">‚ú¶</span> N·ªôi dung ng·∫Øn g·ªçn, s√∫c t√≠ch h∆°n l√† d√†i</li>
            <li><span class="dot">‚ú¶</span> ƒêƒÉng ƒë·ªÅu ƒë·∫∑n √≠t nh·∫•t 3‚Äì5 l·∫ßn/tu·∫ßn</li>
          </ul>
        </div>

      </div><!-- /right-col -->
    </div>
  </div><!-- /tab-create -->

  <!-- =========== TAB: L·ªäCH ƒêƒÇNG =========== -->
  <div id="tab-schedule" class="hidden">
    <div class="card">
      <div class="card-header">
        <div class="card-icon" style="background:rgba(245,158,11,0.15);color:#fbbf24;"><i class="bi bi-calendar3"></i></div>
        <div class="card-title">L·ªãch ƒëƒÉng b√†i s·∫Øp t·ªõi</div>
      </div>
      <div class="card-sub">Danh s√°ch b√†i vi·∫øt ƒëang ch·ªù ƒë∆∞·ª£c ƒëƒÉng t·ª± ƒë·ªông theo l·ªãch</div>
      <div class="scroll-list" id="list-scheduled">
        <div class="empty-state">
          <i class="bi bi-calendar-x"></i>
          <p>Ch∆∞a c√≥ b√†i vi·∫øt n√†o ƒë∆∞·ª£c l√™n l·ªãch</p>
          <button class="btn btn-primary" onclick="switchTab('create')">
            <i class="bi bi-plus-circle"></i> T·∫°o b√†i vi·∫øt m·ªõi
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- =========== TAB: L·ªäCH S·ª¨ =========== -->
  <div id="tab-history" class="hidden">
    <div class="card">
      <div class="card-header">
        <div class="card-icon" style="background:rgba(34,197,94,0.15);color:#4ade80;"><i class="bi bi-clock-history"></i></div>
        <div class="card-title">L·ªãch s·ª≠ ƒëƒÉng b√†i</div>
      </div>
      <div class="card-sub">T·∫•t c·∫£ b√†i vi·∫øt ƒë√£ ƒëƒÉng, th·∫•t b·∫°i ho·∫∑c l∆∞u nh√°p</div>
      <div class="tab-bar">
        <button class="tab-btn active" id="htab-all"    onclick="filterHistory('all')">T·∫•t c·∫£</button>
        <button class="tab-btn"        id="htab-posted" onclick="filterHistory('posted')">ƒê√£ ƒëƒÉng</button>
        <button class="tab-btn"        id="htab-failed" onclick="filterHistory('failed')">Th·∫•t b·∫°i</button>
        <button class="tab-btn"        id="htab-draft"  onclick="filterHistory('draft')">Nh√°p</button>
      </div>
      <div class="scroll-list" id="list-history">
        <div class="empty-state">
          <i class="bi bi-inbox"></i>
          <p>Ch∆∞a c√≥ l·ªãch s·ª≠ ƒëƒÉng b√†i</p>
        </div>
      </div>
    </div>
  </div>

  <!-- =========== TAB: TH·ªêNG K√ä =========== -->
  <div id="tab-analytics" class="hidden">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background:rgba(24,119,242,0.15);color:#60a5fa;"><i class="bi bi-bar-chart-line"></i></div>
          <div class="card-title">T·ªïng quan ho·∫°t ƒë·ªông</div>
        </div>
        <div class="card-sub">Th·ªëng k√™ to√†n b·ªô b√†i vi·∫øt</div>
        <div class="ana-row"><span class="ana-label">T·ªïng b√†i ƒë√£ t·∫°o</span><span class="ana-val" id="a-total">0</span></div>
        <div class="ana-row"><span class="ana-label">ƒê√£ ƒëƒÉng th√†nh c√¥ng</span><span class="ana-val" style="color:#4ade80;" id="a-posted">0</span></div>
        <div class="ana-row"><span class="ana-label">ƒêang l√™n l·ªãch</span><span class="ana-val" style="color:#fbbf24;" id="a-scheduled">0</span></div>
        <div class="ana-row"><span class="ana-label">Th·∫•t b·∫°i</span><span class="ana-val" style="color:#f87171;" id="a-failed">0</span></div>
        <div class="ana-row"><span class="ana-label">T·ª∑ l·ªá th√†nh c√¥ng</span><span class="ana-val" style="color:#22d3ee;" id="a-rate">0%</span></div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background:rgba(157,80,187,0.15);color:#c084fc;"><i class="bi bi-magic"></i></div>
          <div class="card-title">Th·ªëng k√™ AI</div>
        </div>
        <div class="card-sub">Hi·ªáu qu·∫£ s·ª≠ d·ª•ng AI</div>
        <div class="ana-row"><span class="ana-label">N·ªôi dung AI t·∫°o</span><span class="ana-val" id="a-ai">0</span></div>
        <div class="ana-row"><span class="ana-label">Hashtag g·ª£i √Ω</span><span class="ana-val" id="a-tags">0</span></div>
        <div class="ana-row"><span class="ana-label">Th·ªùi gian ti·∫øt ki·ªám</span><span class="ana-val" style="color:#22d3ee;" id="a-time">0 ph√∫t</span></div>
        <div style="margin-top:16px;padding:14px;background:rgba(157,80,187,0.07);border:1px solid rgba(157,80,187,0.2);border-radius:var(--radius-sm);">
          <p style="font-size:12px;color:#c084fc;">üí° M·ªói b√†i AI t·∫°o gi√∫p ti·∫øt ki·ªám trung b√¨nh <strong>15 ph√∫t</strong> so·∫°n th·∫£o</p>
        </div>
      </div>
    </div>
  </div>

  <!-- =========== TAB: C√ÄI ƒê·∫∂T =========== -->
  <div id="tab-settings" class="hidden">
    <div class="card" style="max-width:600px;">
      <div class="card-header">
        <div class="card-icon" style="background:rgba(148,163,184,0.12);color:#94a3b8;"><i class="bi bi-gear"></i></div>
        <div class="card-title">C√†i ƒë·∫∑t t·ª± ƒë·ªông ƒëƒÉng b√†i</div>
      </div>
      <div class="card-sub">T√πy ch·ªânh h√†nh vi c·ªßa h·ªá th·ªëng</div>

      <div class="setting-row">
        <div>
          <div class="setting-title">T·ª± ƒë·ªông th√™m hashtag</div>
          <div class="setting-desc">AI t·ª± g·ª£i √Ω v√† th√™m hashtag ph√π h·ª£p v√†o b√†i vi·∫øt</div>
        </div>
        <label class="toggle-wrap"><input type="checkbox" id="set-hashtag" checked><span class="toggle-track"></span></label>
      </div>
      <div class="setting-row">
        <div>
          <div class="setting-title">Th√¥ng b√°o khi ƒëƒÉng xong</div>
          <div class="setting-desc">Hi·ªán th√¥ng b√°o khi b√†i vi·∫øt ƒë∆∞·ª£c ƒëƒÉng th√†nh c√¥ng</div>
        </div>
        <label class="toggle-wrap"><input type="checkbox" id="set-notify" checked><span class="toggle-track"></span></label>
      </div>
      <div class="setting-row">
        <div>
          <div class="setting-title">T·ª± ƒë·ªông th·ª≠ l·∫°i khi th·∫•t b·∫°i</div>
          <div class="setting-desc">Th·ª≠ ƒëƒÉng l·∫°i t·ªëi ƒëa 3 l·∫ßn n·∫øu g·∫∑p l·ªói</div>
        </div>
        <label class="toggle-wrap"><input type="checkbox" id="set-retry" checked><span class="toggle-track"></span></label>
      </div>
      <div class="setting-row">
        <div>
          <div class="setting-title">Ng√¥n ng·ªØ AI m·∫∑c ƒë·ªãnh</div>
        </div>
        <select class="gz-select" style="width:160px;" id="set-lang">
          <option value="vi">üáªüá≥ Ti·∫øng Vi·ªát</option>
          <option value="en">üá∫üá∏ English</option>
        </select>
      </div>
      <div class="setting-row">
        <div>
          <div class="setting-title">M√∫i gi·ªù</div>
        </div>
        <select class="gz-select" style="width:220px;" id="set-tz">
          <option value="Asia/Ho_Chi_Minh">Vi·ªát Nam (UTC+7)</option>
          <option value="Asia/Bangkok">Th√°i Lan (UTC+7)</option>
          <option value="Asia/Singapore">Singapore (UTC+8)</option>
        </select>
      </div>
      <div style="margin-top:20px;">
        <button class="btn btn-primary" onclick="saveSettings()"><i class="bi bi-check-circle"></i> L∆∞u c√†i ƒë·∫∑t</button>
      </div>
    </div>
  </div>

</main><!-- /main -->

<!-- ===================== MODAL: CONNECT FACEBOOK ===================== -->
<div class="modal-bg hidden" id="modal-connect">
  <div class="modal-box" style="max-width:480px;">
    <button class="modal-close" onclick="closeModal('modal-connect')"><i class="bi bi-x-lg"></i></button>

    <!-- Tab switcher: ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω -->
    <div style="display:flex;gap:0;border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:20px;">
      <button id="tab-login-btn" onclick="switchAuthTab('login')" style="flex:1;padding:10px;background:rgba(99,102,241,0.2);border:none;color:#a5b4fc;font-weight:600;cursor:pointer;font-size:13px;">üîê ƒêƒÉng nh·∫≠p</button>
      <button id="tab-register-btn" onclick="switchAuthTab('register')" style="flex:1;padding:10px;background:transparent;border:none;color:var(--text-3);cursor:pointer;font-size:13px;">‚ú® ƒêƒÉng k√Ω</button>
    </div>

    <!-- STEP 1: ƒêƒÉng nh·∫≠p GenZTech -->
    <div id="step-login">
      <div style="text-align:center;margin-bottom:16px;">
        <div style="width:52px;height:52px;border-radius:14px;background:rgba(99,102,241,0.15);display:flex;align-items:center;justify-content:center;margin:0 auto 10px;">
          <i class="bi bi-shield-lock-fill" style="font-size:24px;color:#a5b4fc;"></i>
        </div>
        <div class="modal-title" style="font-size:18px;">ƒêƒÉng nh·∫≠p GenZTech</div>
        <div class="modal-sub">T√†i kho·∫£n b·∫£o m·∫≠t token Facebook c·ªßa b·∫°n</div>
      </div>
      <div class="glow-line"></div>
      <div class="field" style="margin-top:14px;">
        <div class="field-label"><i class="bi bi-person"></i> Username</div>
        <input id="gz-username" class="gz-input" type="text" placeholder="Nh·∫≠p username..." style="width:100%;">
      </div>
      <div class="field">
        <div class="field-label"><i class="bi bi-lock"></i> Password</div>
        <input id="gz-password" class="gz-input" type="password" placeholder="Nh·∫≠p password..." style="width:100%;">
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:16px;">
        <button class="btn btn-primary btn-full" onclick="doLogin()">
          <i class="bi bi-box-arrow-in-right"></i> ƒêƒÉng nh·∫≠p
        </button>
        <button class="btn btn-ghost btn-full" onclick="closeModal('modal-connect')">H·ªßy</button>
      </div>
      <p style="font-size:11px;color:var(--text-3);text-align:center;margin-top:12px;">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" onclick="switchAuthTab('register')" style="color:#a5b4fc;">ƒêƒÉng k√Ω ngay</a></p>
    </div>

    <!-- STEP 1b: ƒêƒÉng k√Ω -->
    <div id="step-register" class="hidden">
      <div style="text-align:center;margin-bottom:16px;">
        <div style="width:52px;height:52px;border-radius:14px;background:rgba(34,197,94,0.12);display:flex;align-items:center;justify-content:center;margin:0 auto 10px;">
          <i class="bi bi-person-plus-fill" style="font-size:24px;color:#4ade80;"></i>
        </div>
        <div class="modal-title" style="font-size:18px;">T·∫°o t√†i kho·∫£n</div>
        <div class="modal-sub">ƒêƒÉng k√Ω ƒë·ªÉ s·ª≠ d·ª•ng ƒë·∫ßy ƒë·ªß t√≠nh nƒÉng</div>
      </div>
      <div class="glow-line"></div>
      <div class="field" style="margin-top:14px;">
        <div class="field-label"><i class="bi bi-person"></i> Username</div>
        <input id="reg-username" class="gz-input" type="text" placeholder="Ch·ªçn username..." style="width:100%;">
      </div>
      <div class="field">
        <div class="field-label"><i class="bi bi-lock"></i> Password (t·ªëi thi·ªÉu 6 k√Ω t·ª±)</div>
        <input id="reg-password" class="gz-input" type="password" placeholder="T·∫°o password..." style="width:100%;">
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:16px;">
        <button class="btn btn-primary btn-full" onclick="doRegister()" style="background:rgba(34,197,94,0.2);border-color:rgba(34,197,94,0.4);color:#4ade80;">
          <i class="bi bi-check-circle"></i> ƒêƒÉng k√Ω
        </button>
        <button class="btn btn-ghost btn-full" onclick="closeModal('modal-connect')">H·ªßy</button>
      </div>
    </div>

    <!-- STEP 2: K·∫øt n·ªëi Facebook (sau khi ƒëƒÉng nh·∫≠p) -->
    <div id="step-facebook" class="hidden">
      <div style="text-align:center;margin-bottom:16px;">
        <div style="width:52px;height:52px;border-radius:14px;background:rgba(24,119,242,0.15);display:flex;align-items:center;justify-content:center;margin:0 auto 10px;">
          <i class="bi bi-facebook" style="font-size:24px;color:#60a5fa;"></i>
        </div>
        <div class="modal-title" style="font-size:18px;">K·∫øt n·ªëi Facebook</div>
        <div class="modal-sub">Token s·∫Ω ƒë∆∞·ª£c l∆∞u b·∫£o m·∫≠t tr√™n server ‚Äî t·ª± ƒë·ªông gia h·∫°n</div>
      </div>
      <div class="glow-line"></div>

      <!-- Token status banner (hi·ªán khi ƒë√£ k·∫øt n·ªëi) -->
      <div id="token-status-banner" class="hidden" style="background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.25);border-radius:10px;padding:12px 14px;margin:12px 0;">
        <div style="display:flex;align-items:center;gap:10px;">
          <i class="bi bi-check-circle-fill" style="color:#4ade80;font-size:18px;"></i>
          <div>
            <div id="token-status-name" style="font-size:13px;font-weight:600;color:#4ade80;"></div>
            <div id="token-status-expiry" style="font-size:11px;color:var(--text-3);"></div>
          </div>
          <button onclick="doRefreshToken()" style="margin-left:auto;padding:5px 10px;background:rgba(34,197,94,0.15);border:1px solid rgba(34,197,94,0.3);border-radius:6px;color:#4ade80;font-size:11px;cursor:pointer;">
            <i class="bi bi-arrow-clockwise"></i> Gia h·∫°n
          </button>
        </div>
      </div>

      <!-- Warning banner khi token s·∫Øp h·∫øt -->
      <div id="token-warning-banner" class="hidden" style="background:rgba(251,191,36,0.08);border:1px solid rgba(251,191,36,0.3);border-radius:10px;padding:12px 14px;margin:12px 0;">
        <div style="display:flex;align-items:center;gap:8px;">
          <i class="bi bi-exclamation-triangle-fill" style="color:#fbbf24;"></i>
          <span id="token-warning-text" style="font-size:12px;color:#fbbf24;"></span>
          <button onclick="doRefreshToken()" style="margin-left:auto;padding:5px 10px;background:rgba(251,191,36,0.15);border:1px solid rgba(251,191,36,0.3);border-radius:6px;color:#fbbf24;font-size:11px;cursor:pointer;">Gia h·∫°n ngay</button>
        </div>
      </div>

      <div class="field" style="margin-top:12px;">
        <div class="field-label"><i class="bi bi-key"></i> Facebook Access Token</div>
        <textarea id="fb-token" class="gz-textarea" rows="3"
          placeholder="D√°n Access Token v√†o ƒë√¢y...&#10;&#10;L·∫•y token t·∫°i: developers.facebook.com/tools/explorer"></textarea>
        <p style="font-size:11px;color:var(--text-3);margin-top:6px;">
          <i class="bi bi-shield-check"></i> Token ƒë∆∞·ª£c m√£ h√≥a v√† l∆∞u tr√™n server ‚Äî t·ª± ƒë·ªông gia h·∫°n m·ªói 15 ng√†y
        </p>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;">
        <button class="btn btn-primary btn-full" onclick="doConnect()">
          <i class="bi bi-plug"></i> K·∫øt n·ªëi
        </button>
        <button class="btn btn-ghost btn-full" onclick="doLogout()"><i class="bi bi-box-arrow-right"></i> ƒêƒÉng xu·∫•t</button>
      </div>

      <div style="background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px;">
        <p style="font-size:12px;font-weight:600;color:var(--text-2);margin-bottom:8px;">üìã C√°ch l·∫•y Access Token:</p>
        <ol style="font-size:12px;color:var(--text-3);line-height:1.8;padding-left:16px;">
          <li>Truy c·∫≠p <a href="https://developers.facebook.com/tools/explorer" target="_blank" style="color:#60a5fa;">Graph API Explorer</a></li>
          <li>Ch·ªçn App ‚Üí c·∫•p quy·ªÅn <code style="color:#c084fc;">pages_manage_posts</code></li>
          <li>Nh·∫•n <strong>Generate Access Token</strong></li>
          <li>Copy token v√† d√°n v√†o √¥ tr√™n</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<!-- ===================== MODAL: PREVIEW ===================== -->
<div class="modal-bg hidden" id="modal-preview">
  <div class="modal-box" style="max-width:500px;">
    <button class="modal-close" onclick="closeModal('modal-preview')"><i class="bi bi-x-lg"></i></button>
    <div class="modal-title" style="margin-bottom:16px;">Xem tr∆∞·ªõc b√†i vi·∫øt</div>

    <div class="fb-preview">
      <div class="fb-preview-header">
        <div class="fb-avatar"><i class="bi bi-person-fill" style="color:#fff;"></i></div>
        <div>
          <div class="fb-page-name" id="pv-page">Trang Facebook c·ªßa b·∫°n</div>
          <div class="fb-meta">V·ª´a xong ¬∑ üåê</div>
        </div>
      </div>
      <div class="fb-content" id="pv-content">N·ªôi dung b√†i vi·∫øt s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...</div>
      <img id="pv-image" src="" alt="" style="display:none;width:100%;border-radius:8px;margin-top:12px;max-height:240px;object-fit:cover;">
      <div id="pv-link" style="display:none;margin-top:10px;padding:10px 12px;background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:8px;">
        <p style="font-size:12px;color:#60a5fa;" id="pv-link-url"></p>
      </div>
      <div class="fb-actions">
        <span class="fb-action"><i class="bi bi-hand-thumbs-up"></i> Th√≠ch</span>
        <span class="fb-action"><i class="bi bi-chat"></i> B√¨nh lu·∫≠n</span>
        <span class="fb-action"><i class="bi bi-share"></i> Chia s·∫ª</span>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:16px;">
      <button class="btn btn-primary btn-full" onclick="onPublish();closeModal('modal-preview')">
        <i class="bi bi-send-fill"></i> ƒêƒÉng b√†i
      </button>
      <button class="btn btn-ghost btn-full" onclick="closeModal('modal-preview')">ƒê√≥ng</button>
    </div>
  </div>
</div>

<!-- ===================== SCRIPTS ===================== -->
<script>
// ============================================================
//  CONFIG
// ============================================================
const API_BASE = localStorage.getItem('gz_api_base') || 'https://genztech-production.up.railway.app';
// ƒê·ªÉ test local: localStorage.setItem('gz_api_base', 'http://localhost:3001')

// ============================================================
//  STATE
// ============================================================
const S = {
  // Auth
  jwtToken:  localStorage.getItem('gz_jwt') || '',
  username:  localStorage.getItem('gz_username') || '',
  loggedIn:  !!localStorage.getItem('gz_jwt'),
  // Facebook
  connected: false,
  fbUser:    null,
  pages:     JSON.parse(localStorage.getItem('gz_pages') || '[]'),
  page:      JSON.parse(localStorage.getItem('gz_page') || 'null'),
  tokenExpiry: null,
  // Posts (local cache)
  posts:     JSON.parse(localStorage.getItem('gz_posts') || '[]'),
  aiLen:     'short',
  aiCount:   0,
  tagCount:  0,
};

// ============================================================
//  API HELPER
// ============================================================
async function api(method, path, body = null) {
  const opts = {
    method,
    headers: { 'Content-Type': 'application/json' },
  };
  if (S.jwtToken) opts.headers['Authorization'] = 'Bearer ' + S.jwtToken;
  if (body) opts.body = JSON.stringify(body);
  const res = await fetch(API_BASE + path, opts);
  const data = await res.json();
  if (!res.ok) throw new Error(data.error || 'Request failed');
  return data;
}

// ============================================================
//  INIT
// ============================================================
document.addEventListener('DOMContentLoaded', async () => {
  initCursor();
  initCanvas();

  // Default date/time
  const d = new Date(); d.setHours(d.getHours()+1);
  document.getElementById('sch-date').value = d.toISOString().split('T')[0];
  document.getElementById('sch-time').value = d.toTimeString().slice(0,5);

  if (S.loggedIn) {
    // ƒê√£ ƒëƒÉng nh·∫≠p: ki·ªÉm tra tr·∫°ng th√°i Facebook
    await checkFbStatus();
    await loadServerPosts();
  }

  refreshStats();
  renderScheduled();
  renderHistory('all');
  refreshAnalytics();

  // Auto-check scheduler (server ƒë√£ x·ª≠ l√Ω, frontend ch·ªâ c·∫≠p nh·∫≠t UI)
  setInterval(loadServerPosts, 60000);
  // Ki·ªÉm tra token h·∫øt h·∫°n m·ªói 10 ph√∫t
  setInterval(checkTokenExpiry, 600000);
});

// ============================================================
//  AUTH TAB SWITCHER
// ============================================================
function switchAuthTab(tab) {
  const isLogin = tab === 'login';
  document.getElementById('step-login').classList.toggle('hidden', !isLogin);
  document.getElementById('step-register').classList.toggle('hidden', isLogin);
  document.getElementById('step-facebook').classList.add('hidden');
  document.getElementById('tab-login-btn').style.background = isLogin ? 'rgba(99,102,241,0.2)' : 'transparent';
  document.getElementById('tab-login-btn').style.color = isLogin ? '#a5b4fc' : 'var(--text-3)';
  document.getElementById('tab-register-btn').style.background = !isLogin ? 'rgba(34,197,94,0.15)' : 'transparent';
  document.getElementById('tab-register-btn').style.color = !isLogin ? '#4ade80' : 'var(--text-3)';
}

// ============================================================
//  ƒêƒÇNG NH·∫¨P
// ============================================================
async function doLogin() {
  const username = document.getElementById('gz-username').value.trim();
  const password = document.getElementById('gz-password').value.trim();
  if (!username || !password) { toast('Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin', 'error'); return; }

  try {
    toast('ƒêang ƒëƒÉng nh·∫≠p...', 'info');
    const data = await api('POST', '/api/auth/login', { username, password });
    S.jwtToken = data.token;
    S.username = data.username;
    S.loggedIn = true;
    localStorage.setItem('gz_jwt', data.token);
    localStorage.setItem('gz_username', data.username);
    toast(`Ch√†o ${data.username}! ƒêƒÉng nh·∫≠p th√†nh c√¥ng`, 'success');
    // Chuy·ªÉn sang step k·∫øt n·ªëi Facebook
    showFacebookStep();
    await checkFbStatus();
  } catch (err) {
    toast(err.message, 'error');
  }
}

// ============================================================
//  ƒêƒÇNG K√ù
// ============================================================
async function doRegister() {
  const username = document.getElementById('reg-username').value.trim();
  const password = document.getElementById('reg-password').value.trim();
  if (!username || !password) { toast('Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin', 'error'); return; }

  try {
    toast('ƒêang t·∫°o t√†i kho·∫£n...', 'info');
    const data = await api('POST', '/api/auth/register', { username, password });
    S.jwtToken = data.token;
    S.username = data.username;
    S.loggedIn = true;
    localStorage.setItem('gz_jwt', data.token);
    localStorage.setItem('gz_username', data.username);
    toast(`T√†i kho·∫£n ƒë√£ t·∫°o! Ch√†o ${data.username}`, 'success');
    showFacebookStep();
  } catch (err) {
    toast(err.message, 'error');
  }
}

// ============================================================
//  ƒêƒÇNG XU·∫§T
// ============================================================
function doLogout() {
  S.jwtToken = ''; S.username = ''; S.loggedIn = false;
  S.connected = false; S.fbUser = null; S.pages = []; S.page = null;
  localStorage.removeItem('gz_jwt'); localStorage.removeItem('gz_username');
  localStorage.removeItem('gz_pages'); localStorage.removeItem('gz_page');
  updateConnUI(null);
  closeModal('modal-connect');
  toast('ƒê√£ ƒëƒÉng xu·∫•t', 'info');
}

function showFacebookStep() {
  document.getElementById('step-login').classList.add('hidden');
  document.getElementById('step-register').classList.add('hidden');
  document.getElementById('step-facebook').classList.remove('hidden');
  document.getElementById('tab-login-btn').parentElement.style.display = 'none';
}

// ============================================================
//  BACKGROUND ENGINE (identical to homepage)
// ============================================================
function initCursor() {}
function initCanvas() {}

(function initBackground() {
  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
  const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

  // ---- MULTI-LAYER STARFIELD ----
  const canvasFar  = document.getElementById('starfield-far');
  const canvasMid  = document.getElementById('starfield-mid');
  const canvasNear = document.getElementById('starfield-near');
  const ctxFar  = canvasFar.getContext('2d');
  const ctxMid  = canvasMid.getContext('2d');
  const ctxNear = canvasNear.getContext('2d');

  function resizeCanvases() {
    [canvasFar, canvasMid, canvasNear].forEach(c => {
      c.width  = window.innerWidth;
      c.height = window.innerHeight;
    });
  }
  resizeCanvases();
  window.addEventListener('resize', resizeCanvases);

  const mult = isMobile ? 0.5 : 1;

  const starsFar = Array.from({length: Math.floor(200*mult)}, () => ({
    x: Math.random()*canvasFar.width, y: Math.random()*canvasFar.height,
    radius: Math.random()*0.8+0.2, opacity: Math.random()*0.3+0.2
  }));

  const starsMid = Array.from({length: Math.floor(100*mult)}, () => ({
    x: Math.random()*canvasMid.width, y: Math.random()*canvasMid.height,
    radius: Math.random()*1.2+0.5,
    vx: (Math.random()-0.5)*(isMobile?0.1:0.2),
    vy: (Math.random()-0.5)*(isMobile?0.1:0.2),
    opacity: Math.random()*0.5+0.3
  }));

  const starsNear = Array.from({length: Math.floor(50*mult)}, () => ({
    x: Math.random()*canvasNear.width, y: Math.random()*canvasNear.height,
    radius: Math.random()*1.8+0.8,
    vx: (Math.random()-0.5)*(isMobile?0.2:0.4),
    vy: (Math.random()-0.5)*(isMobile?0.2:0.4),
    opacity: Math.random()*0.7+0.3,
    pulse: Math.random()*Math.PI*2
  }));

  // Shooting Stars
  const shootingStars = [];
  let lastShootingStarTime = 0;

  class ShootingStar {
    constructor() { this.reset(); }
    reset() {
      this.length = Math.random()*200+100;
      this.speed  = Math.random()*2+1;
      this.size   = Math.random()*2+1.5;
      this.dirX   = Math.random()<0.5 ? 1 : -1;
      this.x      = this.dirX===1 ? -100 : canvasFar.width+100;
      this.y      = Math.random()*canvasFar.height*0.5;
      this.vx     = this.dirX*this.speed;
      this.vy     = this.speed*0.5;
      this.opacity= 0; this.life=0; this.maxLife=200; this.active=true;
    }
    update() {
      this.x+=this.vx; this.y+=this.vy; this.life++;
      if(this.life<20) this.opacity=this.life/20;
      else if(this.life>this.maxLife-40) this.opacity=(this.maxLife-this.life)/40;
      else this.opacity=1;
      if(this.life>=this.maxLife||this.x<-300||this.x>canvasFar.width+300||this.y>canvasFar.height+300) this.active=false;
    }
    draw(ctx) {
      if(!this.active) return;
      const tx=this.x-this.vx*(this.length/this.speed), ty=this.y-this.vy*(this.length/this.speed);
      const g=ctx.createLinearGradient(this.x,this.y,tx,ty);
      g.addColorStop(0,`rgba(255,255,255,${this.opacity})`); g.addColorStop(1,'rgba(255,255,255,0)');
      ctx.strokeStyle=g; ctx.lineWidth=this.size; ctx.lineCap='round';
      ctx.beginPath(); ctx.moveTo(this.x,this.y); ctx.lineTo(tx,ty); ctx.stroke();
      ctx.fillStyle=`rgba(255,255,255,${this.opacity})`;
      ctx.beginPath(); ctx.arc(this.x,this.y,this.size*1.5,0,Math.PI*2); ctx.fill();
      ctx.fillStyle=`rgba(100,200,255,${this.opacity*0.5})`;
      ctx.beginPath(); ctx.arc(this.x,this.y,this.size*5,0,Math.PI*2); ctx.fill();
    }
  }

  function animateStarfield() {
    ctxFar.clearRect(0,0,canvasFar.width,canvasFar.height);
    starsFar.forEach(s => {
      ctxFar.fillStyle=`rgba(255,255,255,${s.opacity})`;
      ctxFar.beginPath(); ctxFar.arc(s.x,s.y,s.radius,0,Math.PI*2); ctxFar.fill();
    });
    const now=Date.now();
    if(now-lastShootingStarTime>(Math.random()*1000+500)) {
      if(shootingStars.length<8){ shootingStars.push(new ShootingStar()); lastShootingStarTime=now; }
    }
    ctxMid.clearRect(0,0,canvasMid.width,canvasMid.height);
    for(let i=shootingStars.length-1;i>=0;i--) {
      shootingStars[i].update(); shootingStars[i].draw(ctxMid);
      if(!shootingStars[i].active) shootingStars.splice(i,1);
    }
    starsMid.forEach(s => {
      s.x=(s.x+s.vx+canvasMid.width)%canvasMid.width;
      s.y=(s.y+s.vy+canvasMid.height)%canvasMid.height;
      ctxMid.fillStyle=`rgba(255,255,255,${s.opacity})`;
      ctxMid.beginPath(); ctxMid.arc(s.x,s.y,s.radius,0,Math.PI*2); ctxMid.fill();
    });
    ctxNear.clearRect(0,0,canvasNear.width,canvasNear.height);
    starsNear.forEach(s => {
      s.x=(s.x+s.vx+canvasNear.width)%canvasNear.width;
      s.y=(s.y+s.vy+canvasNear.height)%canvasNear.height;
      s.pulse+=(isMobile?0.01:0.02);
      const po=s.opacity*(0.7+Math.sin(s.pulse)*0.3);
      if(isMobile) {
        ctxNear.fillStyle=`rgba(24,119,242,${po})`;
        ctxNear.beginPath(); ctxNear.arc(s.x,s.y,s.radius,0,Math.PI*2); ctxNear.fill();
      } else {
        const g=ctxNear.createRadialGradient(s.x,s.y,0,s.x,s.y,s.radius*3);
        g.addColorStop(0,`rgba(24,119,242,${po})`); g.addColorStop(0.5,`rgba(0,212,255,${po*0.5})`); g.addColorStop(1,'rgba(0,212,255,0)');
        ctxNear.fillStyle=g; ctxNear.beginPath(); ctxNear.arc(s.x,s.y,s.radius*3,0,Math.PI*2); ctxNear.fill();
      }
    });
    requestAnimationFrame(animateStarfield);
  }
  animateStarfield();

  // ---- CONSTELLATION LINES ----
  const canvasCon = document.getElementById('constellation-lines');
  const ctxCon = canvasCon.getContext('2d');
  canvasCon.width=window.innerWidth; canvasCon.height=window.innerHeight;
  let conPoints=[];
  function initConPoints() {
    conPoints=[];
    const n=isMobile?8:15;
    for(let i=0;i<n;i++) conPoints.push({x:Math.random()*canvasCon.width,y:Math.random()*canvasCon.height,connections:[]});
    conPoints.forEach((p,i)=>{
      const nc=Math.floor(Math.random()*2)+1;
      for(let j=0;j<nc;j++) p.connections.push(Math.floor(Math.random()*conPoints.length));
    });
  }
  initConPoints();
  let conOp=0;
  function animateCon() {
    ctxCon.clearRect(0,0,canvasCon.width,canvasCon.height);
    if(!isMobile) {
      conOp=Math.min(conOp+0.02,0.3);
      if(conOp>0) {
        conPoints.forEach((p,i)=>{
          p.connections.forEach(ti=>{
            const t=conPoints[ti];
            const g=ctxCon.createLinearGradient(p.x,p.y,t.x,t.y);
            g.addColorStop(0,`rgba(24,119,242,${conOp})`); g.addColorStop(0.5,`rgba(0,212,255,${conOp*0.7})`); g.addColorStop(1,`rgba(138,43,226,${conOp*0.5})`);
            ctxCon.strokeStyle=g; ctxCon.lineWidth=0.5;
            ctxCon.beginPath(); ctxCon.moveTo(p.x,p.y); ctxCon.lineTo(t.x,t.y); ctxCon.stroke();
          });
        });
      }
    }
    requestAnimationFrame(animateCon);
  }
  animateCon();

  // ---- DATA PARTICLES ----
  const canvasDP = document.getElementById('data-particles');
  const ctxDP = canvasDP.getContext('2d');
  canvasDP.width=window.innerWidth; canvasDP.height=window.innerHeight;
  const dpCount=isMobile?15:30;
  const dataParticles=Array.from({length:dpCount},()=>({
    x:Math.random()*canvasDP.width, y:Math.random()*canvasDP.height,
    radius:Math.random()*2+1,
    path:{centerX:Math.random()*canvasDP.width,centerY:Math.random()*canvasDP.height,
      radiusX:Math.random()*(isMobile?50:100)+(isMobile?25:50),
      radiusY:Math.random()*(isMobile?50:100)+(isMobile?25:50),
      angle:Math.random()*Math.PI*2,
      speed:Math.random()*(isMobile?0.005:0.01)+(isMobile?0.003:0.005)},
    pulse:Math.random()*Math.PI*2, pulseSpeed:Math.random()*0.02+0.01
  }));
  function animateDP() {
    ctxDP.clearRect(0,0,canvasDP.width,canvasDP.height);
    dataParticles.forEach(p=>{
      p.path.angle+=p.path.speed;
      p.x=p.path.centerX+Math.cos(p.path.angle)*p.path.radiusX;
      p.y=p.path.centerY+Math.sin(p.path.angle)*p.path.radiusY;
      p.pulse+=p.pulseSpeed;
      const ps=1+Math.sin(p.pulse)*0.5;
      if(isMobile){
        ctxDP.fillStyle=`rgba(24,119,242,${0.6*ps})`;
        ctxDP.beginPath(); ctxDP.arc(p.x,p.y,p.radius*ps,0,Math.PI*2); ctxDP.fill();
      } else {
        const g=ctxDP.createRadialGradient(p.x,p.y,0,p.x,p.y,p.radius*ps*3);
        g.addColorStop(0,`rgba(24,119,242,${0.8*ps})`); g.addColorStop(0.5,`rgba(0,212,255,${0.4*ps})`); g.addColorStop(1,'rgba(0,212,255,0)');
        ctxDP.fillStyle=g; ctxDP.beginPath(); ctxDP.arc(p.x,p.y,p.radius*ps*3,0,Math.PI*2); ctxDP.fill();
      }
    });
    requestAnimationFrame(animateDP);
  }
  animateDP();

  // ---- CUSTOM CURSOR ----
  const cursor = document.getElementById('custom-cursor');
  if(cursor && !isTouchDevice) {
    let mouseX=0,mouseY=0,cursorX=0,cursorY=0,isMoving=false,isHover=false;
    document.body.style.cursor='none';
    document.addEventListener('mousemove',e=>{
      mouseX=e.clientX; mouseY=e.clientY;
      if(!isMoving){ isMoving=true; cursor.style.opacity='1'; }
    });
    document.addEventListener('mouseleave',()=>{ isMoving=false; cursor.style.opacity='0'; });
    document.addEventListener('mousedown',()=>{
      if(typeof gsap!=='undefined') gsap.to(cursor,{scale:0.85,duration:0.15,ease:'power2.out'});
      else cursor.style.transform='translate(-50%,-50%) scale(0.85)';
    });
    document.addEventListener('mouseup',()=>{
      const sc=isHover?1.2:1;
      if(typeof gsap!=='undefined') gsap.to(cursor,{scale:sc,duration:0.2,ease:'power2.out'});
      else cursor.style.transform=`translate(-50%,-50%) scale(${sc})`;
    });
    function animCursor(){
      if(isMoving){
        cursorX+=(mouseX-cursorX)*0.15; cursorY+=(mouseY-cursorY)*0.15;
        cursor.style.left=cursorX+'px'; cursor.style.top=cursorY+'px';
      }
      requestAnimationFrame(animCursor);
    }
    animCursor();
    document.querySelectorAll('a,button,input,textarea,select,.card,.nav-item').forEach(el=>{
      el.addEventListener('mouseenter',()=>{ isHover=true; if(typeof gsap!=='undefined') gsap.to(cursor,{scale:1.2,duration:0.3,ease:'back.out(1.7)'}); });
      el.addEventListener('mouseleave',()=>{ isHover=false; if(typeof gsap!=='undefined') gsap.to(cursor,{scale:1,duration:0.3,ease:'power2.out'}); });
    });
  } else if(cursor) {
    cursor.style.display='none';
    document.body.style.cursor='auto';
  }
})();

// ============================================================
//  TABS
// ============================================================
const TABS = ['create','schedule','history','analytics','settings'];
function switchTab(t) {
  TABS.forEach(id => {
    document.getElementById('tab-'+id).classList.toggle('hidden', id!==t);
    const nav = document.getElementById('nav-'+id);
    if (nav) nav.classList.toggle('active', id===t);
  });
}

// ============================================================
//  CONTENT INPUT
// ============================================================
function onContentInput() {
  const len = document.getElementById('post-content').value.length;
  const el  = document.getElementById('char-count');
  el.textContent = `${len.toLocaleString('vi-VN')} / 63,206 k√Ω t·ª±`;
  el.className = 'char-counter' + (len>50000?' danger':len>40000?' warn':'');
}

// ============================================================
//  EMOJI
// ============================================================
function addEmoji(e) {
  const ta = document.getElementById('post-content');
  const s = ta.selectionStart, end = ta.selectionEnd;
  ta.value = ta.value.slice(0,s) + e + ta.value.slice(end);
  ta.selectionStart = ta.selectionEnd = s + e.length;
  ta.focus(); onContentInput();
}

// ============================================================
//  IMAGE
// ============================================================
function onImageSelect(ev) {
  const f = ev.target.files[0]; if (!f) return;
  const r = new FileReader();
  r.onload = e => {
    const zone = document.getElementById('upload-zone');
    const img  = document.getElementById('img-preview');
    const ph   = document.getElementById('upload-placeholder');
    img.src = e.target.result;
    img.style.display = 'block';
    ph.style.display  = 'none';
    zone.classList.add('has-image');
    document.getElementById('btn-remove-img').classList.remove('hidden');
  };
  r.readAsDataURL(f);
}
function removeImage() {
  document.getElementById('img-file').value = '';
  document.getElementById('img-preview').style.display = 'none';
  document.getElementById('upload-placeholder').style.display = 'block';
  document.getElementById('upload-zone').classList.remove('has-image');
  document.getElementById('btn-remove-img').classList.add('hidden');
}

// ============================================================
//  SCHEDULE TOGGLE
// ============================================================
function onToggleSchedule() {
  const on = document.getElementById('toggle-schedule').checked;
  document.getElementById('schedule-fields').classList.toggle('hidden', !on);
  document.getElementById('btn-publish-text').textContent = on ? 'L√™n l·ªãch ƒëƒÉng b√†i' : 'ƒêƒÉng ngay';
  if (on) updateSchPreview();
}
function updateSchPreview() {
  const d = document.getElementById('sch-date').value;
  const t = document.getElementById('sch-time').value;
  const box = document.getElementById('sch-preview');
  if (d && t) {
    const dt = new Date(d+'T'+t);
    document.getElementById('sch-preview-text').textContent =
      `S·∫Ω ƒëƒÉng v√†o ${dt.toLocaleDateString('vi-VN',{weekday:'long',day:'numeric',month:'long',year:'numeric'})} l√∫c ${t}`;
    box.classList.remove('hidden');
  }
}
function setTime(t) {
  document.getElementById('sch-time').value = t;
  updateSchPreview();
}

// ============================================================
//  AI LENGTH
// ============================================================
function setLen(l) {
  S.aiLen = l;
  ['short','medium','long'].forEach(x =>
    document.getElementById('len-'+x).classList.toggle('active', x===l)
  );
}

// ============================================================
//  AI CONTENT
// ============================================================
async function runAI() {
  const topic = document.getElementById('ai-topic').value.trim();
  if (!topic) { toast('Vui l√≤ng nh·∫≠p ch·ªß ƒë·ªÅ b√†i vi·∫øt', 'error'); return; }

  const tone     = document.getElementById('ai-tone').value;
  const industry = document.getElementById('ai-industry').value;
  const lenMap   = { short:'80-120 t·ª´', medium:'180-220 t·ª´', long:'350-420 t·ª´' };
  const toneMap  = {
    professional:'chuy√™n nghi·ªáp, l·ªãch s·ª±', friendly:'th√¢n thi·ªán, g·∫ßn g≈©i',
    exciting:'h√†o h·ª©ng, nƒÉng ƒë·ªông', informative:'th√¥ng tin, r√µ r√†ng',
    humorous:'h√†i h∆∞·ªõc, vui v·∫ª', urgent:'kh·∫©n c·∫•p, th√∫c ƒë·∫©y h√†nh ƒë·ªông',
    storytelling:'k·ªÉ chuy·ªán, c·∫£m x√∫c'
  };
  const indMap = {
    general:'t·ªïng qu√°t', ecommerce:'th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠', food:'·∫©m th·ª±c',
    fashion:'th·ªùi trang', tech:'c√¥ng ngh·ªá', beauty:'l√†m ƒë·∫πp',
    education:'gi√°o d·ª•c', realestate:'b·∫•t ƒë·ªông s·∫£n', fitness:'th·ªÉ h√¨nh',
    travel:'du l·ªãch', finance:'t√†i ch√≠nh'
  };

  const btn = document.getElementById('btn-ai');
  btn.disabled = true;
  document.getElementById('ai-loading').classList.remove('hidden');
  document.getElementById('ai-results').classList.add('hidden');

  try {
    const prompt = `T·∫°o 3 phi√™n b·∫£n b√†i ƒëƒÉng Facebook cho ch·ªß ƒë·ªÅ: "${topic}"
Ng√†nh: ${indMap[industry]}, Gi·ªçng vƒÉn: ${toneMap[tone]}, ƒê·ªô d√†i: ${lenMap[S.aiLen]}
Ng√¥n ng·ªØ: Ti·∫øng Vi·ªát. M·ªói b√†i ph·∫£i h·∫•p d·∫´n, c√≥ emoji, c√≥ call-to-action, c√≥ 3-5 hashtag cu·ªëi b√†i.
Tr·∫£ v·ªÅ JSON: {"posts":["b√†i 1","b√†i 2","b√†i 3"]}`;

    let posts;
    if (S.loggedIn) {
      // G·ªçi backend API ‚Äî OpenAI key b·∫£o m·∫≠t tr√™n server
      const data = await api('POST', '/api/ai/generate', { topic, tone, industry, length: S.aiLen });
      posts = data.posts;
    } else {
      // Fallback khi ch∆∞a ƒëƒÉng nh·∫≠p
      throw new Error('no_login');
    }
    renderAISuggestions(posts);
    S.aiCount++; refreshAnalytics();
    toast('AI ƒë√£ t·∫°o 3 phi√™n b·∫£n n·ªôi dung!', 'success');
  } catch {
    renderAISuggestions(buildFallback(topic, tone, industry));
    S.aiCount++; refreshAnalytics();
    toast('ƒê√£ t·∫°o 3 m·∫´u n·ªôi dung g·ª£i √Ω!', 'success');
  } finally {
    btn.disabled = false;
    document.getElementById('ai-loading').classList.add('hidden');
  }
}

function buildFallback(topic, tone, industry) {
  return [
    `üî• ${topic}\n\nCh√∫ng t√¥i t·ª± h√†o mang ƒë·∫øn gi·∫£i ph√°p t·ªët nh·∫•t trong lƒ©nh v·ª±c ${industry}!\n\n‚úÖ Ch·∫•t l∆∞·ª£ng h√†ng ƒë·∫ßu\n‚úÖ Gi√° c·∫£ c·∫°nh tranh\n‚úÖ D·ªãch v·ª• t·∫≠n t√¢m 24/7\n\nüëá Nh·∫Øn tin ngay ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n mi·ªÖn ph√≠!\n\n#${topic.replace(/\s+/g,'')} #${industry} #GenzTech #Marketing`,
    `üí° B·∫°n ƒë√£ bi·∫øt v·ªÅ ${topic} ch∆∞a?\n\nƒê√¢y l√† xu h∆∞·ªõng HOT ƒëang ƒë∆∞·ª£c h√†ng ngh√¨n ng∆∞·ªùi quan t√¢m!\n\nüéØ L√Ω do b·∫°n kh√¥ng th·ªÉ b·ªè qua:\n‚Üí Ti·∫øt ki·ªám th·ªùi gian & chi ph√≠ ƒë√°ng k·ªÉ\n‚Üí Hi·ªáu qu·∫£ ƒë∆∞·ª£c ch·ª©ng minh th·ª±c t·∫ø\n‚Üí D·ªÖ d√†ng √°p d·ª•ng ngay h√¥m nay\n\nComment "T√îI MU·ªêN" ƒë·ªÉ nh·∫≠n t∆∞ v·∫•n mi·ªÖn ph√≠! üôã\n\n#${topic.replace(/\s+/g,'')} #TipHay #Business`,
    `‚ö° ƒê·ª™ng b·ªè l·ª° c∆° h·ªôi V√ÄNG n√†y!\n\n${topic} ‚Äî ∆Øu ƒë√£i ƒë·∫∑c bi·ªát ch·ªâ trong h√¥m nay:\n\nüéÅ Gi·∫£m gi√° l√™n ƒë·∫øn 50%\nüéÅ T·∫∑ng k√®m qu√† h·∫•p d·∫´n\nüéÅ Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn to√†n qu·ªëc\n\n‚è∞ S·ªë l∆∞·ª£ng c√≥ h·∫°n ‚Äî ƒê·∫∑t ngay tr∆∞·ªõc khi h·∫øt!\nüìû Hotline: [S·ªê ƒêI·ªÜN THO·∫†I]\n\n#KhuyenMai #${topic.replace(/\s+/g,'')} #MuaNgay #Sale`
  ];
}

function renderAISuggestions(posts) {
  const list = document.getElementById('ai-list');
  list.innerHTML = '';
  posts.forEach((p, i) => {
    const d = document.createElement('div');
    d.className = 'ai-card';
    d.innerHTML = `<div class="ai-card-label">‚ú¶ PHI√äN B·∫¢N ${i+1}</div><div class="ai-card-text">${esc(p).replace(/\n/g,'<br>')}</div>`;
    d.onclick = () => {
      document.getElementById('post-content').value = p;
      onContentInput();
      toast('ƒê√£ ch·ªçn phi√™n b·∫£n ' + (i+1), 'success');
    };
    list.appendChild(d);
  });
  document.getElementById('ai-results').classList.remove('hidden');
}

function focusAI() {
  switchTab('create');
  document.getElementById('ai-topic').focus();
  document.getElementById('ai-section').scrollIntoView({behavior:'smooth'});
}

// ============================================================
//  HASHTAGS
// ============================================================
async function runHashtag() {
  const topic = document.getElementById('ai-topic').value.trim()
    || document.getElementById('post-content').value.slice(0,100);
  if (!topic) { toast('Nh·∫≠p ch·ªß ƒë·ªÅ ho·∫∑c n·ªôi dung tr∆∞·ªõc', 'error'); return; }

  const btn = document.getElementById('btn-hashtag');
  btn.disabled = true; btn.innerHTML = '<span class="spinner"></span>';

  const tags = genTags(topic);
  renderTags(tags);
  S.tagCount += tags.length; refreshAnalytics();
  toast(`ƒê√£ g·ª£i √Ω ${tags.length} hashtag!`, 'success');

  btn.disabled = false; btn.innerHTML = '<i class="bi bi-hash"></i> Hashtag';
}

function quickHashtag() { switchTab('create'); runHashtag(); }

function genTags(topic) {
  const words = topic.toLowerCase().split(/\s+/).filter(w=>w.length>2)
    .map(w=>'#'+w.replace(/[^\w]/g,''));
  const extras = ['#marketing','#facebook','#viral','#trending','#business','#digital','#success','#growth'];
  return [...new Set([...words,...extras])].slice(0,12);
}

function renderTags(tags) {
  const area  = document.getElementById('hashtag-area');
  const chips = document.getElementById('hashtag-chips');
  chips.innerHTML = '';
  tags.forEach(t => {
    const c = document.createElement('span');
    c.className = 'hashtag-chip';
    c.innerHTML = `${t} <i class="bi bi-plus"></i>`;
    c.onclick = () => {
      const ta = document.getElementById('post-content');
      ta.value += ' ' + t; onContentInput();
      c.classList.add('used');
    };
    chips.appendChild(c);
  });
  area.classList.remove('hidden');
}

// ============================================================
//  FACEBOOK CONNECTION
// ============================================================
function openModal(id)  { document.getElementById(id).classList.remove('hidden'); }
function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

// ============================================================
//  KI·ªÇM TRA TR·∫†NG TH√ÅI FACEBOOK T·ª™ SERVER
// ============================================================
async function checkFbStatus() {
  if (!S.loggedIn) return;
  try {
    const data = await api('GET', '/api/facebook/status');
    if (data.connected) {
      S.connected = true;
      S.fbUser = data.fbUser;
      S.pages = data.pages || [];
      S.tokenExpiry = data.expiresAt;
      localStorage.setItem('gz_pages', JSON.stringify(S.pages));
      updateConnUI(data.fbUser);
      renderPageList();
      checkTokenExpiry();
    }
  } catch {}
}

// ============================================================
//  K·∫ºT N·ªêI FACEBOOK QUA BACKEND
// ============================================================
async function doConnect() {
  if (!S.loggedIn) { toast('Vui l√≤ng ƒëƒÉng nh·∫≠p GenZTech tr∆∞·ªõc', 'error'); return; }
  const token = document.getElementById('fb-token').value.trim();
  if (!token) { toast('Vui l√≤ng nh·∫≠p Access Token', 'error'); return; }

  toast('ƒêang k·∫øt n·ªëi v√† ƒë·ªïi sang Long-lived Token...', 'info');
  try {
    const data = await api('POST', '/api/facebook/connect', { token });
    S.connected = true;
    S.fbUser = data.fbUser;
    S.pages = data.pages || [];
    S.tokenExpiry = data.expiresAt;
    localStorage.setItem('gz_pages', JSON.stringify(S.pages));
    updateConnUI(data.fbUser);
    renderPageList();
    closeModal('modal-connect');
    toast(data.message || 'K·∫øt n·ªëi th√†nh c√¥ng!', 'success');
    checkTokenExpiry();
  } catch (err) {
    toast(err.message, 'error');
  }
}

// ============================================================
//  GIA H·∫†N TOKEN
// ============================================================
async function doRefreshToken() {
  toast('ƒêang gia h·∫°n token...', 'info');
  try {
    const data = await api('POST', '/api/facebook/refresh');
    S.tokenExpiry = data.expiresAt;
    toast(data.message, 'success');
    checkTokenExpiry();
    // C·∫≠p nh·∫≠t banner
    document.getElementById('token-warning-banner').classList.add('hidden');
    document.getElementById('token-status-expiry').textContent = `Token h·∫øt h·∫°n: ${new Date(data.expiresAt).toLocaleDateString('vi-VN')} (‚Ä¢ C√≤n ${data.daysLeft} ng√†y)`;
  } catch (err) {
    toast('Gia h·∫°n th·∫•t b·∫°i: ' + err.message, 'error');
  }
}

// ============================================================
//  KI·ªÇM TRA TOKEN H·∫æT H·∫†N
// ============================================================
function checkTokenExpiry() {
  if (!S.tokenExpiry) return;
  const daysLeft = Math.ceil((new Date(S.tokenExpiry) - Date.now()) / (1000 * 3600 * 24));
  const warningBanner = document.getElementById('token-warning-banner');
  const statusBanner  = document.getElementById('token-status-banner');
  const statusName    = document.getElementById('token-status-name');
  const statusExpiry  = document.getElementById('token-status-expiry');
  const warningText   = document.getElementById('token-warning-text');

  if (statusName) statusName.textContent = S.fbUser?.name || 'Facebook';
  if (statusExpiry) statusExpiry.textContent = `Token h·∫øt h·∫°n: ${new Date(S.tokenExpiry).toLocaleDateString('vi-VN')} (‚Ä¢ C√≤n ${daysLeft} ng√†y)`;

  if (daysLeft <= 0) {
    if (warningBanner) { warningBanner.classList.remove('hidden'); warningText.textContent = 'Token ƒë√£ h·∫øt h·∫°n! Vui l√≤ng gia h·∫°n ngay.'; }
    if (statusBanner) statusBanner.classList.add('hidden');
    toast('‚ö†Ô∏è Token Facebook ƒë√£ h·∫øt h·∫°n! Vui l√≤ng gia h·∫°n.', 'error');
  } else if (daysLeft <= 15) {
    if (warningBanner) { warningBanner.classList.remove('hidden'); warningText.textContent = `Token s·∫Øp h·∫øt h·∫°n trong ${daysLeft} ng√†y!`; }
    if (statusBanner) statusBanner.classList.add('hidden');
  } else {
    if (warningBanner) warningBanner.classList.add('hidden');
    if (statusBanner) statusBanner.classList.remove('hidden');
  }
}

function renderPageList() {
  const c = document.getElementById('page-list');
  if (!S.pages.length) {
    c.innerHTML = '<p class="text-sm text-muted" style="text-align:center;padding:12px;">Kh√¥ng t√¨m th·∫•y Page n√†o</p>';
    return;
  }
  c.innerHTML = '';
  S.pages.forEach(p => {
    const d = document.createElement('div');
    d.className = 'page-card' + (S.page?.id===p.id?' selected':'');
    d.innerHTML = `
      <div class="page-avatar">
        ${p.picture ? `<img src="${p.picture.data?.url||''}" alt="">` : '<i class="bi bi-flag-fill" style="color:#fff;"></i>'}
      </div>
      <div style="flex:1;">
        <div class="page-name">${p.name}</div>
        <div class="page-id">ID: ${p.id}</div>
      </div>
      ${S.page?.id===p.id ? '<i class="bi bi-check-circle-fill page-check"></i>' : ''}
    `;
    d.onclick = () => selectPage(p);
    c.appendChild(d);
  });
}

function selectPage(p) {
  S.page = p;
  localStorage.setItem('gz_page', JSON.stringify(p));
  renderPageList();
  toast(`ƒê√£ ch·ªçn: ${p.name}`, 'success');
}

function updateConnUI(user) {
  const dot  = document.getElementById('conn-dot');
  const text = document.getElementById('conn-text');
  const btn  = document.getElementById('btn-connect');

  if (user) {
    dot.classList.add('on');
    text.textContent = user.name || S.username;
    btn.innerHTML = '<i class="bi bi-check-circle"></i> ƒê√£ k·∫øt n·ªëi';
    btn.style.background = 'rgba(34,197,94,0.2)';
    btn.style.border = '1px solid rgba(34,197,94,0.4)';
    const su = document.getElementById('sidebar-user');
    if (su) su.classList.remove('hidden');
    const sbName = document.getElementById('sb-name');
    if (sbName) sbName.textContent = user.name || S.username;
    const sbAvatar = document.getElementById('sb-avatar');
    if (sbAvatar && user.picture) sbAvatar.src = user.picture;
  } else {
    dot.classList.remove('on');
    text.textContent = 'Ch∆∞a k·∫øt n·ªëi';
    btn.innerHTML = '<i class="bi bi-facebook"></i> K·∫øt n·ªëi Facebook';
    btn.style.background = '';
    btn.style.border = '';
  }
}

// ============================================================
//  PUBLISH
// ============================================================
async function onPublish() {
  const content = document.getElementById('post-content').value.trim();
  if (!content) { toast('Vui l√≤ng nh·∫≠p n·ªôi dung b√†i vi·∫øt', 'error'); return; }

  if (document.getElementById('toggle-schedule').checked) {
    doSchedule(content);
  } else {
    await doPost(content);
  }
}

async function doPost(content) {
  if (!S.connected || !S.page) {
    toast('Vui l√≤ng k·∫øt n·ªëi Facebook v√† ch·ªçn Page', 'error');
    openModal('modal-connect'); return;
  }
  const btn = document.getElementById('btn-publish');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> ƒêang ƒëƒÉng...';

  try {
    const link = document.getElementById('post-link').value.trim();
    const imgFile = document.getElementById('img-file').files[0];
    let photoId = null;

    // N·∫øu c√≥ ·∫£nh ‚Äî upload l√™n Facebook tr∆∞·ªõc, l·∫•y photoId
    if (imgFile) {
      btn.innerHTML = '<span class="spinner"></span> ƒêang upload ·∫£nh...';
      const formData = new FormData();
      formData.append('image', imgFile);
      formData.append('pageId', S.page.id);
      const uploadRes = await fetch(API_BASE + '/api/facebook/upload-image', {
        method: 'POST',
        headers: { 'Authorization': 'Bearer ' + S.jwtToken },
        body: formData,
      });
      const uploadData = await uploadRes.json();
      if (!uploadRes.ok) throw new Error(uploadData.error || 'Upload ·∫£nh th·∫•t b·∫°i');
      photoId = uploadData.photoId;
      btn.innerHTML = '<span class="spinner"></span> ƒêang ƒëƒÉng b√†i...';
    }

    // G·ªçi backend API ‚Äî token ƒë∆∞·ª£c l∆∞u b·∫£o m·∫≠t tr√™n server
    const data = await api('POST', '/api/facebook/post', {
      pageId:  S.page.id,
      content,
      linkUrl: link || null,
      photoId: photoId || null,
    });

    savePost({id: data.postId || Date.now()+'', content, status:'posted', page: S.page.name, postedAt: new Date().toISOString(), fbId: data.postId});
    toast('üéâ ƒêƒÉng b√†i th√†nh c√¥ng!', 'success');
    clearForm(); refreshStats(); renderHistory('all');
  } catch(e) {
    savePost({id: Date.now()+'', content, status:'failed', page: S.page?.name||'', postedAt: new Date().toISOString(), error: e.message});
    toast('L·ªói khi ƒëƒÉng: ' + e.message, 'error');
    refreshStats(); renderHistory('all');
  } finally {
    btn.disabled = false;
    btn.innerHTML = '<i class="bi bi-send-fill"></i> <span id="btn-publish-text">ƒêƒÉng ngay</span>';
  }
}

// ============================================================
//  T·∫¢I B√ÄI VI·∫æT T·ª™ SERVER
// ============================================================
async function loadServerPosts() {
  if (!S.loggedIn) return;
  try {
    const [schedData, histData, statsData] = await Promise.all([
      api('GET', '/api/posts/scheduled'),
      api('GET', '/api/posts/history'),
      api('GET', '/api/posts/stats'),
    ]);
    // Merge v√†o S.posts (gi·ªØ c·∫£ local drafts)
    const serverPosts = [
      ...(schedData.posts || []).map(p => ({...p, _source:'server'})),
      ...(histData.posts  || []).map(p => ({...p, _source:'server'})),
    ];
    const localDrafts = S.posts.filter(p => p.status === 'draft');
    S.posts = [...serverPosts, ...localDrafts];
    localStorage.setItem('gz_posts', JSON.stringify(S.posts));
    // C·∫≠p nh·∫≠t stats t·ª´ server
    if (statsData.stats) {
      document.getElementById('stat-total').textContent   = statsData.stats.total;
      document.getElementById('stat-pending').textContent = statsData.stats.pending;
      document.getElementById('stat-posted').textContent  = statsData.stats.posted;
      document.getElementById('stat-failed').textContent  = statsData.stats.failed;
    }
    renderScheduled();
    renderHistory('all');
  } catch {}
}

async function doSchedule(content) {
  const date = document.getElementById('sch-date').value;
  const time = document.getElementById('sch-time').value;
  if (!date||!time) { toast('Ch·ªçn ng√†y v√† gi·ªù ƒëƒÉng', 'error'); return; }
  const at = new Date(date+'T'+time);
  if (at <= new Date()) { toast('Th·ªùi gian ph·∫£i sau th·ªùi ƒëi·ªÉm hi·ªán t·∫°i', 'error'); return; }

  const link = document.getElementById('post-link').value.trim();
  const repeatType = document.getElementById('sch-repeat')?.value || 'none';
  const postType   = document.getElementById('post-type')?.value || 'feed';

  if (S.loggedIn && S.page) {
    // L√™n l·ªãch qua backend ‚Äî server s·∫Ω t·ª± ƒë·ªông ƒëƒÉng
    try {
      const data = await api('POST', '/api/posts/schedule', {
        pageId:      S.page.id,
        pageName:    S.page.name,
        content,
        linkUrl:     link || null,
        postType,
        scheduledAt: at.toISOString(),
        repeatType,
      });
      toast(`‚úÖ ${data.message}`, 'success');
      clearForm(); await loadServerPosts();
      switchTab('schedule');
      return;
    } catch (err) {
      toast('L·ªói l√™n l·ªãch: ' + err.message, 'error');
    }
  }

  // Fallback: l∆∞u local n·∫øu ch∆∞a ƒëƒÉng nh·∫≠p
  savePost({
    id: Date.now()+'', content, status:'scheduled',
    page: S.page?.name||'Ch∆∞a ch·ªçn Page',
    scheduledAt: at.toISOString(), link,
  });
  toast(`‚úÖ L√™n l·ªãch th√†nh c√¥ng: ${at.toLocaleString('vi-VN')}`, 'success');
  clearForm(); refreshStats(); renderScheduled();
  switchTab('schedule');
}

function saveDraft() {
  const c = document.getElementById('post-content').value.trim();
  if (!c) { toast('Kh√¥ng c√≥ n·ªôi dung ƒë·ªÉ l∆∞u', 'error'); return; }
  savePost({id:Date.now()+'',content:c,status:'draft',page:S.page?.name||'',createdAt:new Date().toISOString()});
  toast('ƒê√£ l∆∞u nh√°p', 'success');
  refreshStats(); renderHistory('all');
}

// ============================================================
//  PREVIEW
// ============================================================
function openPreview() {
  const content = document.getElementById('post-content').value;
  const link    = document.getElementById('post-link').value;
  const imgSrc  = document.getElementById('img-preview').src;

  document.getElementById('pv-content').textContent = content || 'N·ªôi dung b√†i vi·∫øt s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...';
  document.getElementById('pv-page').textContent = S.page?.name || 'Trang Facebook c·ªßa b·∫°n';

  const pvi = document.getElementById('pv-image');
  if (imgSrc && imgSrc !== location.href) { pvi.src=imgSrc; pvi.style.display='block'; } else pvi.style.display='none';

  const pvl = document.getElementById('pv-link');
  if (link) { document.getElementById('pv-link-url').textContent=link; pvl.style.display='block'; } else pvl.style.display='none';

  openModal('modal-preview');
}

// ============================================================
//  STORAGE
// ============================================================
function savePost(p) {
  S.posts.unshift(p);
  if (S.posts.length>200) S.posts = S.posts.slice(0,200);
  localStorage.setItem('gz_posts', JSON.stringify(S.posts));
}
function deletePost(id) {
  S.posts = S.posts.filter(p=>p.id!==id);
  localStorage.setItem('gz_posts', JSON.stringify(S.posts));
  refreshStats(); renderScheduled(); renderHistory('all'); refreshAnalytics();
  toast('ƒê√£ x√≥a', 'success');
}
function editDraft(id) {
  const p = S.posts.find(x=>x.id===id); if(!p) return;
  document.getElementById('post-content').value = p.content; onContentInput();
  deletePost(id); switchTab('create');
  toast('ƒêang ch·ªânh s·ª≠a nh√°p', 'info');
}
function retryPost(id) {
  const p = S.posts.find(x=>x.id===id); if(!p) return;
  document.getElementById('post-content').value = p.content; onContentInput();
  deletePost(id); switchTab('create');
}

// ============================================================
//  RENDER LISTS
// ============================================================
function renderScheduled() {
  const c = document.getElementById('list-scheduled');
  const items = S.posts.filter(p=>p.status==='scheduled');
  const badge = document.getElementById('nav-badge-schedule');
  badge.textContent = items.length;
  badge.style.display = items.length ? '' : 'none';

  if (!items.length) {
    c.innerHTML = `<div class="empty-state"><i class="bi bi-calendar-x"></i><p>Ch∆∞a c√≥ b√†i vi·∫øt n√†o ƒë∆∞·ª£c l√™n l·ªãch</p><button class="btn btn-primary" onclick="switchTab('create')"><i class="bi bi-plus-circle"></i> T·∫°o b√†i vi·∫øt m·ªõi</button></div>`;
    return;
  }
  c.innerHTML = '<div class="post-list">' + items.map(p=>`
    <div class="post-item">
      <div class="post-item-header">
        <span class="badge badge-pending"><i class="bi bi-clock"></i> Ch·ªù ƒëƒÉng</span>
        <span class="text-xs text-muted" style="margin-left:6px;">${p.page||''}</span>
      </div>
      <div class="post-item-content">${esc(p.content).replace(/\n/g,'<br>').slice(0,200)}${p.content.length>200?'‚Ä¶':''}</div>
      <div class="post-item-footer">
        <span class="post-item-time"><i class="bi bi-calendar-event"></i>${new Date(p.scheduledAt).toLocaleString('vi-VN')}</span>
        <div class="flex gap-2">
          <button class="btn btn-success btn-sm" onclick="postNow('${p.id}')"><i class="bi bi-send"></i> ƒêƒÉng ngay</button>
          <button class="btn btn-danger btn-sm" onclick="deletePost('${p.id}')"><i class="bi bi-trash"></i></button>
        </div>
      </div>
    </div>`).join('') + '</div>';
}

function renderHistory(filter) {
  ['all','posted','failed','draft'].forEach(f =>
    document.getElementById('htab-'+f)?.classList.toggle('active', f===filter)
  );
  const c = document.getElementById('list-history');
  let items = S.posts;
  if (filter!=='all') items = items.filter(p=>p.status===filter);

  if (!items.length) {
    c.innerHTML = `<div class="empty-state"><i class="bi bi-inbox"></i><p>Kh√¥ng c√≥ b√†i vi·∫øt n√†o</p></div>`;
    return;
  }
  const bMap = {posted:'badge-posted',failed:'badge-failed',draft:'badge-draft',scheduled:'badge-pending'};
  const iMap = {posted:'bi-check-circle',failed:'bi-x-circle',draft:'bi-file-text',scheduled:'bi-clock'};
  const lMap = {posted:'ƒê√£ ƒëƒÉng',failed:'Th·∫•t b·∫°i',draft:'Nh√°p',scheduled:'Ch·ªù ƒëƒÉng'};

  c.innerHTML = '<div class="post-list">' + items.map(p=>{
    const t = p.postedAt||p.scheduledAt||p.createdAt||'';
    return `<div class="post-item">
      <div class="post-item-header">
        <span class="badge ${bMap[p.status]||'badge-draft'}"><i class="bi ${iMap[p.status]||'bi-file-text'}"></i> ${lMap[p.status]||p.status}</span>
        <span class="text-xs text-muted" style="margin-left:6px;">${p.page||''}</span>
      </div>
      <div class="post-item-content">${esc(p.content).replace(/\n/g,'<br>').slice(0,180)}${p.content.length>180?'‚Ä¶':''}</div>
      ${p.error?`<p style="font-size:11px;color:#f87171;margin-top:6px;"><i class="bi bi-exclamation-triangle"></i> ${p.error}</p>`:''}
      <div class="post-item-footer">
        <span class="post-item-time"><i class="bi bi-clock"></i>${t?new Date(t).toLocaleString('vi-VN'):''}</span>
        <div class="flex gap-2">
          ${p.status==='draft'?`<button class="btn btn-success btn-sm" onclick="editDraft('${p.id}')"><i class="bi bi-pencil"></i> S·ª≠a</button>`:''}
          ${p.status==='failed'?`<button class="btn btn-success btn-sm" onclick="retryPost('${p.id}')"><i class="bi bi-arrow-clockwise"></i> Th·ª≠ l·∫°i</button>`:''}
          <button class="btn btn-danger btn-sm" onclick="deletePost('${p.id}')"><i class="bi bi-trash"></i></button>
        </div>
      </div>
    </div>`;
  }).join('') + '</div>';
}
function filterHistory(f) { renderHistory(f); }

// ============================================================
//  STATS
// ============================================================
function refreshStats() {
  const total = S.posts.length;
  const sch   = S.posts.filter(p=>p.status==='scheduled').length;
  const post  = S.posts.filter(p=>p.status==='posted').length;
  const fail  = S.posts.filter(p=>p.status==='failed').length;
  document.getElementById('s-total').textContent     = total;
  document.getElementById('s-scheduled').textContent = sch;
  document.getElementById('s-posted').textContent    = post;
  document.getElementById('s-failed').textContent    = fail;
}
function refreshAnalytics() {
  const total = S.posts.length;
  const post  = S.posts.filter(p=>p.status==='posted').length;
  const sch   = S.posts.filter(p=>p.status==='scheduled').length;
  const fail  = S.posts.filter(p=>p.status==='failed').length;
  const rate  = (post+fail)>0 ? Math.round(post/(post+fail)*100) : 0;
  document.getElementById('a-total').textContent     = total;
  document.getElementById('a-posted').textContent    = post;
  document.getElementById('a-scheduled').textContent = sch;
  document.getElementById('a-failed').textContent    = fail;
  document.getElementById('a-rate').textContent      = rate+'%';
  document.getElementById('a-ai').textContent        = S.aiCount;
  document.getElementById('a-tags').textContent      = S.tagCount;
  document.getElementById('a-time').textContent      = (S.aiCount*15)+' ph√∫t';
}

// ============================================================
//  AUTO SCHEDULER
// ============================================================
async function checkScheduler() {
  // Server t·ª± ƒë·ªông x·ª≠ l√Ω vi·ªác ƒëƒÉng b√†i theo l·ªãch m·ªói ph√∫t
  // Frontend ch·ªâ c·∫ßn t·∫£i l·∫°i d·ªØ li·ªáu ƒë·ªÉ c·∫≠p nh·∫≠t UI
  if (S.loggedIn) {
    await loadServerPosts();
  } else {
    // Fallback local scheduler cho user ch∆∞a ƒëƒÉng nh·∫≠p
    const now = new Date();
    const due = S.posts.filter(p => p.status === 'scheduled' && new Date(p.scheduledAt) <= now && p._source !== 'server');
    if (due.length) {
      due.forEach(p => { p.status = 'failed'; p.error = 'C·∫ßn ƒëƒÉng nh·∫≠p GenZTech ƒë·ªÉ t·ª± ƒë·ªông ƒëƒÉng'; });
      localStorage.setItem('gz_posts', JSON.stringify(S.posts));
      refreshStats(); renderScheduled(); renderHistory('all');
      toast('‚ö†Ô∏è C·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng l√™n l·ªãch', 'error');
    }
  }
}

async function postNow(id) {
  const p = S.posts.find(x=>x.id===id); if(!p) return;
  document.getElementById('post-content').value = p.content; onContentInput();
  deletePost(id); switchTab('create');
}

// ============================================================
//  CLEAR FORM
// ============================================================
function clearForm() {
  document.getElementById('post-content').value = '';
  document.getElementById('post-link').value = '';
  document.getElementById('ai-topic').value = '';
  removeImage();
  document.getElementById('toggle-schedule').checked = false;
  onToggleSchedule();
  document.getElementById('hashtag-area').classList.add('hidden');
  document.getElementById('ai-results').classList.add('hidden');
  onContentInput();
}

// ============================================================
//  SETTINGS
// ============================================================
function saveSettings() { toast('ƒê√£ l∆∞u c√†i ƒë·∫∑t', 'success'); }

// ============================================================
//  UTILS
// ============================================================
function esc(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function getOAIKey() { return localStorage.getItem('gz_oai_key') || ''; }

// ============================================================
//  TOAST
// ============================================================
function toast(msg, type='info') {
  const box = document.getElementById('toast-box');
  const el  = document.createElement('div');
  const icons = {success:'bi-check-circle-fill',error:'bi-x-circle-fill',info:'bi-info-circle-fill'};
  const cols  = {success:'#4ade80',error:'#f87171',info:'#60a5fa'};
  el.className = `toast ${type}`;
  el.innerHTML = `<i class="bi ${icons[type]}" style="color:${cols[type]};font-size:17px;flex-shrink:0;"></i><span>${msg}</span>`;
  box.appendChild(el);
  setTimeout(()=>{ el.style.animation='toast-in .25s ease reverse'; setTimeout(()=>el.remove(),250); }, 3500);
}

// Close modal on overlay click
document.querySelectorAll('.modal-bg').forEach(m =>
  m.addEventListener('click', e => { if(e.target===m) m.classList.add('hidden'); })
);
</script>
</body>
</html>

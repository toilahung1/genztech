<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>T·ª± ƒê·ªông ƒêƒÉng B√†i ‚Äî Genztech Platform</title>
  <link rel="stylesheet" href="css/main.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <style>
    html, body {
      scrollbar-width: none !important;
      -ms-overflow-style: none !important;
      cursor: none !important;
      -webkit-user-select: none;
      user-select: none;
    }
    html::-webkit-scrollbar, body::-webkit-scrollbar { display: none !important; width: 0 !important; }

    /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
    .app-layout { display: flex; min-height: 100vh; }
    .sidebar {
      width: 260px; flex-shrink: 0;
      background: rgba(10,14,39,0.85);
      backdrop-filter: blur(20px);
      border-right: 1px solid rgba(255,255,255,0.06);
      display: flex; flex-direction: column;
      position: fixed; top: 0; left: 0; bottom: 0; z-index: 40;
    }
    .sidebar-logo {
      padding: 20px 20px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      display: flex; align-items: center; gap: 10px;
    }
    .sidebar-logo img { width: 36px; height: 36px; border-radius: 50%; }
    .sidebar-logo span { font-size: 15px; font-weight: 700; letter-spacing: .5px; color: #fff; }
    .sidebar-logo span em { color: #00d4ff; font-style: normal; }
    .sidebar-nav { flex: 1; padding: 12px 0; overflow-y: auto; }
    .nav-group-label {
      font-size: 10px; font-weight: 600; letter-spacing: 1.2px;
      color: rgba(255,255,255,0.3); text-transform: uppercase;
      padding: 12px 20px 4px;
    }
    .nav-item {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 20px; font-size: 13.5px; color: rgba(255,255,255,0.6);
      text-decoration: none; transition: all .2s; position: relative;
      border-left: 2px solid transparent;
    }
    .nav-item:hover { color: #fff; background: rgba(255,255,255,0.04); }
    .nav-item.active {
      color: #00d4ff; background: rgba(0,212,255,0.08);
      border-left-color: #00d4ff;
    }
    .nav-item i { width: 18px; text-align: center; font-size: 15px; }
    .nav-badge {
      margin-left: auto; background: #1877f2; color: #fff;
      font-size: 10px; font-weight: 700; padding: 2px 7px;
      border-radius: 20px; min-width: 20px; text-align: center;
    }
    .sidebar-footer {
      padding: 16px 20px;
      border-top: 1px solid rgba(255,255,255,0.06);
    }
    .conn-status {
      display: flex; align-items: center; gap: 8px;
      font-size: 12px; color: rgba(255,255,255,0.5);
    }
    .conn-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: #ef4444; flex-shrink: 0;
    }
    .conn-dot.online { background: #22c55e; box-shadow: 0 0 6px #22c55e; }

    /* ‚îÄ‚îÄ Main content ‚îÄ‚îÄ */
    .main-content {
      margin-left: 260px; flex: 1;
      display: flex; flex-direction: column; min-height: 100vh;
    }
    .topbar {
      position: sticky; top: 0; z-index: 30;
      background: rgba(10,14,39,0.85); backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255,255,255,0.06);
      padding: 0 28px; height: 64px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .topbar-left { display: flex; align-items: center; gap: 12px; }
    .breadcrumb { font-size: 13px; color: rgba(255,255,255,0.4); display: flex; align-items: center; gap: 6px; }
    .breadcrumb span { color: #fff; font-weight: 600; }
    .topbar-right { display: flex; align-items: center; gap: 10px; }
    .btn-sm {
      padding: 7px 16px; border-radius: 8px; font-size: 13px; font-weight: 600;
      border: none; cursor: pointer; transition: all .2s; display: flex; align-items: center; gap: 6px;
    }
    .btn-primary { background: #1877f2; color: #fff; }
    .btn-primary:hover { background: #1565d8; transform: translateY(-1px); }
    .btn-outline {
      background: transparent; color: rgba(255,255,255,0.7);
      border: 1px solid rgba(255,255,255,0.15);
    }
    .btn-outline:hover { border-color: #00d4ff; color: #00d4ff; }
    .btn-danger { background: #ef4444; color: #fff; }
    .btn-danger:hover { background: #dc2626; }
    .btn-success { background: #22c55e; color: #fff; }
    .btn-success:hover { background: #16a34a; }

    /* ‚îÄ‚îÄ Page body ‚îÄ‚îÄ */
    .page-body { padding: 28px; flex: 1; }
    .page-title { font-size: 22px; font-weight: 700; margin-bottom: 4px; }
    .page-subtitle { font-size: 13px; color: rgba(255,255,255,0.45); margin-bottom: 24px; }

    /* ‚îÄ‚îÄ Stats bar ‚îÄ‚îÄ */
    .stats-bar { display: grid; grid-template-columns: repeat(4,1fr); gap: 14px; margin-bottom: 24px; }
    .stat-card {
      background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.07);
      border-radius: 12px; padding: 16px 18px;
    }
    .stat-card .label { font-size: 11px; color: rgba(255,255,255,0.4); margin-bottom: 6px; text-transform: uppercase; letter-spacing: .8px; }
    .stat-card .value { font-size: 26px; font-weight: 700; line-height: 1; }
    .stat-card .sub { font-size: 11px; color: rgba(255,255,255,0.35); margin-top: 4px; }
    .stat-blue .value { color: #60a5fa; }
    .stat-green .value { color: #4ade80; }
    .stat-yellow .value { color: #fbbf24; }
    .stat-red .value { color: #f87171; }

    /* ‚îÄ‚îÄ Two-column layout ‚îÄ‚îÄ */
    .two-col { display: grid; grid-template-columns: 1fr 380px; gap: 20px; }

    /* ‚îÄ‚îÄ Card ‚îÄ‚îÄ */
    .card {
      background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.07);
      border-radius: 14px; overflow: hidden;
    }
    .card-header {
      padding: 16px 20px; border-bottom: 1px solid rgba(255,255,255,0.06);
      display: flex; align-items: center; justify-content: space-between;
    }
    .card-title { font-size: 14px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
    .card-title i { color: #00d4ff; }
    .card-body { padding: 20px; }

    /* ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ */
    .tab-bar {
      display: flex; gap: 4px; padding: 4px;
      background: rgba(0,0,0,0.3); border-radius: 10px; margin-bottom: 20px;
    }
    .tab-btn {
      flex: 1; padding: 8px 12px; border: none; border-radius: 7px;
      background: transparent; color: rgba(255,255,255,0.5);
      font-size: 12.5px; font-weight: 600; cursor: pointer; transition: all .2s;
      display: flex; align-items: center; justify-content: center; gap: 5px;
    }
    .tab-btn.active { background: rgba(0,212,255,0.15); color: #00d4ff; }
    .tab-pane { display: none; }
    .tab-pane.active { display: block; }

    /* ‚îÄ‚îÄ Form elements ‚îÄ‚îÄ */
    .form-group { margin-bottom: 16px; }
    .form-label { font-size: 12px; font-weight: 600; color: rgba(255,255,255,0.6); margin-bottom: 6px; display: block; }
    .form-control {
      width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px; padding: 10px 14px; color: #fff; font-size: 13.5px;
      transition: border-color .2s; box-sizing: border-box; font-family: inherit;
    }
    .form-control:focus { outline: none; border-color: #1877f2; }
    .form-control::placeholder { color: rgba(255,255,255,0.25); }
    textarea.form-control { resize: vertical; min-height: 120px; }
    select.form-control { cursor: pointer; }

    /* ‚îÄ‚îÄ Content textarea ‚îÄ‚îÄ */
    .content-wrap { position: relative; }
    .char-count {
      position: absolute; bottom: 10px; right: 12px;
      font-size: 11px; color: rgba(255,255,255,0.3);
    }
    .char-count.warn { color: #fbbf24; }
    .char-count.over { color: #f87171; }
    .emoji-bar { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
    .emoji-btn {
      background: rgba(255,255,255,0.06); border: none; border-radius: 6px;
      padding: 5px 9px; font-size: 16px; cursor: pointer; transition: background .15s;
    }
    .emoji-btn:hover { background: rgba(255,255,255,0.12); }

    /* ‚îÄ‚îÄ Media Upload ‚îÄ‚îÄ */
    .media-mode-tabs { display: flex; gap: 8px; margin-bottom: 12px; }
    .media-mode-btn {
      flex: 1; padding: 8px; border: 1px solid rgba(255,255,255,0.12);
      border-radius: 8px; background: transparent; color: rgba(255,255,255,0.5);
      font-size: 12px; font-weight: 600; cursor: pointer; transition: all .2s;
      display: flex; align-items: center; justify-content: center; gap: 6px;
    }
    .media-mode-btn.active {
      border-color: #1877f2; background: rgba(24,119,242,0.15); color: #60a5fa;
    }
    .upload-zone {
      border: 2px dashed rgba(255,255,255,0.12); border-radius: 10px;
      padding: 24px; text-align: center; cursor: pointer; transition: all .2s;
      background: rgba(0,0,0,0.2);
    }
    .upload-zone:hover, .upload-zone.drag-over {
      border-color: #1877f2; background: rgba(24,119,242,0.06);
    }
    .upload-zone i { font-size: 28px; color: rgba(255,255,255,0.3); display: block; margin-bottom: 8px; }
    .upload-zone p { font-size: 13px; color: rgba(255,255,255,0.4); margin: 0; }
    .upload-zone small { font-size: 11px; color: rgba(255,255,255,0.25); }

    /* Media grid preview */
    .media-grid { display: grid; gap: 3px; margin-top: 10px; border-radius: 10px; overflow: hidden; }
    .media-grid.count-1 { grid-template-columns: 1fr; }
    .media-grid.count-2 { grid-template-columns: 1fr 1fr; }
    .media-grid.count-3 { grid-template-columns: 1fr 1fr; grid-template-rows: auto auto; }
    .media-grid.count-3 .media-thumb:first-child { grid-column: 1 / -1; }
    .media-grid.count-4 { grid-template-columns: 1fr 1fr; }
    .media-grid.count-5plus { grid-template-columns: 1fr 1fr 1fr; grid-template-rows: auto auto; }
    .media-grid.count-5plus .media-thumb:nth-child(1),
    .media-grid.count-5plus .media-thumb:nth-child(2) { grid-column: span 1; }
    .media-thumb {
      position: relative; overflow: hidden; border-radius: 4px;
      background: rgba(0,0,0,0.4); aspect-ratio: 1;
    }
    .media-thumb img, .media-thumb video {
      width: 100%; height: 100%; object-fit: cover; display: block;
    }
    .media-thumb .remove-btn {
      position: absolute; top: 4px; right: 4px;
      background: rgba(0,0,0,0.7); border: none; border-radius: 50%;
      width: 22px; height: 22px; color: #fff; font-size: 12px;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      opacity: 0; transition: opacity .2s;
    }
    .media-thumb:hover .remove-btn { opacity: 1; }
    .media-thumb .more-overlay {
      position: absolute; inset: 0; background: rgba(0,0,0,0.6);
      display: flex; align-items: center; justify-content: center;
      font-size: 22px; font-weight: 700; color: #fff;
    }
    .media-thumb .video-badge {
      position: absolute; bottom: 6px; left: 6px;
      background: rgba(0,0,0,0.7); color: #fff; font-size: 10px;
      font-weight: 700; padding: 2px 7px; border-radius: 4px;
      display: flex; align-items: center; gap: 4px;
    }
    .media-add-btn {
      margin-top: 8px; width: 100%; padding: 8px;
      background: rgba(24,119,242,0.1); border: 1px dashed rgba(24,119,242,0.4);
      border-radius: 8px; color: #60a5fa; font-size: 12px; font-weight: 600;
      cursor: pointer; transition: all .2s;
    }
    .media-add-btn:hover { background: rgba(24,119,242,0.2); }

    /* ‚îÄ‚îÄ AI Section ‚îÄ‚îÄ */
    .ai-section {
      background: rgba(0,212,255,0.04); border: 1px solid rgba(0,212,255,0.12);
      border-radius: 12px; padding: 16px; margin-bottom: 16px;
    }
    .ai-header { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
    .ai-badge {
      background: linear-gradient(135deg,#1877f2,#00d4ff);
      color: #fff; font-size: 10px; font-weight: 700;
      padding: 3px 8px; border-radius: 20px; letter-spacing: .5px;
    }
    .ai-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 10px; }
    .ai-result-list { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
    .ai-result-item {
      background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.08);
      border-radius: 8px; padding: 12px; font-size: 13px; color: rgba(255,255,255,0.8);
      cursor: pointer; transition: all .2s; position: relative;
    }
    .ai-result-item:hover { border-color: #1877f2; background: rgba(24,119,242,0.08); }
    .ai-result-item .use-btn {
      position: absolute; top: 8px; right: 8px;
      background: #1877f2; color: #fff; border: none; border-radius: 5px;
      font-size: 11px; font-weight: 600; padding: 3px 9px; cursor: pointer;
    }
    .hashtag-list { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
    .hashtag-chip {
      background: rgba(24,119,242,0.15); border: 1px solid rgba(24,119,242,0.3);
      color: #60a5fa; font-size: 12px; padding: 3px 10px; border-radius: 20px;
      cursor: pointer; transition: all .15s;
    }
    .hashtag-chip:hover { background: rgba(24,119,242,0.3); }

    /* ‚îÄ‚îÄ Schedule card ‚îÄ‚îÄ */
    .schedule-toggle { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
    .toggle-switch { position: relative; width: 44px; height: 24px; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .toggle-slider {
      position: absolute; inset: 0; background: rgba(255,255,255,0.15);
      border-radius: 24px; cursor: pointer; transition: .3s;
    }
    .toggle-slider:before {
      content: ''; position: absolute; width: 18px; height: 18px;
      left: 3px; top: 3px; background: #fff; border-radius: 50%; transition: .3s;
    }
    .toggle-switch input:checked + .toggle-slider { background: #1877f2; }
    .toggle-switch input:checked + .toggle-slider:before { transform: translateX(20px); }
    .golden-times { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
    .golden-btn {
      background: rgba(251,191,36,0.1); border: 1px solid rgba(251,191,36,0.25);
      color: #fbbf24; font-size: 12px; padding: 4px 10px; border-radius: 6px;
      cursor: pointer; transition: all .15s;
    }
    .golden-btn:hover { background: rgba(251,191,36,0.2); }

    /* ‚îÄ‚îÄ Tips card ‚îÄ‚îÄ */
    .tip-item { display: flex; gap: 10px; margin-bottom: 12px; align-items: flex-start; }
    .tip-icon { font-size: 16px; flex-shrink: 0; margin-top: 1px; }
    .tip-text { font-size: 12.5px; color: rgba(255,255,255,0.55); line-height: 1.5; }
    .tip-text strong { color: rgba(255,255,255,0.8); }

    /* ‚îÄ‚îÄ Post list ‚îÄ‚îÄ */
    .post-item {
      background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.06);
      border-radius: 10px; padding: 14px; margin-bottom: 10px;
    }
    .post-item-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 8px; }
    .post-item-meta { font-size: 11px; color: rgba(255,255,255,0.35); }
    .post-status {
      font-size: 11px; font-weight: 700; padding: 2px 8px; border-radius: 20px;
    }
    .status-pending { background: rgba(251,191,36,0.15); color: #fbbf24; }
    .status-posted { background: rgba(34,197,94,0.15); color: #4ade80; }
    .status-failed { background: rgba(239,68,68,0.15); color: #f87171; }
    .status-draft { background: rgba(148,163,184,0.15); color: #94a3b8; }
    .post-content { font-size: 13px; color: rgba(255,255,255,0.7); line-height: 1.5; margin-bottom: 8px; }
    .post-actions { display: flex; gap: 6px; }
    .post-action-btn {
      background: rgba(255,255,255,0.06); border: none; border-radius: 6px;
      padding: 5px 10px; color: rgba(255,255,255,0.5); font-size: 11.5px;
      cursor: pointer; transition: all .15s; display: flex; align-items: center; gap: 4px;
    }
    .post-action-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }

    /* ‚îÄ‚îÄ Modal ‚îÄ‚îÄ */
    .modal-bg {
      position: fixed; inset: 0; background: rgba(0,0,0,0.7);
      backdrop-filter: blur(8px); z-index: 200;
      display: flex; align-items: center; justify-content: center;
    }
    .modal-bg.hidden { display: none; }
    .modal-box {
      background: #0d1230; border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px; width: 90%; max-width: 480px;
      max-height: 85vh; overflow-y: auto;
    }
    .modal-header {
      padding: 18px 22px; border-bottom: 1px solid rgba(255,255,255,0.07);
      display: flex; align-items: center; justify-content: space-between;
    }
    .modal-title { font-size: 15px; font-weight: 700; }
    .modal-close {
      background: none; border: none; color: rgba(255,255,255,0.4);
      font-size: 20px; cursor: pointer; padding: 0; line-height: 1;
    }
    .modal-close:hover { color: #fff; }
    .modal-body { padding: 22px; }
    .modal-footer {
      padding: 16px 22px; border-top: 1px solid rgba(255,255,255,0.07);
      display: flex; gap: 10px; justify-content: flex-end;
    }

    /* ‚îÄ‚îÄ Facebook Preview Modal ‚îÄ‚îÄ */
    .fb-preview-wrap {
      background: #18191a; border-radius: 10px; overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 500px; margin: 0 auto;
    }
    .fb-post-header { padding: 12px 16px; display: flex; align-items: center; gap: 10px; }
    .fb-avatar {
      width: 40px; height: 40px; border-radius: 50%;
      background: linear-gradient(135deg,#1877f2,#00d4ff);
      display: flex; align-items: center; justify-content: center;
      font-size: 18px; font-weight: 700; color: #fff; flex-shrink: 0;
      overflow: hidden;
    }
    .fb-avatar img { width: 100%; height: 100%; object-fit: cover; }
    .fb-page-info { flex: 1; }
    .fb-page-name {
      font-size: 14px; font-weight: 700; color: #e4e6eb;
      display: flex; align-items: center; gap: 4px;
    }
    .fb-verified { color: #1877f2; font-size: 14px; }
    .fb-post-time { font-size: 12px; color: #b0b3b8; margin-top: 1px; }
    .fb-more-btn {
      background: none; border: none; color: #b0b3b8;
      font-size: 20px; cursor: pointer; padding: 0 4px;
    }
    .fb-post-text {
      padding: 0 16px 12px; font-size: 15px; color: #e4e6eb;
      line-height: 1.6; white-space: pre-wrap; word-break: break-word;
    }
    .fb-media-grid { display: grid; gap: 2px; }
    .fb-media-grid.count-1 { grid-template-columns: 1fr; }
    .fb-media-grid.count-2 { grid-template-columns: 1fr 1fr; }
    .fb-media-grid.count-3 { grid-template-columns: 1fr 1fr; }
    .fb-media-grid.count-3 .fb-media-item:first-child { grid-column: 1 / -1; }
    .fb-media-grid.count-4 { grid-template-columns: 1fr 1fr; }
    .fb-media-grid.count-5plus { grid-template-columns: 1fr 1fr 1fr; }
    .fb-media-grid.count-5plus .fb-media-item:nth-child(1),
    .fb-media-grid.count-5plus .fb-media-item:nth-child(2) { grid-column: span 1; }
    .fb-media-item {
      position: relative; overflow: hidden; background: #000;
      aspect-ratio: 1;
    }
    .fb-media-item img, .fb-media-item video {
      width: 100%; height: 100%; object-fit: cover; display: block;
    }
    .fb-media-item .fb-more-overlay {
      position: absolute; inset: 0; background: rgba(0,0,0,0.6);
      display: flex; align-items: center; justify-content: center;
      font-size: 28px; font-weight: 700; color: #fff;
    }
    .fb-reactions {
      padding: 8px 16px; display: flex; align-items: center; justify-content: space-between;
      border-bottom: 1px solid #3e4042;
    }
    .fb-reaction-icons { display: flex; gap: 2px; font-size: 16px; }
    .fb-reaction-count { font-size: 13px; color: #b0b3b8; }
    .fb-action-bar {
      display: flex; padding: 4px 8px;
    }
    .fb-action-btn {
      flex: 1; display: flex; align-items: center; justify-content: center; gap: 6px;
      padding: 8px; border: none; background: none; color: #b0b3b8;
      font-size: 14px; font-weight: 600; cursor: pointer; border-radius: 6px;
      transition: background .15s;
    }
    .fb-action-btn:hover { background: #3a3b3c; color: #e4e6eb; }

    /* ‚îÄ‚îÄ Connect modal ‚îÄ‚îÄ */
    .auth-tabs { display: flex; gap: 0; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .auth-tab {
      flex: 1; padding: 10px; text-align: center; font-size: 13px; font-weight: 600;
      color: rgba(255,255,255,0.4); cursor: pointer; border-bottom: 2px solid transparent;
      transition: all .2s;
    }
    .auth-tab.active { color: #00d4ff; border-bottom-color: #00d4ff; }
    #fbTab.active { color: #1877f2 !important; border-bottom-color: #1877f2 !important; }
    #fbTab { transition: all .2s; }
    #fbTab:hover { color: #4a9eff; }
    .auth-pane { display: none; }
    .auth-pane.active { display: block; }

    /* ‚îÄ‚îÄ Loading spinner ‚îÄ‚îÄ */
    .spinner {
      display: inline-block; width: 14px; height: 14px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff; border-radius: 50%;
      animation: spin .6s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(24,119,242,0.4); }
      50% { box-shadow: 0 0 0 8px rgba(24,119,242,0); }
    }

    /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
    .toast-container {
      position: fixed; bottom: 24px; right: 24px; z-index: 999;
      display: flex; flex-direction: column; gap: 8px;
    }
    .toast {
      background: #1e293b; border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px; padding: 12px 16px; font-size: 13px;
      display: flex; align-items: center; gap: 10px; min-width: 260px;
      animation: slideIn .3s ease; box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    }
    .toast.success { border-left: 3px solid #22c55e; }
    .toast.error { border-left: 3px solid #ef4444; }
    .toast.info { border-left: 3px solid #60a5fa; }
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

    /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
    @media (max-width: 1024px) {
      .sidebar { width: 220px; }
      .main-content { margin-left: 220px; }
      .two-col { grid-template-columns: 1fr; }
      .stats-bar { grid-template-columns: repeat(2,1fr); }
    }
    @media (max-width: 768px) {
      .sidebar { display: none; }
      .main-content { margin-left: 0; }
    }
  </style>
</head>
<body class="bg-space-black text-white antialiased overflow-x-hidden">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BACKGROUND ENGINE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <canvas id="starfield-far"  class="fixed inset-0 pointer-events-none z-0"></canvas>
  <canvas id="starfield-mid"  class="fixed inset-0 pointer-events-none z-1"></canvas>
  <canvas id="starfield-near" class="fixed inset-0 pointer-events-none z-2"></canvas>
  <canvas id="constellation-lines" class="fixed inset-0 pointer-events-none z-3"></canvas>
  <canvas id="data-particles" class="fixed inset-0 pointer-events-none z-4"></canvas>
  <div class="fixed inset-0 pointer-events-none z-5 opacity-30"><div class="cosmic-fog"></div></div>
  <div class="fixed inset-0 pointer-events-none z-6 noise-overlay opacity-10"></div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CUSTOM CURSOR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="custom-cursor" class="fixed pointer-events-none z-[100] opacity-0 transition-opacity duration-200 flex items-center justify-center transform -translate-x-1/2 -translate-y-1/2 will-change-transform">
    <img src="images/logo.png" alt="Genztech Cursor" class="w-10 h-10 object-cover rounded-full filter drop-shadow-[0_0_8px_rgba(0,212,255,0.8)] pointer-events-none">
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TOAST CONTAINER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê APP LAYOUT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="app-layout relative z-10">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <a href="index.html" class="sidebar-logo" style="text-decoration:none">
        <img src="images/logo.png" alt="Logo">
        <span>GENZ<em>TECH</em></span>
      </a>
      <nav class="sidebar-nav">
        <div class="nav-group-label">T·ªïng quan</div>
        <a href="index.html" class="nav-item">
          <i class="bi bi-grid-1x2"></i> Dashboard
        </a>
        <div class="nav-group-label">C√¥ng c·ª•</div>
        <a href="auto-post.html" class="nav-item active">
          <i class="bi bi-send-fill"></i> T·ª± ƒê·ªông ƒêƒÉng B√†i
          <span class="nav-badge" id="sidebarBadge">0</span>
        </a>
        <a href="ads-assistant.html" class="nav-item" onclick="toggleSubNav(event, 'subNavAds')">
          <i class="bi bi-robot"></i> Tr·ª£ L√Ω Qu·∫£ng C√°o
          <i class="bi bi-chevron-down" id="subNavAdsArrow" style="margin-left:auto;font-size:11px;transition:transform .2s"></i>
        </a>
        <div id="subNavAds" style="display:none">
          <a href="tool-ad-account.html" class="nav-item" style="padding:7px 20px 7px 36px;font-size:12.5px"><i class="bi bi-shield-check"></i> Ki·ªÉm Tra TKQC</a>
          <a href="tool-fb-id.html" class="nav-item" style="padding:7px 20px 7px 36px;font-size:12.5px"><i class="bi bi-person-badge"></i> T√¨m Facebook ID</a>
          <a href="tool-budget.html" class="nav-item" style="padding:7px 20px 7px 36px;font-size:12.5px"><i class="bi bi-graph-up-arrow"></i> Ph√¢n T√≠ch Ng√¢n S√°ch</a>
          <a href="tool-translate.html" class="nav-item" style="padding:7px 20px 7px 36px;font-size:12.5px"><i class="bi bi-translate"></i> D·ªãch Thu·∫≠t</a>
          <a href="tool-ads-finder.html" class="nav-item" style="padding:7px 20px 7px 36px;font-size:12.5px"><i class="bi bi-binoculars"></i> Ads Finder</a>
          <a href="tool-policy.html" class="nav-item" style="padding:7px 20px 7px 36px;font-size:12.5px"><i class="bi bi-journal-text"></i> Ch√≠nh S√°ch FB</a>
          <a href="tool-cookie.html" class="nav-item" style="padding:7px 20px 7px 36px;font-size:12.5px"><i class="bi bi-cookie"></i> Qu·∫£n L√Ω Cookie</a>
        </div>
        <div class="nav-group-label">H·ªá th·ªëng</div>
        <a href="#" class="nav-item" onclick="openModal('settingsModal')">
          <i class="bi bi-gear"></i> C√†i ƒê·∫∑t
        </a>

      </nav>
      <div class="sidebar-footer">
        <div class="conn-status" id="connStatus">
          <div class="conn-dot" id="connDot"></div>
          <span id="connLabel">Ch∆∞a k·∫øt n·ªëi</span>
        </div>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <div class="main-content">

      <!-- TOPBAR -->
      <header class="topbar">
        <div class="topbar-left">
          <div class="breadcrumb">
            <i class="bi bi-house"></i>
            <i class="bi bi-chevron-right" style="font-size:10px"></i>
            <span>T·ª± ƒê·ªông ƒêƒÉng B√†i</span>
          </div>
        </div>
        <div class="topbar-right">
          <button class="btn-sm btn-outline" onclick="openPreview()">
            <i class="bi bi-eye"></i> Xem Tr∆∞·ªõc
          </button>
          <button class="btn-sm btn-outline" onclick="saveDraft()">
            <i class="bi bi-floppy"></i> L∆∞u Nh√°p
          </button>
          <button class="btn-sm btn-primary" id="postBtn" onclick="doPost()">
            <i class="bi bi-send-fill"></i> ƒêƒÉng Ngay
          </button>
          <button class="btn-sm btn-outline" id="connectBtn" onclick="openModal('connectModal')">
            <i class="bi bi-facebook"></i>
            <span id="connectBtnLabel">K·∫øt N·ªëi</span>
          </button>
        </div>
      </header>

      <!-- PAGE BODY -->
      <main class="page-body">
        <h1 class="page-title"><i class="bi bi-send-fill" style="color:#00d4ff"></i> T·ª± ƒê·ªông ƒêƒÉng B√†i Facebook</h1>
        <p class="page-subtitle">So·∫°n, l√™n l·ªãch v√† ƒëƒÉng b√†i t·ª± ƒë·ªông l√™n Facebook Page v·ªõi s·ª©c m·∫°nh AI</p>

        <!-- STATS -->
        <div class="stats-bar">
          <div class="stat-card stat-blue">
            <div class="label">ƒê√£ ƒêƒÉng H√¥m Nay</div>
            <div class="value" id="statPosted">0</div>
            <div class="sub">b√†i vi·∫øt</div>
          </div>
          <div class="stat-card stat-yellow">
            <div class="label">Ch·ªù ƒêƒÉng</div>
            <div class="value" id="statPending">0</div>
            <div class="sub">b√†i l√™n l·ªãch</div>
          </div>
          <div class="stat-card stat-green">
            <div class="label">T·ª∑ L·ªá Th√†nh C√¥ng</div>
            <div class="value" id="statRate">‚Äî</div>
            <div class="sub">trong 30 ng√†y</div>
          </div>
          <div class="stat-card stat-red">
            <div class="label">Th·∫•t B·∫°i</div>
            <div class="value" id="statFailed">0</div>
            <div class="sub">c·∫ßn x·ª≠ l√Ω</div>
          </div>
        </div>

        <!-- TWO COLUMN -->
        <div class="two-col">

          <!-- LEFT: Compose -->
          <div>

            <!-- AI Section -->
            <div class="ai-section">
              <div class="ai-header">
                <span class="ai-badge">‚ú¶ AI</span>
                <span style="font-size:13.5px;font-weight:700">T·∫°o N·ªôi Dung T·ª± ƒê·ªông</span>
              </div>
              <div class="form-group" style="margin-bottom:10px">
                <input type="text" class="form-control" id="aiTopic" placeholder="Nh·∫≠p ch·ªß ƒë·ªÅ b√†i vi·∫øt... (vd: khuy·∫øn m√£i 50%, ra m·∫Øt s·∫£n ph·∫©m m·ªõi)">
              </div>
              <div class="ai-grid">
                <select class="form-control" id="aiTone" style="font-size:12px">
                  <option value="professional">Chuy√™n nghi·ªáp</option>
                  <option value="friendly" selected>Th√¢n thi·ªán</option>
                  <option value="funny">H√†i h∆∞·ªõc</option>
                  <option value="urgent">Kh·∫©n c·∫•p</option>
                  <option value="inspiring">Truy·ªÅn c·∫£m h·ª©ng</option>
                  <option value="storytelling">K·ªÉ chuy·ªán</option>
                  <option value="viral">Viral</option>
                </select>
                <select class="form-control" id="aiIndustry" style="font-size:12px">
                  <option value="general" selected>T·ªïng qu√°t</option>
                  <option value="ecommerce">Th∆∞∆°ng m·∫°i</option>
                  <option value="food">·∫®m th·ª±c</option>
                  <option value="tech">C√¥ng ngh·ªá</option>
                  <option value="beauty">L√†m ƒë·∫πp</option>
                  <option value="fashion">Th·ªùi trang</option>
                  <option value="education">Gi√°o d·ª•c</option>
                  <option value="realestate">B·∫•t ƒë·ªông s·∫£n</option>
                  <option value="health">S·ª©c kh·ªèe</option>
                  <option value="travel">Du l·ªãch</option>
                  <option value="finance">T√†i ch√≠nh</option>
                </select>
                <select class="form-control" id="aiLength" style="font-size:12px">
                  <option value="short">Ng·∫Øn (&lt;100 t·ª´)</option>
                  <option value="medium" selected>V·ª´a (100-200 t·ª´)</option>
                  <option value="long">D√†i (200+ t·ª´)</option>
                </select>
              </div>
              <button class="btn-sm btn-primary" style="width:100%" id="aiBtn" onclick="genAI()">
                <i class="bi bi-stars"></i> T·∫°o 3 Phi√™n B·∫£n AI
              </button>
              <div class="ai-result-list" id="aiResults"></div>
              <div id="hashtagSection" style="display:none;margin-top:10px">
                <div style="font-size:11px;color:rgba(255,255,255,0.4);margin-bottom:4px">G·ª£i √Ω hashtag (click ƒë·ªÉ th√™m):</div>
                <div class="hashtag-list" id="hashtagList"></div>
              </div>
            </div>

            <!-- Compose Card -->
            <div class="card">
              <div class="card-header" style="flex-direction:column;align-items:flex-start;gap:10px">
                <div style="display:flex;align-items:center;justify-content:space-between;width:100%">
                  <div class="card-title"><i class="bi bi-pencil-square"></i> So·∫°n B√†i Vi·∫øt</div>
                  <div id="pageSelectedCount" style="font-size:11px;color:rgba(255,255,255,0.4)"></div>
                </div>
                <!-- Custom multi-select page -->
                <div id="pageMultiSelect" style="width:100%;position:relative">
                  <div id="pageSelectTrigger" onclick="togglePageDropdown()" style="display:flex;align-items:center;gap:8px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);border-radius:8px;padding:8px 12px;cursor:pointer;min-height:38px;flex-wrap:wrap;gap:6px">
                    <span id="pageSelectPlaceholder" style="font-size:12px;color:rgba(255,255,255,0.3)">-- Ch·ªçn Facebook Page --</span>
                    <div id="pageSelectedTags" style="display:flex;flex-wrap:wrap;gap:4px"></div>
                    <i class="bi bi-chevron-down" style="margin-left:auto;font-size:11px;color:rgba(255,255,255,0.4);flex-shrink:0"></i>
                  </div>
                  <div id="pageDropdownList" style="display:none;position:absolute;top:calc(100% + 4px);left:0;right:0;background:#0f1629;border:1px solid rgba(255,255,255,0.12);border-radius:10px;z-index:100;max-height:220px;overflow-y:auto;box-shadow:0 8px 24px rgba(0,0,0,0.5)">
                    <div id="pageDropdownItems"></div>
                  </div>
                </div>
              </div>
              <div class="card-body">
                <div class="form-group">
                  <div class="content-wrap">
                    <textarea class="form-control" id="postContent" rows="6"
                      placeholder="N·ªôi dung b√†i vi·∫øt... Ho·∫∑c d√πng AI ƒë·ªÉ t·∫°o t·ª± ƒë·ªông ·ªü tr√™n"
                      oninput="onContentInput()"></textarea>
                    <div class="char-count" id="charCount">0 / 63,206</div>
                  </div>
                  <div class="emoji-bar">
                    <button class="emoji-btn" onclick="addEmoji('üî•')">üî•</button>
                    <button class="emoji-btn" onclick="addEmoji('üí•')">üí•</button>
                    <button class="emoji-btn" onclick="addEmoji('‚úÖ')">‚úÖ</button>
                    <button class="emoji-btn" onclick="addEmoji('üéâ')">üéâ</button>
                    <button class="emoji-btn" onclick="addEmoji('üíé')">üíé</button>
                    <button class="emoji-btn" onclick="addEmoji('üöÄ')">üöÄ</button>
                    <button class="emoji-btn" onclick="addEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</button>
                    <button class="emoji-btn" onclick="addEmoji('üëâ')">üëâ</button>
                    <button class="emoji-btn" onclick="addEmoji('‚ö°')">‚ö°</button>
                    <button class="emoji-btn" onclick="addEmoji('üéØ')">üéØ</button>
                    <button class="emoji-btn" onclick="addEmoji('üí∞')">üí∞</button>
                    <button class="emoji-btn" onclick="addEmoji('üì£')">üì£</button>
                  </div>
                </div>

                <!-- Link -->
                <div class="form-group">
                  <label class="form-label"><i class="bi bi-link-45deg"></i> ƒê∆∞·ªùng D·∫´n (t√πy ch·ªçn)</label>
                  <input type="url" class="form-control" id="postLink" placeholder="https://...">
                </div>

                <!-- Media Upload -->
                <div class="form-group">
                  <label class="form-label"><i class="bi bi-images"></i> ·∫¢nh / Video</label>
                  <div class="media-mode-tabs">
                    <button class="media-mode-btn active" id="modeImgBtn" onclick="setMediaMode('image')">
                      <i class="bi bi-images"></i> ·∫¢nh
                    </button>
                    <button class="media-mode-btn" id="modeVidBtn" onclick="setMediaMode('video')">
                      <i class="bi bi-play-circle"></i> Video
                    </button>
                    <button class="media-mode-btn" id="modeMixBtn" onclick="setMediaMode('mixed')">
                      <i class="bi bi-collection-play"></i> ·∫¢nh + Video
                    </button>
                  </div>

                  <!-- Image zone -->
                  <div id="imageZone">
                    <div class="upload-zone" id="imgDropZone"
                      onclick="document.getElementById('imgInput').click()"
                      ondragover="onDragOver(event)" ondragleave="onDragLeave(event)" ondrop="onDropImages(event)">
                      <i class="bi bi-cloud-upload"></i>
                      <p>K√©o th·∫£ ·∫£nh v√†o ƒë√¢y ho·∫∑c click ƒë·ªÉ ch·ªçn</p>
                      <small>JPG, PNG, GIF, WEBP ‚Äî T·ªëi ƒëa 10 ·∫£nh</small>
                    </div>
                    <input type="file" id="imgInput" accept="image/*" multiple style="display:none" onchange="onImagesSelected(event)">
                    <div class="media-grid" id="imgGrid" style="display:none"></div>
                    <button class="media-add-btn" id="imgAddBtn" style="display:none" onclick="document.getElementById('imgInput').click()">
                      <i class="bi bi-plus-circle"></i> Th√™m ·∫£nh
                    </button>
                  </div>

                  <!-- Video zone -->
                  <div id="videoZone" style="display:none">
                    <div class="upload-zone" id="vidDropZone"
                      onclick="document.getElementById('vidInput').click()"
                      ondragover="onDragOver(event)" ondragleave="onDragLeave(event)" ondrop="onDropVideo(event)">
                      <i class="bi bi-camera-video"></i>
                      <p>K√©o th·∫£ video v√†o ƒë√¢y ho·∫∑c click ƒë·ªÉ ch·ªçn</p>
                      <small>MP4, MOV, AVI, WEBM ‚Äî T·ªëi ƒëa 200MB</small>
                    </div>
                    <input type="file" id="vidInput" accept="video/*" style="display:none" onchange="onVideoSelected(event)">
                    <div class="media-grid count-1" id="vidGrid" style="display:none"></div>
                  </div>

                  <!-- Mixed zone: ·∫¢nh + Video c√πng l√∫c -->
                  <div id="mixedZone" style="display:none">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:8px">
                      <div>
                        <div style="font-size:11px;color:rgba(255,255,255,0.5);margin-bottom:6px"><i class="bi bi-images"></i> ·∫¢nh (t·ªëi ƒëa 10)</div>
                        <div class="upload-zone" id="mixImgDropZone" style="padding:16px"
                          onclick="document.getElementById('mixImgInput').click()"
                          ondragover="onDragOver(event)" ondragleave="onDragLeave(event)" ondrop="onDropMixImages(event)">
                          <i class="bi bi-cloud-upload" style="font-size:20px"></i>
                          <p style="font-size:12px">Click ho·∫∑c k√©o th·∫£ ·∫£nh</p>
                        </div>
                        <input type="file" id="mixImgInput" accept="image/*" multiple style="display:none" onchange="onMixImagesSelected(event)">
                        <div class="media-grid" id="mixImgGrid" style="display:none"></div>
                        <button class="media-add-btn" id="mixImgAddBtn" style="display:none" onclick="document.getElementById('mixImgInput').click()"><i class="bi bi-plus-circle"></i> Th√™m ·∫£nh</button>
                      </div>
                      <div>
                        <div style="font-size:11px;color:rgba(255,255,255,0.5);margin-bottom:6px"><i class="bi bi-play-circle"></i> Video (1 file)</div>
                        <div class="upload-zone" id="mixVidDropZone" style="padding:16px"
                          onclick="document.getElementById('mixVidInput').click()"
                          ondragover="onDragOver(event)" ondragleave="onDragLeave(event)" ondrop="onDropMixVideo(event)">
                          <i class="bi bi-camera-video" style="font-size:20px"></i>
                          <p style="font-size:12px">Click ho·∫∑c k√©o th·∫£ video</p>
                        </div>
                        <input type="file" id="mixVidInput" accept="video/*" style="display:none" onchange="onMixVideoSelected(event)">
                        <div class="media-grid count-1" id="mixVidGrid" style="display:none"></div>
                      </div>
                    </div>
                    <div style="font-size:11px;color:rgba(255,255,255,0.35);text-align:center">·∫¢nh v√† video s·∫Ω ƒë∆∞·ª£c ƒëƒÉng trong c√πng 1 b√†i vi·∫øt</div>
                  </div>
                </div>

              </div>
            </div>

            <!-- History/Schedule Tabs -->
            <div class="card" style="margin-top:20px">
              <div class="card-body">
                <div class="tab-bar">
                  <button class="tab-btn active" onclick="switchTab('tabScheduled','tabBtns',this)">
                    <i class="bi bi-clock"></i> L·ªãch ƒêƒÉng
                  </button>
                  <button class="tab-btn" onclick="switchTab('tabHistory','tabBtns',this)">
                    <i class="bi bi-journal-text"></i> L·ªãch S·ª≠
                  </button>
                  <button class="tab-btn" onclick="switchTab('tabStats','tabBtns',this)">
                    <i class="bi bi-bar-chart"></i> Th·ªëng K√™
                  </button>
                </div>
                <div id="tabScheduled" class="tab-pane active">
                  <div id="scheduledList"><div style="text-align:center;padding:30px;color:rgba(255,255,255,0.3);font-size:13px"><i class="bi bi-calendar-x" style="font-size:28px;display:block;margin-bottom:8px"></i>Ch∆∞a c√≥ b√†i n√†o l√™n l·ªãch</div></div>
                </div>
                <div id="tabHistory" class="tab-pane">
                  <div style="display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap">
                    <button class="btn-sm btn-outline" onclick="filterHistory('all')" style="font-size:11px;padding:5px 12px">T·∫•t c·∫£</button>
                    <button class="btn-sm btn-outline" onclick="filterHistory('posted')" style="font-size:11px;padding:5px 12px">ƒê√£ ƒëƒÉng</button>
                    <button class="btn-sm btn-outline" onclick="filterHistory('failed')" style="font-size:11px;padding:5px 12px">Th·∫•t b·∫°i</button>
                    <button class="btn-sm btn-outline" onclick="filterHistory('draft')" style="font-size:11px;padding:5px 12px">Nh√°p</button>
                  </div>
                  <div id="historyList"><div style="text-align:center;padding:30px;color:rgba(255,255,255,0.3);font-size:13px"><i class="bi bi-inbox" style="font-size:28px;display:block;margin-bottom:8px"></i>Ch∆∞a c√≥ l·ªãch s·ª≠</div></div>
                </div>
                <div id="tabStats" class="tab-pane">
                  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
                    <div class="stat-card stat-green" style="text-align:center">
                      <div class="label">T·ª∑ L·ªá Th√†nh C√¥ng</div>
                      <div class="value" id="statsRate">‚Äî</div>
                    </div>
                    <div class="stat-card stat-blue" style="text-align:center">
                      <div class="label">AI ƒê√£ T·∫°o</div>
                      <div class="value" id="statsAI">0</div>
                      <div class="sub">phi√™n b·∫£n</div>
                    </div>
                    <div class="stat-card stat-yellow" style="text-align:center">
                      <div class="label">T·ªïng B√†i ƒêƒÉng</div>
                      <div class="value" id="statsTotal">0</div>
                    </div>
                    <div class="stat-card" style="text-align:center">
                      <div class="label">Ti·∫øt Ki·ªám</div>
                      <div class="value" id="statsTime" style="color:#a78bfa">0h</div>
                      <div class="sub">so v·ªõi th·ªß c√¥ng</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- RIGHT: Schedule + Tips -->
          <div>

            <!-- Schedule Card -->
            <div class="card" style="margin-bottom:16px">
              <div class="card-header">
                <div class="card-title"><i class="bi bi-calendar-event"></i> L√™n L·ªãch ƒêƒÉng</div>
              </div>
              <div class="card-body">
                <div class="schedule-toggle">
                  <span style="font-size:13px;font-weight:600">ƒêƒÉng theo l·ªãch</span>
                  <label class="toggle-switch">
                    <input type="checkbox" id="scheduleToggle" onchange="onScheduleToggle()">
                    <span class="toggle-slider"></span>
                  </label>
                </div>
                <div id="scheduleFields" style="display:none">
                  <div class="form-group">
                    <label class="form-label">Ng√†y & Gi·ªù ƒêƒÉng</label>
                    <input type="datetime-local" class="form-control" id="scheduleTime">
                  </div>
                  <div class="form-group">
                    <label class="form-label">L·∫∑p L·∫°i</label>
                    <select class="form-control" id="scheduleRepeat">
                      <option value="none">Kh√¥ng l·∫∑p</option>
                      <option value="daily">M·ªói ng√†y</option>
                      <option value="weekly">M·ªói tu·∫ßn</option>
                      <option value="monthly">M·ªói th√°ng</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label"><i class="bi bi-star-fill" style="color:#fbbf24"></i> Gi·ªù V√†ng</label>
                    <div class="golden-times">
                      <button class="golden-btn" onclick="setGoldenTime('08:00')">‚òÄÔ∏è 8:00</button>
                      <button class="golden-btn" onclick="setGoldenTime('12:00')">üåû 12:00</button>
                      <button class="golden-btn" onclick="setGoldenTime('18:00')">üåÜ 18:00</button>
                      <button class="golden-btn" onclick="setGoldenTime('20:00')">üåô 20:00</button>
                      <button class="golden-btn" onclick="setGoldenTime('21:30')">‚≠ê 21:30</button>
                    </div>
                  </div>
                  <button class="btn-sm btn-success" style="width:100%" onclick="doSchedule()">
                    <i class="bi bi-calendar-check"></i> L√™n L·ªãch B√†i Vi·∫øt
                  </button>
                </div>
                <div id="scheduleNow" style="text-align:center;padding:10px 0">
                  <p style="font-size:12.5px;color:rgba(255,255,255,0.4)">B·∫≠t l√™n l·ªãch ƒë·ªÉ ch·ªçn ng√†y gi·ªù ƒëƒÉng b√†i t·ª± ƒë·ªông</p>
                  <button class="btn-sm btn-primary" style="margin-top:8px" onclick="doPost()">
                    <i class="bi bi-send-fill"></i> ƒêƒÉng Ngay B√¢y Gi·ªù
                  </button>
                </div>
              </div>
            </div>

            <!-- Tips Card -->
            <div class="card">
              <div class="card-header">
                <div class="card-title"><i class="bi bi-lightbulb"></i> M·∫πo ƒêƒÉng B√†i Hi·ªáu Qu·∫£</div>
              </div>
              <div class="card-body">
                <div class="tip-item">
                  <span class="tip-icon">‚è∞</span>
                  <div class="tip-text"><strong>Gi·ªù v√†ng:</strong> 8h, 12h, 18h v√† 20h-21h l√† th·ªùi ƒëi·ªÉm ng∆∞·ªùi d√πng online nhi·ªÅu nh·∫•t</div>
                </div>
                <div class="tip-item">
                  <span class="tip-icon">üì∏</span>
                  <div class="tip-text"><strong>·∫¢nh/Video:</strong> B√†i c√≥ ·∫£nh ƒë·∫°t t∆∞∆°ng t√°c g·∫•p 2.3x, video g·∫•p 5x so v·ªõi text thu·∫ßn</div>
                </div>
                <div class="tip-item">
                  <span class="tip-icon">#Ô∏è‚É£</span>
                  <div class="tip-text"><strong>Hashtag:</strong> D√πng 3-5 hashtag li√™n quan, tr√°nh spam qu√° nhi·ªÅu</div>
                </div>
                <div class="tip-item">
                  <span class="tip-icon">üìù</span>
                  <div class="tip-text"><strong>ƒê·ªô d√†i:</strong> 40-80 k√Ω t·ª± cho post ng·∫Øn, 150-300 k√Ω t·ª± cho post chi ti·∫øt</div>
                </div>
                <div class="tip-item">
                  <span class="tip-icon">üéØ</span>
                  <div class="tip-text"><strong>CTA:</strong> Lu√¥n k·∫øt th√∫c b·∫±ng l·ªùi k√™u g·ªçi h√†nh ƒë·ªông r√µ r√†ng</div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

  <!-- Connect Modal -->
  <div class="modal-bg hidden" id="connectModal">
    <div class="modal-box">
      <div class="modal-header">
        <div class="modal-title"><i class="bi bi-facebook" style="color:#1877f2"></i> K·∫øt N·ªëi T√†i Kho·∫£n</div>
        <button class="modal-close" onclick="closeModal('connectModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="auth-tabs" id="authTabBar">
          <div class="auth-tab active" onclick="switchAuthTab('authLogin')">ƒêƒÉng Nh·∫≠p</div>
          <div class="auth-tab" onclick="switchAuthTab('authRegister')">ƒêƒÉng K√Ω</div>
          <div class="auth-tab" id="fbTab" onclick="switchAuthTab('authFacebook')" style="color:#1877f2"><i class="bi bi-facebook"></i> Facebook</div>
        </div>

        <!-- Login -->
        <div class="auth-pane active" id="authLogin">
          <form onsubmit="doLogin();return false;" autocomplete="on">
          <div class="form-group">
            <label class="form-label">Email ho·∫∑c T√™n ƒëƒÉng nh·∫≠p</label>
            <input type="text" class="form-control" id="loginUser" name="username" autocomplete="username" placeholder="email@example.com">
          </div>
          <div class="form-group">
            <label class="form-label">M·∫≠t kh·∫©u</label>
            <input type="password" class="form-control" id="loginPass" name="password" autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
          </div>
          <button type="submit" class="btn-sm btn-primary" style="width:100%" id="loginBtn">
            <i class="bi bi-box-arrow-in-right"></i> ƒêƒÉng Nh·∫≠p
          </button>
          </form>
        </div>

        <!-- Register -->
        <div class="auth-pane" id="authRegister">
          <form onsubmit="doRegister();return false;" autocomplete="on">
          <div class="form-group">
            <label class="form-label">T√™n ƒëƒÉng nh·∫≠p</label>
            <input type="text" class="form-control" id="regUser" name="username" autocomplete="username" placeholder="username">
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" id="regEmail" name="email" autocomplete="email" placeholder="email@example.com">
          </div>
          <div class="form-group">
            <label class="form-label">M·∫≠t kh·∫©u</label>
            <input type="password" class="form-control" id="regPass" name="new-password" autocomplete="new-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" oninput="checkPwStrength(this.value)">
            <div id="pwHint" style="font-size:11px;margin-top:5px;color:rgba(255,255,255,0.4)">
              T·ªëi thi·ªÉu 8 k√Ω t·ª±, g·ªìm c·∫£ ch·ªØ v√† s·ªë (v√≠ d·ª•: <b>MyPass2024</b>)
            </div>
          </div>
          <button type="submit" class="btn-sm btn-primary" style="width:100%" id="regBtn">
            <i class="bi bi-person-plus"></i> ƒêƒÉng K√Ω
          </button>
          </form>
        </div>

        <!-- Facebook OAuth Login Tab -->
        <div class="auth-pane" id="authFacebook">
          <!-- Th√¥ng b√°o khi ch∆∞a ƒëƒÉng nh·∫≠p GenZTech -->
          <div id="fbNeedLoginMsg" style="display:none;text-align:center;padding:20px 0">
            <div style="font-size:40px;margin-bottom:12px">üîê</div>
            <div style="font-size:14px;font-weight:600;color:rgba(255,255,255,0.7);margin-bottom:8px">Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc</div>
            <div style="font-size:12px;color:rgba(255,255,255,0.4);margin-bottom:16px">B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p t√†i kho·∫£n GenZTech ƒë·ªÉ k·∫øt n·ªëi Facebook</div>
            <button class="btn-sm btn-primary" onclick="switchAuthTab('authLogin')" style="font-size:13px">
              <i class="bi bi-box-arrow-in-right"></i> ƒêƒÉng Nh·∫≠p Ngay
            </button>
          </div>
          <!-- N·ªôi dung khi ƒë√£ ƒëƒÉng nh·∫≠p -->
          <div id="fbConnectContent" style="display:none">
          <div style="text-align:center;margin-bottom:20px">
            <div style="font-size:48px;margin-bottom:8px">üìò</div>
            <div style="font-size:16px;font-weight:700;color:#fff;margin-bottom:4px">K·∫øt N·ªëi Facebook Page</div>
            <div style="font-size:12px;color:rgba(255,255,255,0.5)">K·∫øt n·ªëi ƒë·ªÉ ƒëƒÉng b√†i t·ª± ƒë·ªông l√™n Facebook Page c·ªßa b·∫°n</div>
          </div>
          <!-- N√∫t OAuth ch√≠nh -->
          <button class="btn-sm" id="fbConnectBtn" onclick="doFBLogin()" style="width:100%;background:#1877f2;color:#fff;border:none;font-size:15px;font-weight:700;padding:14px;border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:12px;box-shadow:0 4px 20px rgba(24,119,242,0.4)">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="white"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
            ƒêƒÉng nh·∫≠p v·ªõi Facebook
          </button>
          <div style="font-size:11px;color:rgba(255,255,255,0.3);margin-top:10px;text-align:center">
            S·∫Ω y√™u c·∫ßu quy·ªÅn qu·∫£n l√Ω Facebook Page c·ªßa b·∫°n
          </div>
          <!-- Token status (hi·ªÉn sau khi ƒë√£ k·∫øt n·ªëi) -->
          <div id="tokenStatusBox" style="display:none;margin-top:14px;padding:12px;background:rgba(255,255,255,0.05);border-radius:8px;border:1px solid rgba(255,255,255,0.08)">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
              <span style="font-size:12px;color:rgba(255,255,255,0.5)">Tr·∫°ng th√°i Token</span>
              <span id="tokenDaysLabel" style="font-size:12px;font-weight:700"></span>
            </div>
            <div style="background:rgba(255,255,255,0.06);border-radius:4px;height:6px;overflow:hidden;margin-bottom:10px">
              <div id="tokenProgressBar" style="height:100%;border-radius:4px;transition:width 0.5s"></div>
            </div>
            <div style="display:flex;gap:8px">
              <button class="btn-sm btn-outline" style="flex:1;font-size:11px" onclick="doRefreshToken()" id="refreshTokenBtn">
                <i class="bi bi-arrow-clockwise"></i> Gia H·∫°n Ngay
              </button>
              <button class="btn-sm btn-outline" style="flex:1;font-size:11px;color:#f87171;border-color:rgba(248,113,113,0.3)" onclick="doDisconnect()">
                <i class="bi bi-x-circle"></i> Ng·∫Øt K·∫øt N·ªëi
              </button>
            </div>
            <div id="tokenRefreshMsg" style="font-size:11px;margin-top:8px;text-align:center"></div>
          </div>
          </div><!-- end fbConnectContent -->
        </div><!-- end authFacebook pane -->
      </div>
    </div>
  </div>

  <!-- Preview Modal -->
  <div class="modal-bg hidden" id="previewModal">
    <div class="modal-box" style="max-width:520px">
      <div class="modal-header">
        <div class="modal-title"><i class="bi bi-eye"></i> Xem Tr∆∞·ªõc B√†i Vi·∫øt</div>
        <button class="modal-close" onclick="closeModal('previewModal')">&times;</button>
      </div>
      <div class="modal-body" style="padding:16px">
        <div class="fb-preview-wrap" id="fbPreviewWrap">
          <!-- filled by JS -->
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-bg hidden" id="settingsModal">
    <div class="modal-box">
      <div class="modal-header">
        <div class="modal-title"><i class="bi bi-gear"></i> C√†i ƒê·∫∑t</div>
        <button class="modal-close" onclick="closeModal('settingsModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group" style="background:rgba(96,165,250,0.08);border:1px solid rgba(96,165,250,0.2);border-radius:8px;padding:12px">
          <div style="font-size:12px;color:#60a5fa;font-weight:600;margin-bottom:6px"><i class="bi bi-shield-check"></i> AI ƒë∆∞·ª£c b·∫£o m·∫≠t ·ªü server</div>
          <div style="font-size:11px;color:rgba(255,255,255,0.5)">OpenAI API key ƒë∆∞·ª£c l∆∞u an to√†n tr√™n server Railway, kh√¥ng bao gi·ªù l·ªô ra tr√¨nh duy·ªát hay GitHub. B·∫°n kh√¥ng c·∫ßn nh·∫≠p key.</div>
        </div>
        <div class="form-group">
          <label class="form-label">Ng√¥n ng·ªØ AI m·∫∑c ƒë·ªãnh</label>
          <select class="form-control" id="aiLangInput">
            <option value="vi" selected>Ti·∫øng Vi·ªát</option>
            <option value="en">English</option>
          </select>
        </div>
        <div style="display:flex;flex-direction:column;gap:10px">
          <label style="display:flex;align-items:center;gap:10px;font-size:13px;cursor:pointer">
            <input type="checkbox" id="autoHashtag" checked> T·ª± ƒë·ªông th√™m hashtag
          </label>
          <label style="display:flex;align-items:center;gap:10px;font-size:13px;cursor:pointer">
            <input type="checkbox" id="notifyPost" checked> Th√¥ng b√°o khi ƒëƒÉng xong
          </label>
          <label style="display:flex;align-items:center;gap:10px;font-size:13px;cursor:pointer">
            <input type="checkbox" id="autoRetry" checked> T·ª± ƒë·ªông th·ª≠ l·∫°i khi th·∫•t b·∫°i
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-sm btn-outline" onclick="closeModal('settingsModal')">H·ªßy</button>
        <button class="btn-sm btn-primary" onclick="saveSettings()">L∆∞u C√†i ƒê·∫∑t</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê JAVASCRIPT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
  // ============================================================
  //  CONFIG
  // ============================================================
  const API_BASE = 'https://genztech-production.up.railway.app';

  // ============================================================
  //  STATE
  // ============================================================
  const S = {
    jwtToken:  localStorage.getItem('gz_jwt') || '',
    username:  localStorage.getItem('gz_username') || '',
    loggedIn:  !!localStorage.getItem('gz_jwt'),
    connected: !!localStorage.getItem('gz_connected'),
    fbUser:    JSON.parse(localStorage.getItem('gz_fb_user') || 'null'),
    pages:     JSON.parse(localStorage.getItem('gz_pages') || '[]'),
    page:      JSON.parse(localStorage.getItem('gz_page') || 'null'),       // page ƒë·∫ßu ti√™n ƒë∆∞·ª£c ch·ªçn (backward compat)
    selectedPages: JSON.parse(localStorage.getItem('gz_selected_pages') || '[]'), // danh s√°ch c√°c page ƒë∆∞·ª£c ch·ªçn
    posts:     JSON.parse(localStorage.getItem('gz_posts') || '[]'),
    aiLen:     'short',
    aiCount:   0,
    tagCount:  0,
    mediaMode: 'image',
    images:    [],   // Array of File objects
    video:     null, // File object
  };

  // ============================================================
  //  API HELPER
  // ============================================================
  async function api(method, path, body) {
    const opts = { method, headers: { 'Content-Type': 'application/json' } };
    if (S.jwtToken) opts.headers['Authorization'] = 'Bearer ' + S.jwtToken;
    if (body) opts.body = JSON.stringify(body);
    const res = await fetch(API_BASE + path, opts);
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Request failed');
    return data;
  }

  // ============================================================
  //  INIT
  // ============================================================
  function init() {
    // X·ª≠ l√Ω OAuth callback params t·ª´ Facebook
    const urlParams = new URLSearchParams(window.location.search);
    const fbSuccess = urlParams.get('fb_success');
    const fbError = urlParams.get('fb_error');
    const fbMsg = urlParams.get('fb_msg');
    if (fbSuccess) {
      // X√≥a params kh·ªèi URL
      window.history.replaceState({}, '', window.location.pathname);
      setTimeout(() => toast('‚úÖ ' + (fbMsg ? decodeURIComponent(fbMsg) : 'K·∫øt n·ªëi Facebook th√†nh c√¥ng!'), 'success'), 500);
    } else if (fbError) {
      window.history.replaceState({}, '', window.location.pathname);
      setTimeout(() => toast('‚ùå ' + decodeURIComponent(fbError), 'error'), 500);
    }

    // Set min datetime
    const now = new Date();
    now.setMinutes(now.getMinutes() + 5);
    const dt = document.getElementById('scheduleTime');
    if (dt) dt.min = now.toISOString().slice(0,16);

    // Load settings
    // API key b·∫£o m·∫≠t ·ªü backend ‚Äî kh√¥ng l∆∞u ·ªü localStorage
    localStorage.removeItem('gz_oai_key'); // X√≥a key c≈© n·∫øu c√≥

    // Restore pages
    if (S.pages.length) renderPageSelect(S.pages);
    updatePageSelectedUI();

    // Update UI
    updateConnUI();
    renderPosts();
    updateStats();

     // Auto-scheduler check every 30s
    setInterval(checkScheduler, 30000);
    // N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p th√¨ t·ª± ƒë·ªông m·ªü modal ƒëƒÉng nh·∫≠p
    if (!S.loggedIn) {
      setTimeout(function() { openModal('connectModal'); }, 300);
    }
    // N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p nh∆∞ng ch∆∞a k·∫øt n·ªëi Facebook, hi·ªÉn th·ªã g·ª£i √Ω
    if (S.loggedIn && !S.connected) {
      // Hi·ªÉn th·ªã badge nh·∫Øc nh·ªü k·∫øt n·ªëi Facebook
      const connectBtn = document.getElementById('connectBtn');
      if (connectBtn) {
        connectBtn.style.animation = 'pulse 2s infinite';
        setTimeout(function() {
          if (connectBtn) connectBtn.style.animation = '';
        }, 6000);
      }
    }
    // Auto-check Facebook status n·∫øu ƒë√£ ƒëƒÉng nh·∫≠p
    if (S.loggedIn && S.jwtToken) {
      setTimeout(async function() {
        try {
          const data = await api('GET', '/api/facebook/status');
          if (data.connected) {
            S.connected = true;
            S.fbUser = data.fbUser;
            S.tokenDaysLeft = data.daysLeft;
            S.tokenExpiresAt = data.expiresAt;
            S.pages = data.pages || [];
            localStorage.setItem('gz_connected', '1');
            localStorage.setItem('gz_fb_user', JSON.stringify(data.fbUser || null));
            localStorage.setItem('gz_pages', JSON.stringify(S.pages));
            renderPageSelect(S.pages);
            updateConnUI();
            if (data.warning) {
              toast('‚ö†Ô∏è Token Facebook s·∫Øp h·∫øt h·∫°n (' + data.daysLeft + ' ng√†y). Nh·∫•n "Gia H·∫°n Ngay" trong m·ª•c K·∫øt N·ªëi!', 'error');
            }
          } else {
            // API tr·∫£ v·ªÅ connected: false ‚Äî c√≥ th·ªÉ do Facebook ƒëang c·∫•m API t·∫°m th·ªùi
            // N·∫øu tr∆∞·ªõc ƒë√≥ ƒë√£ k·∫øt n·ªëi (c√≥ gz_connected trong localStorage), gi·ªØ nguy√™n tr·∫°ng th√°i
            if (localStorage.getItem('gz_connected')) {
              S.connected = true;
              S.fbUser = JSON.parse(localStorage.getItem('gz_fb_user') || 'null');
              S.pages = JSON.parse(localStorage.getItem('gz_pages') || '[]');
              if (S.pages.length) renderPageSelect(S.pages);
              updateConnUI();
            }
          }
        } catch(e) {
          // API l·ªói (network, server down, FB c·∫•m) ‚Äî gi·ªØ nguy√™n tr·∫°ng th√°i ƒë√£ l∆∞u
          if (localStorage.getItem('gz_connected')) {
            S.connected = true;
            S.fbUser = JSON.parse(localStorage.getItem('gz_fb_user') || 'null');
            S.pages = JSON.parse(localStorage.getItem('gz_pages') || '[]');
            if (S.pages.length) renderPageSelect(S.pages);
            updateConnUI();
          }
        }
      }, 500);
    }
  }

  // ============================================================
  //  AUTH
  // ============================================================
  async function doLogin() {
    const user = document.getElementById('loginUser').value.trim();
    const pass = document.getElementById('loginPass').value.trim();
    if (!user || !pass) return toast('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin', 'error');
    const btn = document.getElementById('loginBtn');
    btn.innerHTML = '<span class="spinner"></span> ƒêang ƒëƒÉng nh·∫≠p...';
    btn.disabled = true;
    try {
      const data = await api('POST', '/api/auth/login', { username: user, password: pass });
      S.jwtToken = data.token;
      S.username = data.username || (data.user && data.user.username) || user;
      S.loggedIn = true;
      localStorage.setItem('gz_jwt', data.token);
      localStorage.setItem('gz_username', S.username);
      toast('ƒêƒÉng nh·∫≠p th√†nh c√¥ng! Ch√†o ' + S.username, 'success');
      updateConnUI();
      // ƒê√≥ng modal sau khi ƒëƒÉng nh·∫≠p th√†nh c√¥ng
      closeModal('connectModal');
    } catch(e) {
      toast(e.message, 'error');
    } finally {
      btn.innerHTML = '<i class="bi bi-box-arrow-in-right"></i> ƒêƒÉng Nh·∫≠p';
      btn.disabled = false;
    }
  }

  function checkPwStrength(pw) {
    const hint = document.getElementById('pwHint');
    if (!hint) return;
    if (!pw) {
      hint.style.color = 'rgba(255,255,255,0.4)';
      hint.innerHTML = 'T·ªëi thi·ªÉu 8 k√Ω t·ª±, g·ªìm c·∫£ ch·ªØ v√† s·ªë (v√≠ d·ª•: <b>MyPass2024</b>)';
      return;
    }
    const hasLen  = pw.length >= 8;
    const hasLetter = /[a-zA-Z]/.test(pw);
    const hasDigit  = /[0-9]/.test(pw);
    if (hasLen && hasLetter && hasDigit) {
      hint.style.color = '#4ade80';
      hint.innerHTML = '‚úÖ M·∫≠t kh·∫©u h·ª£p l·ªá';
    } else {
      hint.style.color = '#f87171';
      const issues = [];
      if (!hasLen)    issues.push('t·ªëi thi·ªÉu 8 k√Ω t·ª±');
      if (!hasLetter) issues.push('c√≥ ch·ªØ c√°i');
      if (!hasDigit)  issues.push('c√≥ ch·ªØ s·ªë');
      hint.innerHTML = '‚ö†Ô∏è C·∫ßn ' + issues.join(', ');
    }
  }

  async function doRegister() {
    const user = document.getElementById('regUser').value.trim();
    const email = document.getElementById('regEmail').value.trim();
    const pass = document.getElementById('regPass').value.trim();
    if (!user || !email || !pass) return toast('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin', 'error');
    if (pass.length < 8 || !/[a-zA-Z]/.test(pass) || !/[0-9]/.test(pass)) {
      return toast('M·∫≠t kh·∫©u ph·∫£i t·ªëi thi·ªÉu 8 k√Ω t·ª±, g·ªìm c·∫£ ch·ªØ v√† s·ªë', 'error');
    }
    const btn = document.getElementById('regBtn');
    btn.innerHTML = '<span class="spinner"></span> ƒêang ƒëƒÉng k√Ω...';
    btn.disabled = true;
    try {
      const data = await api('POST', '/api/auth/register', { username: user, email, password: pass });
      S.jwtToken = data.token;
      S.username = data.username || (data.user && data.user.username) || user;
      S.loggedIn = true;
      localStorage.setItem('gz_jwt', data.token);
      localStorage.setItem('gz_username', S.username);
      toast('ƒêƒÉng k√Ω th√†nh c√¥ng! Ch√†o m·ª´ng ' + S.username, 'success');
      updateConnUI();
      // ƒê√≥ng modal sau khi ƒëƒÉng k√Ω th√†nh c√¥ng
      closeModal('connectModal');
    } catch(e) {
      toast(e.message, 'error');
    } finally {
      btn.innerHTML = '<i class="bi bi-person-plus"></i> ƒêƒÉng K√Ω';
      btn.disabled = false;
    }
  }

  // ƒêƒÉng nh·∫≠p Facebook qua OAuth 2.0 ‚Äî m·ªü popup c·ªßa Facebook
  async function doFBLogin() {
    if (!S.loggedIn) return toast('Vui l√≤ng ƒëƒÉng nh·∫≠p GenZTech tr∆∞·ªõc', 'error');
    const btn = document.getElementById('fbConnectBtn');
    btn.innerHTML = '<span class="spinner"></span> ƒêang t·∫£i...';
    btn.disabled = true;
    try {
      // L·∫•y URL OAuth t·ª´ backend
      const data = await api('GET', '/api/facebook/oauth/url');
      if (!data.url) throw new Error('Kh√¥ng l·∫•y ƒë∆∞·ª£c URL ƒëƒÉng nh·∫≠p');
      // M·ªü popup Facebook Login
      const w = 600, h = 700;
      const left = (screen.width - w) / 2;
      const top = (screen.height - h) / 2;
      const popup = window.open(data.url, 'fb_login', `width=${w},height=${h},left=${left},top=${top},toolbar=no,menubar=no`);
      // Theo d√µi popup ƒë√≥ng l·∫°i
      const timer = setInterval(async () => {
        if (!popup || popup.closed) {
          clearInterval(timer);
          resetFBBtn(btn);
          btn.disabled = false;
          // Ki·ªÉm tra xem ƒë√£ k·∫øt n·ªëi ch∆∞a
          try {
            const status = await api('GET', '/api/facebook/status');
            if (status.connected) {
              S.connected = true;
              S.fbUser = status.fbUser;
              S.pages = status.pages || [];
              S.tokenExpiresAt = status.expiresAt;
              S.tokenDaysLeft = status.daysLeft;
              localStorage.setItem('gz_connected', '1');
              localStorage.setItem('gz_fb_user', JSON.stringify(status.fbUser || null));
              localStorage.setItem('gz_pages', JSON.stringify(S.pages));
              renderPageSelect(S.pages);
              updateConnUI();
              updateFBTabContent();
              closeModal('connectModal');
              toast('‚úÖ K·∫øt n·ªëi Facebook th√†nh c√¥ng! ' + S.pages.length + ' Page', 'success');
            }
          } catch(e) {}
        }
      }, 1000);
    } catch(e) {
      toast(e.message, 'error');
      resetFBBtn(btn);
      btn.disabled = false;
    }
  }

  function resetFBBtn(btn) {
    if (!btn) return;
    btn.innerHTML = '<svg width="22" height="22" viewBox="0 0 24 24" fill="white"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg> ƒêƒÉng nh·∫≠p v·ªõi Facebook';
  }

  // Gi·ªØ l·∫°i doConnectFB cho backward compatible (kh√¥ng d√πng n·ªØa)
  async function doConnectFB() { doFBLogin(); }

  // ============================================================
  //  REFRESH TOKEN
  // ============================================================
  async function doRefreshToken() {
    const btn = document.getElementById('refreshTokenBtn');
    const msg = document.getElementById('tokenRefreshMsg');
    btn.innerHTML = '<span class="spinner"></span> ƒêang gia h·∫°n...';
    btn.disabled = true;
    msg.textContent = '';
    try {
      const data = await api('POST', '/api/facebook/refresh');
      S.tokenExpiresAt = data.expiresAt;
      S.tokenDaysLeft = data.daysLeft;
      updateTokenStatusUI(data.daysLeft);
      msg.style.color = '#4ade80';
      msg.textContent = '‚úÖ ' + data.message;
      toast(data.message, 'success');
    } catch(e) {
      msg.style.color = '#f87171';
      msg.textContent = '‚ùå ' + e.message;
      toast('Gia h·∫°n th·∫•t b·∫°i: ' + e.message, 'error');
    } finally {
      btn.innerHTML = '<i class="bi bi-arrow-clockwise"></i> Gia H·∫°n Ngay';
      btn.disabled = false;
    }
  }
  // ============================================================
  //  DISCONNECT FACEBOOK
  // ============================================================
  async function doDisconnect() {
    if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ng·∫Øt k·∫øt n·ªëi Facebook kh√¥ng?')) return;
    try {
      await api('DELETE', '/api/facebook/disconnect');
      S.connected = false;
      S.fbUser = null;
      S.pages = [];
      S.page = null;
      S.selectedPages = [];
      S.tokenDaysLeft = null;
      S.tokenExpiresAt = null;
      localStorage.removeItem('gz_connected');
      localStorage.removeItem('gz_fb_user');
      localStorage.removeItem('gz_pages');
      localStorage.removeItem('gz_page');
      localStorage.removeItem('gz_selected_pages');
      document.getElementById('tokenStatusBox').style.display = 'none';
      updateConnUI();
      toast('ƒê√£ ng·∫Øt k·∫øt n·ªëi Facebook', 'info');
    } catch(e) {
      toast('L·ªói: ' + e.message, 'error');
    }
  }
  function updateConnUI() {
    const dot = document.getElementById('connDot');
    const label = document.getElementById('connLabel');
    const btn = document.getElementById('connectBtn');
    const btnLabel = document.getElementById('connectBtnLabel');

    if (S.connected && S.fbUser) {
      dot.classList.add('online');
      label.textContent = S.fbUser.name || S.username;
      btnLabel.textContent = 'ƒê√£ K·∫øt N·ªëi';
      btn.className = 'btn-sm btn-success';
      updateTokenStatusUI(S.tokenDaysLeft);
    } else if (S.loggedIn) {
      dot.classList.add('online');
      label.textContent = S.username;
      btnLabel.textContent = 'K·∫øt N·ªëi FB';
      btn.className = 'btn-sm btn-outline';
    } else {
      dot.classList.remove('online');
      label.textContent = 'Ch∆∞a k·∫øt n·ªëi';
      btnLabel.textContent = 'K·∫øt N·ªëi';
      btn.className = 'btn-sm btn-outline';
    }
  }
  // C·∫≠p nh·∫≠t UI hi·ªÉn th·ªã s·ªë ng√†y c√≤n l·∫°i c·ªßa token
  function updateTokenStatusUI(daysLeft) {
    const box = document.getElementById('tokenStatusBox');
    const label = document.getElementById('tokenDaysLabel');
    const bar = document.getElementById('tokenProgressBar');
    if (!box || daysLeft === null || daysLeft === undefined) return;
    box.style.display = 'block';
    const pct = Math.min(100, Math.max(0, Math.round(daysLeft / 60 * 100)));
    if (daysLeft <= 7) {
      label.textContent = '‚ö†Ô∏è C√≤n ' + daysLeft + ' ng√†y';
      label.style.color = '#f87171';
      bar.style.width = pct + '%';
      bar.style.background = '#ef4444';
    } else if (daysLeft <= 15) {
      label.textContent = '‚ö†Ô∏è C√≤n ' + daysLeft + ' ng√†y';
      label.style.color = '#fbbf24';
      bar.style.width = pct + '%';
      bar.style.background = '#f59e0b';
    } else {
      label.textContent = '‚úÖ C√≤n ' + daysLeft + ' ng√†y';
      label.style.color = '#4ade80';
      bar.style.width = pct + '%';
      bar.style.background = '#22c55e';
    }
  }

  // ============================================================
  //  PAGE MULTI-SELECT
  // ============================================================
  function renderPageSelect(pages) {
    const container = document.getElementById('pageDropdownItems');
    if (!container) return;
    container.innerHTML = '';

    // Restore saved selection
    if (S.selectedPages.length === 0 && S.page) {
      S.selectedPages = [S.page];
    }

    if (pages.length === 0) {
      container.innerHTML = '<div style="padding:14px 16px;font-size:12px;color:rgba(255,255,255,0.35)">Ch∆∞a c√≥ page n√†o. Vui l√≤ng k·∫øt n·ªëi Facebook.</div>';
      return;
    }

    pages.forEach(function(p) {
      const isSelected = S.selectedPages.some(function(sp) { return sp.id === p.id; });
      const avatarHtml = p.picture
        ? '<img src="' + p.picture + '" style="width:32px;height:32px;border-radius:50%;object-fit:cover;flex-shrink:0" onerror="this.style.display=\'none\';this.nextSibling.style.display=\'flex\'" >'
          + '<div style="display:none;width:32px;height:32px;border-radius:50%;background:#1877f2;color:#fff;font-size:13px;font-weight:700;align-items:center;justify-content:center;flex-shrink:0">' + (p.name||'?').charAt(0).toUpperCase() + '</div>'
        : '<div style="width:32px;height:32px;border-radius:50%;background:#1877f2;color:#fff;font-size:13px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0">' + (p.name||'?').charAt(0).toUpperCase() + '</div>';

      const item = document.createElement('div');
      item.setAttribute('data-page-id', p.id);
      item.style.cssText = 'display:flex;align-items:center;gap:10px;padding:10px 14px;cursor:pointer;transition:background .15s;' + (isSelected ? 'background:rgba(24,119,242,0.15);' : '');
      item.innerHTML = avatarHtml
        + '<div style="flex:1;min-width:0">'
        + '<div style="font-size:13px;font-weight:600;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">' + (p.name || 'Page') + '</div>'
        + '<div style="font-size:11px;color:rgba(255,255,255,0.35)">' + p.id + '</div>'
        + '</div>'
        + '<div class="page-check-icon" style="width:18px;height:18px;border-radius:50%;border:2px solid ' + (isSelected ? '#1877f2' : 'rgba(255,255,255,0.2)') + ';background:' + (isSelected ? '#1877f2' : 'transparent') + ';display:flex;align-items:center;justify-content:center;flex-shrink:0">'
        + (isSelected ? '<i class="bi bi-check" style="font-size:11px;color:#fff"></i>' : '')
        + '</div>';

      item.addEventListener('mouseenter', function() { if (!item.classList.contains('selected')) item.style.background = 'rgba(255,255,255,0.04)'; });
      item.addEventListener('mouseleave', function() { if (!item.classList.contains('selected')) item.style.background = S.selectedPages.some(function(sp){return sp.id===p.id;}) ? 'rgba(24,119,242,0.15)' : ''; });
      item.addEventListener('click', function(e) { e.stopPropagation(); togglePageSelection(p); });
      container.appendChild(item);
    });

    updatePageSelectedUI();
  }

  function togglePageDropdown() {
    const dd = document.getElementById('pageDropdownList');
    if (!dd) return;
    const isOpen = dd.style.display !== 'none';
    dd.style.display = isOpen ? 'none' : 'block';
  }

  // Close dropdown when clicking outside
  document.addEventListener('click', function(e) {
    const wrap = document.getElementById('pageMultiSelect');
    if (wrap && !wrap.contains(e.target)) {
      const dd = document.getElementById('pageDropdownList');
      if (dd) dd.style.display = 'none';
    }
  });

  function togglePageSelection(page) {
    const idx = S.selectedPages.findIndex(function(sp) { return sp.id === page.id; });
    if (idx >= 0) {
      S.selectedPages.splice(idx, 1);
    } else {
      S.selectedPages.push(page);
    }
    // Update S.page for backward compat
    S.page = S.selectedPages.length > 0 ? S.selectedPages[0] : null;
    localStorage.setItem('gz_selected_pages', JSON.stringify(S.selectedPages));
    if (S.page) localStorage.setItem('gz_page', JSON.stringify(S.page));
    // Re-render item in dropdown
    const item = document.querySelector('[data-page-id="' + page.id + '"]');
    if (item) {
      const isNowSelected = S.selectedPages.some(function(sp) { return sp.id === page.id; });
      item.style.background = isNowSelected ? 'rgba(24,119,242,0.15)' : '';
      const checkIcon = item.querySelector('.page-check-icon');
      if (checkIcon) {
        checkIcon.style.borderColor = isNowSelected ? '#1877f2' : 'rgba(255,255,255,0.2)';
        checkIcon.style.background = isNowSelected ? '#1877f2' : 'transparent';
        checkIcon.innerHTML = isNowSelected ? '<i class="bi bi-check" style="font-size:11px;color:#fff"></i>' : '';
      }
    }
    updatePageSelectedUI();
  }

  function updatePageSelectedUI() {
    const placeholder = document.getElementById('pageSelectPlaceholder');
    const tagsEl = document.getElementById('pageSelectedTags');
    const countEl = document.getElementById('pageSelectedCount');
    if (!tagsEl) return;

    if (S.selectedPages.length === 0) {
      if (placeholder) placeholder.style.display = 'inline';
      tagsEl.innerHTML = '';
      if (countEl) countEl.textContent = '';
    } else {
      if (placeholder) placeholder.style.display = 'none';
      tagsEl.innerHTML = S.selectedPages.map(function(p) {
        const avatarHtml = p.picture
          ? '<img src="' + p.picture + '" style="width:18px;height:18px;border-radius:50%;object-fit:cover" onerror="this.style.display=\'none\'" >'
          : '<span style="width:18px;height:18px;border-radius:50%;background:#1877f2;color:#fff;font-size:9px;font-weight:700;display:inline-flex;align-items:center;justify-content:center">' + (p.name||'?').charAt(0).toUpperCase() + '</span>';
        return '<span style="display:inline-flex;align-items:center;gap:4px;background:rgba(24,119,242,0.2);border:1px solid rgba(24,119,242,0.4);border-radius:20px;padding:2px 8px 2px 4px;font-size:11px;font-weight:600;color:#60a5fa">'
          + avatarHtml + '<span>' + (p.name||'Page') + '</span>'
          + '<span onclick="event.stopPropagation();togglePageSelection(' + JSON.stringify(p).replace(/"/g,'&quot;') + ')" style="margin-left:2px;cursor:pointer;color:rgba(255,255,255,0.5);font-size:12px;line-height:1">&times;</span>'
          + '</span>';
      }).join('');
      if (countEl) countEl.textContent = 'ƒê√£ ch·ªçn ' + S.selectedPages.length + ' page';
    }
  }

  // Legacy: kept for backward compat (not used in new flow)
  function onPageChange() {}

  // ============================================================
  //  CONTENT
  // ============================================================
  function onContentInput() {
    const ta = document.getElementById('postContent');
    const cc = document.getElementById('charCount');
    const len = ta.value.length;
    cc.textContent = len + ' / 63,206';
    cc.className = 'char-count' + (len > 60000 ? ' over' : len > 50000 ? ' warn' : '');
  }

  function addEmoji(e) {
    const ta = document.getElementById('postContent');
    const start = ta.selectionStart;
    const end = ta.selectionEnd;
    ta.value = ta.value.slice(0, start) + e + ta.value.slice(end);
    ta.selectionStart = ta.selectionEnd = start + e.length;
    ta.focus();
    onContentInput();
  }

  // ============================================================
  //  MEDIA MODE
  // ============================================================
  function setMediaMode(mode) {
    S.mediaMode = mode;
    document.getElementById('modeImgBtn').className = 'media-mode-btn' + (mode === 'image' ? ' active' : '');
    document.getElementById('modeVidBtn').className = 'media-mode-btn' + (mode === 'video' ? ' active' : '');
    document.getElementById('modeMixBtn').className = 'media-mode-btn' + (mode === 'mixed' ? ' active' : '');
    document.getElementById('imageZone').style.display = mode === 'image' ? 'block' : 'none';
    document.getElementById('videoZone').style.display = mode === 'video' ? 'block' : 'none';
    document.getElementById('mixedZone').style.display = mode === 'mixed' ? 'block' : 'none';
    // Clear other modes
    if (mode === 'image') { S.video = null; S.mixImages = []; S.mixVideo = null; renderVideoGrid(); }
    else if (mode === 'video') { S.images = []; S.mixImages = []; S.mixVideo = null; renderImageGrid(); }
    else { S.images = []; S.video = null; renderImageGrid(); renderVideoGrid(); }
  }

  // ‚îÄ‚îÄ Mixed Mode Handlers ‚îÄ‚îÄ
  function onDropMixImages(e) {
    e.preventDefault(); e.currentTarget.classList.remove('drag-over');
    const files = Array.from(e.dataTransfer.files).filter(function(f) { return f.type.startsWith('image/'); });
    addMixImages(files);
  }
  function onDropMixVideo(e) {
    e.preventDefault(); e.currentTarget.classList.remove('drag-over');
    const files = Array.from(e.dataTransfer.files).filter(function(f) { return f.type.startsWith('video/'); });
    if (files.length) setMixVideo(files[0]);
  }
  function onMixImagesSelected(e) { addMixImages(Array.from(e.target.files)); e.target.value = ''; }
  function onMixVideoSelected(e) { if (e.target.files[0]) setMixVideo(e.target.files[0]); e.target.value = ''; }
  function addMixImages(files) {
    if (!S.mixImages) S.mixImages = [];
    const remaining = 10 - S.mixImages.length;
    if (remaining <= 0) return toast('T·ªëi ƒëa 10 ·∫£nh', 'error');
    S.mixImages = S.mixImages.concat(files.slice(0, remaining));
    renderMixImageGrid();
  }
  function removeMixImage(idx) { S.mixImages.splice(idx, 1); renderMixImageGrid(); }
  function setMixVideo(file) {
    if (file.size > 200 * 1024 * 1024) return toast('Video t·ªëi ƒëa 200MB', 'error');
    S.mixVideo = file; renderMixVideoGrid();
  }
  function renderMixImageGrid() {
    if (!S.mixImages) S.mixImages = [];
    const grid = document.getElementById('mixImgGrid');
    const zone = document.getElementById('mixImgDropZone');
    const addBtn = document.getElementById('mixImgAddBtn');
    const count = S.mixImages.length;
    if (!count) { grid.style.display = 'none'; zone.style.display = 'block'; addBtn.style.display = 'none'; return; }
    zone.style.display = 'none'; grid.style.display = 'grid'; addBtn.style.display = 'block';
    const cls = count === 1 ? 'count-1' : count === 2 ? 'count-2' : count === 3 ? 'count-3' : count === 4 ? 'count-4' : 'count-5plus';
    grid.className = 'media-grid ' + cls;
    const show = Math.min(count, 5); const extra = count - show;
    grid.innerHTML = '';
    for (let i = 0; i < show; i++) {
      const url = URL.createObjectURL(S.mixImages[i]);
      const isLast = i === show - 1 && extra > 0;
      const div = document.createElement('div'); div.className = 'media-thumb';
      const img = document.createElement('img'); img.src = url; div.appendChild(img);
      if (isLast) { const ov = document.createElement('div'); ov.className = 'more-overlay'; ov.textContent = '+' + extra; div.appendChild(ov); }
      const rmBtn = document.createElement('button'); rmBtn.className = 'remove-btn'; rmBtn.innerHTML = '<i class="bi bi-x"></i>';
      (function(idx) { rmBtn.onclick = function(e) { e.stopPropagation(); removeMixImage(idx); }; })(i);
      div.appendChild(rmBtn); grid.appendChild(div);
    }
  }
  function renderMixVideoGrid() {
    const grid = document.getElementById('mixVidGrid');
    const zone = document.getElementById('mixVidDropZone');
    if (!S.mixVideo) { grid.style.display = 'none'; zone.style.display = 'block'; return; }
    zone.style.display = 'none'; grid.style.display = 'grid'; grid.className = 'media-grid count-1';
    const url = URL.createObjectURL(S.mixVideo);
    const div = document.createElement('div'); div.className = 'media-thumb';
    const vid = document.createElement('video'); vid.src = url; vid.muted = true; vid.setAttribute('playsinline', ''); vid.style.pointerEvents = 'none'; div.appendChild(vid);
    const badge = document.createElement('div'); badge.className = 'video-badge'; badge.innerHTML = '<i class="bi bi-play-fill"></i> VIDEO'; div.appendChild(badge);
    const rmBtn = document.createElement('button'); rmBtn.className = 'remove-btn'; rmBtn.style.opacity = '1'; rmBtn.innerHTML = '<i class="bi bi-x"></i>';
    rmBtn.onclick = function() { S.mixVideo = null; renderMixVideoGrid(); };
    div.appendChild(rmBtn); grid.innerHTML = ''; grid.appendChild(div);
  }

  // ‚îÄ‚îÄ Drag & Drop ‚îÄ‚îÄ
  function onDragOver(e) { e.preventDefault(); e.currentTarget.classList.add('drag-over'); }
  function onDragLeave(e) { e.currentTarget.classList.remove('drag-over'); }
  function onDropImages(e) {
    e.preventDefault(); e.currentTarget.classList.remove('drag-over');
    const files = Array.from(e.dataTransfer.files).filter(function(f) { return f.type.startsWith('image/'); });
    addImages(files);
  }
  function onDropVideo(e) {
    e.preventDefault(); e.currentTarget.classList.remove('drag-over');
    const files = Array.from(e.dataTransfer.files).filter(function(f) { return f.type.startsWith('video/'); });
    if (files.length) setVideo(files[0]);
  }

  // ‚îÄ‚îÄ Images ‚îÄ‚îÄ
  function onImagesSelected(e) { addImages(Array.from(e.target.files)); e.target.value = ''; }
  function addImages(files) {
    const remaining = 10 - S.images.length;
    if (remaining <= 0) return toast('T·ªëi ƒëa 10 ·∫£nh', 'error');
    S.images = S.images.concat(files.slice(0, remaining));
    renderImageGrid();
  }
  function removeImage(idx) { S.images.splice(idx, 1); renderImageGrid(); }
  function renderImageGrid() {
    const grid = document.getElementById('imgGrid');
    const zone = document.getElementById('imgDropZone');
    const addBtn = document.getElementById('imgAddBtn');
    const count = S.images.length;
    if (!count) {
      grid.style.display = 'none'; zone.style.display = 'block'; addBtn.style.display = 'none'; return;
    }
    zone.style.display = 'none'; grid.style.display = 'grid'; addBtn.style.display = 'block';
    const cls = count === 1 ? 'count-1' : count === 2 ? 'count-2' : count === 3 ? 'count-3' : count === 4 ? 'count-4' : 'count-5plus';
    grid.className = 'media-grid ' + cls;
    const show = Math.min(count, 5);
    const extra = count - show;
    grid.innerHTML = '';
    for (let i = 0; i < show; i++) {
      const url = URL.createObjectURL(S.images[i]);
      const isLast = i === show - 1 && extra > 0;
      const div = document.createElement('div');
      div.className = 'media-thumb';
      const img = document.createElement('img');
      img.src = url; img.alt = '';
      div.appendChild(img);
      if (isLast) {
        const ov = document.createElement('div');
        ov.className = 'more-overlay';
        ov.textContent = '+' + extra;
        div.appendChild(ov);
      }
      const rmBtn = document.createElement('button');
      rmBtn.className = 'remove-btn';
      rmBtn.innerHTML = '<i class="bi bi-x"></i>';
      (function(idx) { rmBtn.onclick = function(e) { e.stopPropagation(); removeImage(idx); }; })(i);
      div.appendChild(rmBtn);
      grid.appendChild(div);
    }
  }

  // ‚îÄ‚îÄ Video ‚îÄ‚îÄ
  function onVideoSelected(e) { if (e.target.files[0]) setVideo(e.target.files[0]); e.target.value = ''; }
  function setVideo(file) {
    if (file.size > 200 * 1024 * 1024) return toast('Video t·ªëi ƒëa 200MB', 'error');
    S.video = file; renderVideoGrid();
  }
  function renderVideoGrid() {
    const grid = document.getElementById('vidGrid');
    const zone = document.getElementById('vidDropZone');
    if (!S.video) { grid.style.display = 'none'; zone.style.display = 'block'; return; }
    zone.style.display = 'none'; grid.style.display = 'grid';
    grid.className = 'media-grid count-1';
    const url = URL.createObjectURL(S.video);
    const div = document.createElement('div');
    div.className = 'media-thumb';
    const vid = document.createElement('video');
    vid.src = url; vid.muted = true; vid.setAttribute('playsinline', '');
    vid.style.pointerEvents = 'none';
    div.appendChild(vid);
    const badge = document.createElement('div');
    badge.className = 'video-badge';
    badge.innerHTML = '<i class="bi bi-play-fill"></i> VIDEO';
    div.appendChild(badge);
    const rmBtn = document.createElement('button');
    rmBtn.className = 'remove-btn'; rmBtn.style.opacity = '1';
    rmBtn.innerHTML = '<i class="bi bi-x"></i>';
    rmBtn.onclick = function() { S.video = null; renderVideoGrid(); };
    div.appendChild(rmBtn);
    grid.innerHTML = ''; grid.appendChild(div);
  }

  // ============================================================
  //  SCHEDULE TOGGLE
  // ============================================================
  function onScheduleToggle() {
    const on = document.getElementById('scheduleToggle').checked;
    document.getElementById('scheduleFields').style.display = on ? 'block' : 'none';
    document.getElementById('scheduleNow').style.display = on ? 'none' : 'block';
  }

  function setGoldenTime(time) {
    const today = new Date();
    const [h, m] = time.split(':');
    today.setHours(parseInt(h), parseInt(m), 0, 0);
    if (today < new Date()) today.setDate(today.getDate() + 1);
    const pad = function(n) { return String(n).padStart(2, '0'); };
    const val = today.getFullYear() + '-' + pad(today.getMonth()+1) + '-' + pad(today.getDate()) + 'T' + pad(today.getHours()) + ':' + pad(today.getMinutes());
    document.getElementById('scheduleTime').value = val;
  }

  // ============================================================
  //  POST NOW
  // ============================================================
  async function doPost() {
    const content = document.getElementById('postContent').value.trim();
    if (!content) return toast('Vui l√≤ng nh·∫≠p n·ªôi dung b√†i vi·∫øt', 'error');
    if (!S.connected || S.selectedPages.length === 0) return toast('Vui l√≤ng k·∫øt n·ªëi Facebook v√† ch·ªçn √≠t nh·∫•t 1 Page', 'error');

    const btn = document.getElementById('postBtn');
    btn.disabled = true;
    const link = document.getElementById('postLink').value.trim();
    let successCount = 0, failCount = 0;

    for (let pi = 0; pi < S.selectedPages.length; pi++) {
      const page = S.selectedPages[pi];
      try {
        let photoIds = [];
        let videoId = null;
        btn.innerHTML = '<span class="spinner"></span> ƒêang x·ª≠ l√Ω page ' + (pi+1) + '/' + S.selectedPages.length + '...';

        // Upload images (mode: image)
        if (S.mediaMode === 'image' && S.images.length > 0) {
          const fd = new FormData();
          S.images.forEach(function(f) { fd.append('files', f); });
          fd.append('pageId', page.id);
          const res = await fetch(API_BASE + '/api/facebook/upload-media?pageId=' + encodeURIComponent(page.id), {
            method: 'POST',
            headers: { 'Authorization': 'Bearer ' + S.jwtToken },
            body: fd
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || 'Upload ·∫£nh th·∫•t b·∫°i');
          photoIds = data.photoIds || [];
        }
        // Upload video (mode: video)
        if (S.mediaMode === 'video' && S.video) {
          const fd = new FormData();
          fd.append('files', S.video);
          const res = await fetch(API_BASE + '/api/facebook/upload-media?pageId=' + encodeURIComponent(page.id), {
            method: 'POST',
            headers: { 'Authorization': 'Bearer ' + S.jwtToken },
            body: fd
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || 'Upload video th·∫•t b·∫°i');
          videoId = data.videoId || null;
        }
        // Upload mixed
        if (S.mediaMode === 'mixed') {
          if (!S.mixImages) S.mixImages = [];
          if (S.mixImages.length > 0) {
            const fd = new FormData();
            S.mixImages.forEach(function(f) { fd.append('files', f); });
            const res = await fetch(API_BASE + '/api/facebook/upload-media?pageId=' + encodeURIComponent(page.id), {
              method: 'POST',
              headers: { 'Authorization': 'Bearer ' + S.jwtToken },
              body: fd
            });
            const data = await res.json();
            if (!res.ok) throw new Error(data.error || 'Upload ·∫£nh th·∫•t b·∫°i');
            photoIds = data.photoIds || [];
          }
          if (S.mixVideo) {
            const fd = new FormData();
            fd.append('files', S.mixVideo);
            const res = await fetch(API_BASE + '/api/facebook/upload-media?pageId=' + encodeURIComponent(page.id), {
              method: 'POST',
              headers: { 'Authorization': 'Bearer ' + S.jwtToken },
              body: fd
            });
            const data = await res.json();
            if (!res.ok) throw new Error(data.error || 'Upload video th·∫•t b·∫°i');
            videoId = data.videoId || null;
          }
        }

        const result = await api('POST', '/api/facebook/post', {
          pageId: page.id,
          content: content,
          linkUrl: link || null,
          photoIds: photoIds,
          videoId: videoId
        });
        addToHistory({ content, page: page.name, status: 'posted', postId: result.postId, time: new Date().toISOString() });
        successCount++;
      } catch(e) {
        addToHistory({ content, page: page.name, status: 'failed', error: e.message, time: new Date().toISOString() });
        failCount++;
      }
    }

    if (successCount > 0 && failCount === 0) {
      toast('ƒêƒÉng b√†i th√†nh c√¥ng l√™n ' + successCount + ' page!', 'success');
      clearForm();
    } else if (successCount > 0) {
      toast('ƒêƒÉng ' + successCount + ' th√†nh c√¥ng, ' + failCount + ' th·∫•t b·∫°i', 'warning');
    } else {
      toast('ƒêƒÉng b√†i th·∫•t b·∫°i tr√™n t·∫•t c·∫£ page', 'error');
    }
    updateStats();
    btn.innerHTML = '<i class="bi bi-send-fill"></i> ƒêƒÉng Ngay';
    btn.disabled = false;
  }

  // ============================================================
  //  SCHEDULE
  // ============================================================
  async function doSchedule() {
    const content = document.getElementById('postContent').value.trim();
    const timeVal = document.getElementById('scheduleTime').value;
    if (!content) return toast('Vui l√≤ng nh·∫≠p n·ªôi dung', 'error');
    if (!timeVal) return toast('Vui l√≤ng ch·ªçn th·ªùi gian ƒëƒÉng', 'error');
    if (!S.connected || S.selectedPages.length === 0) return toast('Vui l√≤ng k·∫øt n·ªëi Facebook v√† ch·ªçn √≠t nh·∫•t 1 Page', 'error');

    const schedTime = new Date(timeVal);
    if (schedTime <= new Date()) return toast('Th·ªùi gian ph·∫£i trong t∆∞∆°ng lai', 'error');

    try {
      for (let pi = 0; pi < S.selectedPages.length; pi++) {
        const page = S.selectedPages[pi];
        if (S.loggedIn) {
          await api('POST', '/api/posts/schedule', {
            pageId: page.id,
            pageName: page.name,
            content: content,
            scheduledAt: schedTime.toISOString(),
            repeatType: document.getElementById('scheduleRepeat').value
          });
        }
        addToHistory({
          content, page: page.name, status: 'pending',
          scheduledTime: schedTime.toISOString(), time: new Date().toISOString()
        });
      }
      toast('ƒê√£ l√™n l·ªãch cho ' + S.selectedPages.length + ' page: ' + schedTime.toLocaleString('vi-VN'), 'success');
      renderPosts(); updateStats();
    } catch(e) {
      toast('L·ªói: ' + e.message, 'error');
    }
  }

  // ============================================================
  //  DRAFT
  // ============================================================
  function saveDraft() {
    const content = document.getElementById('postContent').value.trim();
    if (!content) return toast('Kh√¥ng c√≥ n·ªôi dung ƒë·ªÉ l∆∞u', 'error');
    const pageNames = S.selectedPages.length > 0 ? S.selectedPages.map(function(p){return p.name;}).join(', ') : (S.page ? S.page.name : '?');
    addToHistory({ content, page: pageNames, status: 'draft', time: new Date().toISOString() });
    toast('ƒê√£ l∆∞u nh√°p', 'info');
    renderPosts(); updateStats();
  }

  // ============================================================
  //  HISTORY
  // ============================================================
  function addToHistory(item) {
    S.posts.unshift(item);
    if (S.posts.length > 100) S.posts.pop();
    localStorage.setItem('gz_posts', JSON.stringify(S.posts));
    renderPosts();
  }

  function filterHistory(status) {
    renderPosts(status);
  }

  function renderPosts(filter) {
    const list = document.getElementById('historyList');
    const sched = document.getElementById('scheduledList');
    let posts = S.posts;
    if (filter && filter !== 'all') posts = posts.filter(function(p) { return p.status === filter; });

    const pending = S.posts.filter(function(p) { return p.status === 'pending'; });

    // Scheduled list
    if (!pending.length) {
      sched.innerHTML = '<div style="text-align:center;padding:30px;color:rgba(255,255,255,0.3);font-size:13px"><i class="bi bi-calendar-x" style="font-size:28px;display:block;margin-bottom:8px"></i>Ch∆∞a c√≥ b√†i n√†o l√™n l·ªãch</div>';
    } else {
      sched.innerHTML = pending.map(function(p, i) { return renderPostItem(p, i); }).join('');
    }

    // History list
    if (!posts.length) {
      list.innerHTML = '<div style="text-align:center;padding:30px;color:rgba(255,255,255,0.3);font-size:13px"><i class="bi bi-inbox" style="font-size:28px;display:block;margin-bottom:8px"></i>Ch∆∞a c√≥ l·ªãch s·ª≠</div>';
    } else {
      list.innerHTML = posts.map(function(p, i) { return renderPostItem(p, i); }).join('');
    }

    // Badge
    document.getElementById('sidebarBadge').textContent = pending.length;
  }

  function renderPostItem(p, i) {
    const statusMap = { pending: 'status-pending', posted: 'status-posted', failed: 'status-failed', draft: 'status-draft' };
    const statusLabel = { pending: 'Ch·ªù ƒëƒÉng', posted: 'ƒê√£ ƒëƒÉng', failed: 'Th·∫•t b·∫°i', draft: 'Nh√°p' };
    const timeStr = p.scheduledTime
      ? 'L√™n l·ªãch: ' + new Date(p.scheduledTime).toLocaleString('vi-VN')
      : new Date(p.time).toLocaleString('vi-VN');
    return '<div class="post-item">' +
      '<div class="post-item-header">' +
        '<div class="post-item-meta">' + (p.page || '?') + ' ¬∑ ' + timeStr + '</div>' +
        '<span class="post-status ' + (statusMap[p.status] || '') + '">' + (statusLabel[p.status] || p.status) + '</span>' +
      '</div>' +
      '<div class="post-content">' + p.content.substring(0, 120) + (p.content.length > 120 ? '...' : '') + '</div>' +
      '<div class="post-actions">' +
        '<button class="post-action-btn" onclick="editPost(' + i + ')"><i class="bi bi-pencil"></i> S·ª≠a</button>' +
        (p.status === 'failed' ? '<button class="post-action-btn" onclick="retryPost(' + i + ')"><i class="bi bi-arrow-clockwise"></i> Th·ª≠ l·∫°i</button>' : '') +
        '<button class="post-action-btn" onclick="deletePost(' + i + ')"><i class="bi bi-trash"></i></button>' +
      '</div>' +
    '</div>';
  }

  function editPost(i) {
    document.getElementById('postContent').value = S.posts[i].content;
    onContentInput();
    toast('ƒê√£ t·∫£i l·∫°i n·ªôi dung b√†i vi·∫øt', 'info');
  }

  function retryPost(i) {
    document.getElementById('postContent').value = S.posts[i].content;
    onContentInput();
    toast('ƒê√£ t·∫£i l·∫°i ‚Äî nh·∫•n ƒêƒÉng Ngay ƒë·ªÉ th·ª≠ l·∫°i', 'info');
  }

  function deletePost(i) {
    S.posts.splice(i, 1);
    localStorage.setItem('gz_posts', JSON.stringify(S.posts));
    renderPosts(); updateStats();
  }

  // ============================================================
  //  STATS
  // ============================================================
  function updateStats() {
    const posted = S.posts.filter(function(p) { return p.status === 'posted'; });
    const pending = S.posts.filter(function(p) { return p.status === 'pending'; });
    const failed = S.posts.filter(function(p) { return p.status === 'failed'; });
    const total = posted.length + failed.length;
    const rate = total ? Math.round(posted.length / total * 100) + '%' : '‚Äî';

    document.getElementById('statPosted').textContent = posted.filter(function(p) {
      return new Date(p.time).toDateString() === new Date().toDateString();
    }).length;
    document.getElementById('statPending').textContent = pending.length;
    document.getElementById('statRate').textContent = rate;
    document.getElementById('statFailed').textContent = failed.length;
    document.getElementById('statsRate').textContent = rate;
    document.getElementById('statsAI').textContent = S.aiCount;
    document.getElementById('statsTotal').textContent = total;
    document.getElementById('statsTime').textContent = Math.round(total * 0.5) + 'h';
  }

  // ============================================================
  //  SCHEDULER CHECK
  // ============================================================
  async function checkScheduler() {
    if (!S.connected || !S.loggedIn) return;
    const now = new Date();
    for (let i = 0; i < S.posts.length; i++) {
      const p = S.posts[i];
      if (p.status === 'pending' && p.scheduledTime && new Date(p.scheduledTime) <= now) {
        try {
          const pageId = p.pageId || (S.selectedPages.length > 0 ? S.selectedPages[0].id : (S.page ? S.page.id : ''));
          await api('POST', '/api/facebook/post', { pageId: pageId, content: p.content });
          S.posts[i].status = 'posted';
          toast('ƒê√£ t·ª± ƒë·ªông ƒëƒÉng b√†i l√™n l·ªãch!', 'success');
        } catch(e) {
          S.posts[i].status = 'failed';
          S.posts[i].error = e.message;
        }
        localStorage.setItem('gz_posts', JSON.stringify(S.posts));
        renderPosts(); updateStats();
      }
    }
  }

  // ============================================================
  //  PREVIEW
  // ============================================================
  function openPreview() {
    const content = document.getElementById('postContent').value.trim();
    const wrap = document.getElementById('fbPreviewWrap');
    const page = S.selectedPages.length > 0 ? S.selectedPages[0] : S.page;
    const pageName = page ? page.name : 'T√™n Facebook Page';
    const avatarUrl = page && page.picture ? page.picture : '';

    // Build media HTML
    let mediaHtml = '';
    const files = S.mediaMode === 'image' ? S.images : (S.video ? [S.video] : []);
    if (files.length > 0) {
      const count = files.length;
      const cls = count === 1 ? 'count-1' : count === 2 ? 'count-2' : count === 3 ? 'count-3' : count === 4 ? 'count-4' : 'count-5plus';
      const show = Math.min(count, 5);
      const extra = count - show;
      let items = '';
      for (let i = 0; i < show; i++) {
        const url = URL.createObjectURL(files[i]);
        const isLast = i === show - 1 && extra > 0;
        const isVideo = S.mediaMode === 'video';
        items += '<div class="fb-media-item">';
        if (isVideo) {
          items += '<video src="' + url + '" muted playsinline style="pointer-events:none"></video>';
        } else {
          items += '<img src="' + url + '" alt="">';
        }
        if (isLast) items += '<div class="fb-more-overlay">+' + extra + '</div>';
        items += '</div>';
      }
      mediaHtml = '<div class="fb-media-grid ' + cls + '">' + items + '</div>';
    }

    const avatarInner = avatarUrl
      ? '<img src="' + avatarUrl + '" alt="">'
      : pageName.charAt(0).toUpperCase();

    wrap.innerHTML =
      '<div class="fb-post-header">' +
        '<div class="fb-avatar">' + avatarInner + '</div>' +
        '<div class="fb-page-info">' +
          '<div class="fb-page-name">' + pageName + ' <span class="fb-verified">&#10003;</span></div>' +
          '<div class="fb-post-time">V·ª´a xong &nbsp;¬∑&nbsp; üåê</div>' +
        '</div>' +
        '<button class="fb-more-btn">¬∑¬∑¬∑</button>' +
      '</div>' +
      '<div class="fb-post-text">' + (content || '(Ch∆∞a c√≥ n·ªôi dung)') + '</div>' +
      mediaHtml +
      '<div class="fb-reactions">' +
        '<div class="fb-reaction-icons">üëç ‚ù§Ô∏è üòÜ</div>' +
        '<div class="fb-reaction-count">1,2K ¬∑ 248 b√¨nh lu·∫≠n ¬∑ 56 l∆∞·ª£t chia s·∫ª</div>' +
      '</div>' +
      '<div class="fb-action-bar">' +
        '<button class="fb-action-btn">üëç Th√≠ch</button>' +
        '<button class="fb-action-btn">üí¨ B√¨nh lu·∫≠n</button>' +
        '<button class="fb-action-btn">‚Üó Chia s·∫ª</button>' +
      '</div>';

    openModal('previewModal');
  }

  // ============================================================
  //  AI
  // ============================================================
  async function genAI() {
    const topic = document.getElementById('aiTopic').value.trim();
    if (!topic) return toast('Vui l√≤ng nh·∫≠p ch·ªß ƒë·ªÅ', 'error');
    const btn = document.getElementById('aiBtn');
    btn.innerHTML = '<span class="spinner"></span> AI ƒëang t·∫°o...';
    btn.disabled = true;
    const resultsEl = document.getElementById('aiResults');
    resultsEl.innerHTML = '<div style="text-align:center;padding:16px;color:rgba(255,255,255,0.4);font-size:13px"><span class="spinner"></span> ƒêang t·∫°o n·ªôi dung...</div>';

    const tone = document.getElementById('aiTone').value;
    const industry = document.getElementById('aiIndustry').value;
    const length = document.getElementById('aiLength').value;

    try {
      let versions = [];
      // Lu√¥n g·ªçi qua backend ‚Äî API key ƒë∆∞·ª£c b·∫£o m·∫≠t ·ªü server, kh√¥ng l·ªô ra frontend
      if (S.loggedIn) {
        try {
          const data = await api('POST', '/api/ai/generate', { topic, tone, industry, length });
          versions = data.posts || data.versions || [];
        } catch(e) { versions = []; }
      }

      if (!versions.length) versions = getFallbackVersions(topic, tone);

      S.aiCount += 3;
      updateStats();

      resultsEl.innerHTML = versions.map(function(v, i) {
        return '<div class="ai-result-item">' +
          '<div style="font-size:11px;color:rgba(255,255,255,0.35);margin-bottom:6px">Phi√™n b·∫£n ' + (i+1) + '</div>' +
          v.replace(/</g, '&lt;').replace(/>/g, '&gt;') +
          '<button class="use-btn" onclick="useAIVersion(this)">D√πng</button>' +
        '</div>';
      }).join('');

      // Hashtags
      const tags = getHashtags(topic, industry);
      document.getElementById('hashtagSection').style.display = 'block';
      document.getElementById('hashtagList').innerHTML = tags.map(function(t) {
        return '<span class="hashtag-chip" onclick="addHashtag(\'' + t + '\')">' + t + '</span>';
      }).join('');

    } catch(e) {
      const versions = getFallbackVersions(topic, tone);
      S.aiCount += 3; updateStats();
      resultsEl.innerHTML = versions.map(function(v, i) {
        return '<div class="ai-result-item">' +
          '<div style="font-size:11px;color:rgba(255,255,255,0.35);margin-bottom:6px">Phi√™n b·∫£n ' + (i+1) + '</div>' +
          v.replace(/</g, '&lt;').replace(/>/g, '&gt;') +
          '<button class="use-btn" onclick="useAIVersion(this)">D√πng</button>' +
        '</div>';
      }).join('');
    } finally {
      btn.innerHTML = '<i class="bi bi-stars"></i> T·∫°o 3 Phi√™n B·∫£n AI';
      btn.disabled = false;
    }
  }

  function useAIVersion(btn) {
    const text = btn.parentElement.textContent.replace('D√πng', '').replace(/^Phi√™n b·∫£n \d/, '').trim();
    document.getElementById('postContent').value = text;
    onContentInput();
    toast('ƒê√£ √°p d·ª•ng n·ªôi dung AI', 'success');
  }

  function addHashtag(tag) {
    const ta = document.getElementById('postContent');
    ta.value = ta.value + ' ' + tag;
    onContentInput();
  }

  function getFallbackVersions(topic, tone) {
    const toneMap = {
      professional: 'Ch√∫ng t√¥i tr√¢n tr·ªçng th√¥ng b√°o',
      friendly: '∆†i b·∫°n ∆°i! C√≥ tin vui n√†y',
      funny: 'C·∫£nh b√°o: ƒê·ªçc xong c√≥ th·ªÉ nghi·ªán',
      urgent: 'KH·∫®N! ƒê·ª´ng b·ªè l·ª°',
      inspiring: 'H√†nh tr√¨nh ng√†n d·∫∑m b·∫Øt ƒë·∫ßu t·ª´',
      storytelling: 'C√≥ m·ªôt c√¢u chuy·ªán v·ªÅ',
      viral: 'Ai c≈©ng ƒëang n√≥i v·ªÅ ƒëi·ªÅu n√†y'
    };
    const prefix = toneMap[tone] || 'Tin t·ª©c m·ªõi';
    return [
      prefix + ' v·ªÅ ' + topic + '!\n\nCh√∫ng t√¥i r·∫•t vui ƒë∆∞·ª£c chia s·∫ª ƒëi·ªÅu n√†y v·ªõi b·∫°n. H√£y li√™n h·ªá ngay ƒë·ªÉ bi·∫øt th√™m chi ti·∫øt!\n\nüëâ Nh·∫Øn tin ngay ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n mi·ªÖn ph√≠',
      'üî• ' + topic + ' - ƒê·ª´ng b·ªè l·ª°!\n\nƒê√¢y l√† c∆° h·ªôi tuy·ªát v·ªùi d√†nh cho b·∫°n. S·ªë l∆∞·ª£ng c√≥ h·∫°n, h√£y nhanh tay!\n\n‚úÖ Uy t√≠n - Ch·∫•t l∆∞·ª£ng - Gi√° t·ªët\nüìû Li√™n h·ªá ngay!',
      'üíé ' + topic + '\n\nB·∫°n ƒëang t√¨m ki·∫øm ƒëi·ªÅu n√†y? Ch√∫ng t√¥i c√≥ gi·∫£i ph√°p ho√†n h·∫£o!\n\n‚≠ê H∆°n 1000 kh√°ch h√†ng h√†i l√≤ng\nüéØ Cam k·∫øt ch·∫•t l∆∞·ª£ng 100%\n\nComment ho·∫∑c inbox ƒë·ªÉ bi·∫øt th√™m!'
    ];
  }

  function getHashtags(topic, industry) {
    const base = ['#' + topic.replace(/\s+/g, ''), '#muas·∫Øm', '#khuy·∫ønm√£i', '#sale', '#hot'];
    const industryTags = {
      ecommerce: ['#th∆∞∆°ngm·∫°i', '#mua_b√°n', '#shopee', '#lazada'],
      food: ['#·∫©mth·ª±c', '#ƒë·ªìƒÉn', '#foodie', '#ngon'],
      tech: ['#c√¥ng_ngh·ªá', '#tech', '#digital', '#AI'],
      beauty: ['#l√†mƒë·∫πp', '#beauty', '#skincare', '#makeup'],
      fashion: ['#th·ªùitrang', '#fashion', '#ootd', '#style'],
      education: ['#gi√°od·ª•c', '#h·ªçc', '#kho√°h·ªçc', '#skills'],
      realestate: ['#b·∫•tƒë·ªôngs·∫£n', '#nh√†ƒë·∫•t', '#mua_nh√†'],
      health: ['#s·ª©ckh·ªèe', '#health', '#wellness'],
      travel: ['#dul·ªãch', '#travel', '#kh√°mph√°'],
      finance: ['#t√†ich√≠nh', '#ƒë·∫ßut∆∞', '#ti·∫øtki·ªám']
    };
    return base.concat((industryTags[industry] || [])).slice(0, 8);
  }

  // ============================================================
  //  CLEAR FORM
  // ============================================================
  function clearForm() {
    document.getElementById('postContent').value = '';
    document.getElementById('postLink').value = '';
    S.images = []; S.video = null;
    renderImageGrid(); renderVideoGrid();
    onContentInput();
  }

  // ============================================================
  //  SETTINGS
  // ============================================================
  function saveSettings() {
    // API key b·∫£o m·∫≠t ·ªü backend
    closeModal('settingsModal');
    toast('ƒê√£ l∆∞u c√†i ƒë·∫∑t', 'success');
  }

  // ============================================================
  //  TABS
  // ============================================================
  function switchTab(paneId, groupId, btn) {
    const parent = btn.closest('.card-body') || btn.closest('.tab-bar').parentElement;
    parent.querySelectorAll('.tab-pane').forEach(function(p) { p.classList.remove('active'); });
    parent.querySelectorAll('.tab-btn').forEach(function(b) { b.classList.remove('active'); });
    document.getElementById(paneId).classList.add('active');
    btn.classList.add('active');
  }

  function switchAuthTab(paneId) {
    document.querySelectorAll('.auth-pane').forEach(function(p) { p.classList.remove('active'); });
    document.querySelectorAll('.auth-tab').forEach(function(t) { t.classList.remove('active'); });
    document.getElementById(paneId).classList.add('active');
    // Highlight tab t∆∞∆°ng ·ª©ng
    const tabMap = { 'authLogin': 0, 'authRegister': 1, 'authFacebook': 2 };
    const tabs = document.querySelectorAll('.auth-tab');
    if (tabMap[paneId] !== undefined && tabs[tabMap[paneId]]) {
      tabs[tabMap[paneId]].classList.add('active');
    } else if (event && event.currentTarget) {
      event.currentTarget.classList.add('active');
    }
    // N·∫øu chuy·ªÉn sang tab Facebook, c·∫≠p nh·∫≠t n·ªôi dung
    if (paneId === 'authFacebook') {
      updateFBTabContent();
    }
  }

  function updateFBTabContent() {
    const needLogin = document.getElementById('fbNeedLoginMsg');
    const content = document.getElementById('fbConnectContent');
    if (!needLogin || !content) return;
    if (S.loggedIn) {
      needLogin.style.display = 'none';
      content.style.display = 'block';
      // N·∫øu ƒë√£ k·∫øt n·ªëi Facebook, hi·ªÉn th·ªã token status
      if (S.connected && S.fbUser) {
        updateTokenStatusUI(S.tokenDaysLeft);
      }
    } else {
      needLogin.style.display = 'block';
      content.style.display = 'none';
    }
  }

  // ============================================================
  //  MODAL
  // ============================================================
  function toggleSubNav(e, id) {
    e.preventDefault();
    const el = document.getElementById(id);
    const arrow = document.getElementById(id + 'Arrow');
    const isOpen = el.style.display !== 'none';
    el.style.display = isOpen ? 'none' : 'block';
    if (arrow) arrow.style.transform = isOpen ? '' : 'rotate(180deg)';
  }

  function openModal(id) {
    document.getElementById(id).classList.remove('hidden');
    if (id === 'connectModal') {
      if (S.loggedIn) {
        // N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p GenZTech, t·ª± ƒë·ªông chuy·ªÉn sang tab Facebook
        switchAuthTabDirect('authFacebook');
      } else {
        // N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p, hi·ªÉn th·ªã tab ƒëƒÉng nh·∫≠p
        switchAuthTabDirect('authLogin');
      }
    }
  }

  // Chuy·ªÉn tab kh√¥ng c·∫ßn event
  function switchAuthTabDirect(paneId) {
    document.querySelectorAll('.auth-pane').forEach(function(p) { p.classList.remove('active'); });
    document.querySelectorAll('.auth-tab').forEach(function(t) { t.classList.remove('active'); });
    const el = document.getElementById(paneId);
    if (el) el.classList.add('active');
    const tabMap = { 'authLogin': 0, 'authRegister': 1, 'authFacebook': 2 };
    const tabs = document.querySelectorAll('.auth-tab');
    if (tabMap[paneId] !== undefined && tabs[tabMap[paneId]]) {
      tabs[tabMap[paneId]].classList.add('active');
    }
    if (paneId === 'authFacebook') {
      updateFBTabContent();
    }
  }

  function closeModal(id) {
    document.getElementById(id).classList.add('hidden');
  }

  // ============================================================
  //  TOAST
  // ============================================================
  function toast(msg, type) {
    type = type || 'info';
    const icons = { success: 'bi-check-circle-fill', error: 'bi-x-circle-fill', info: 'bi-info-circle-fill' };
    const colors = { success: '#4ade80', error: '#f87171', info: '#60a5fa' };
    const el = document.createElement('div');
    el.className = 'toast ' + type;
    el.innerHTML = '<i class="bi ' + (icons[type] || icons.info) + '" style="color:' + (colors[type] || colors.info) + ';font-size:16px"></i>' + msg;
    document.getElementById('toastContainer').appendChild(el);
    setTimeout(function() { el.remove(); }, 4000);
  }

  // ============================================================
  //  CLOSE MODAL ON OVERLAY CLICK
  // ============================================================
  document.querySelectorAll('.modal-bg').forEach(function(m) {
    m.addEventListener('click', function(e) { if (e.target === m) m.classList.add('hidden'); });
  });

  // ============================================================
  //  BACKGROUND ENGINE (from maindashboard)
  // ============================================================
  (function() {
    const isMobile = window.innerWidth < 768;
    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

    // ‚îÄ‚îÄ Starfield ‚îÄ‚îÄ
    const canvasFar  = document.getElementById('starfield-far');
    const canvasMid  = document.getElementById('starfield-mid');
    const canvasNear = document.getElementById('starfield-near');
    const ctxFar  = canvasFar.getContext('2d');
    const ctxMid  = canvasMid.getContext('2d');
    const ctxNear = canvasNear.getContext('2d');

    function resizeCanvases() {
      [canvasFar, canvasMid, canvasNear].forEach(function(c) {
        c.width = window.innerWidth; c.height = window.innerHeight;
      });
    }
    resizeCanvases();
    window.addEventListener('resize', resizeCanvases);

    const mul = isMobile ? 0.5 : 1;
    const starsFar = [], starsMid = [], starsNear = [];
    for (let i = 0; i < Math.floor(200 * mul); i++) {
      starsFar.push({ x: Math.random() * canvasFar.width, y: Math.random() * canvasFar.height, radius: Math.random() * 0.8 + 0.2, opacity: Math.random() * 0.3 + 0.2 });
    }
    for (let i = 0; i < Math.floor(100 * mul); i++) {
      starsMid.push({ x: Math.random() * canvasMid.width, y: Math.random() * canvasMid.height, radius: Math.random() * 1.2 + 0.5, vx: (Math.random() - 0.5) * 0.2, vy: (Math.random() - 0.5) * 0.2, opacity: Math.random() * 0.5 + 0.3 });
    }
    for (let i = 0; i < Math.floor(50 * mul); i++) {
      starsNear.push({ x: Math.random() * canvasNear.width, y: Math.random() * canvasNear.height, radius: Math.random() * 1.8 + 0.8, vx: (Math.random() - 0.5) * 0.4, vy: (Math.random() - 0.5) * 0.4, opacity: Math.random() * 0.7 + 0.3, pulse: Math.random() * Math.PI * 2 });
    }

    const shootingStars = [];
    let lastSSTime = 0;

    function ShootingStar() {
      this.reset = function() {
        this.length = Math.random() * 200 + 100;
        this.speed = Math.random() * 2 + 1;
        this.size = Math.random() * 2 + 1.5;
        this.dirX = Math.random() < 0.5 ? 1 : -1;
        this.x = this.dirX === 1 ? -100 : canvasFar.width + 100;
        this.y = Math.random() * canvasFar.height * 0.5;
        this.vx = this.dirX * this.speed;
        this.vy = this.speed * 0.5;
        this.opacity = 0; this.life = 0; this.maxLife = 200; this.active = true;
      };
      this.update = function() {
        this.x += this.vx; this.y += this.vy; this.life++;
        if (this.life < 20) this.opacity = this.life / 20;
        else if (this.life > this.maxLife - 40) this.opacity = (this.maxLife - this.life) / 40;
        else this.opacity = 1;
        if (this.life >= this.maxLife || this.x < -300 || this.x > canvasFar.width + 300 || this.y > canvasFar.height + 300) this.active = false;
      };
      this.draw = function(ctx) {
        if (!this.active) return;
        const tx = this.x - this.vx * (this.length / this.speed);
        const ty = this.y - this.vy * (this.length / this.speed);
        const g = ctx.createLinearGradient(this.x, this.y, tx, ty);
        g.addColorStop(0, 'rgba(255,255,255,' + this.opacity + ')');
        g.addColorStop(1, 'rgba(255,255,255,0)');
        ctx.strokeStyle = g; ctx.lineWidth = this.size; ctx.lineCap = 'round';
        ctx.beginPath(); ctx.moveTo(this.x, this.y); ctx.lineTo(tx, ty); ctx.stroke();
        ctx.fillStyle = 'rgba(255,255,255,' + this.opacity + ')';
        ctx.beginPath(); ctx.arc(this.x, this.y, this.size * 1.5, 0, Math.PI * 2); ctx.fill();
        ctx.fillStyle = 'rgba(100,200,255,' + (this.opacity * 0.5) + ')';
        ctx.beginPath(); ctx.arc(this.x, this.y, this.size * 5, 0, Math.PI * 2); ctx.fill();
      };
      this.reset();
    }

    function animateStarfield() {
      ctxFar.clearRect(0, 0, canvasFar.width, canvasFar.height);
      starsFar.forEach(function(s) {
        ctxFar.fillStyle = 'rgba(255,255,255,' + s.opacity + ')';
        ctxFar.beginPath(); ctxFar.arc(s.x, s.y, s.radius, 0, Math.PI * 2); ctxFar.fill();
      });

      const now = Date.now();
      if (now - lastSSTime > Math.random() * 1000 + 500 && shootingStars.length < 8) {
        shootingStars.push(new ShootingStar()); lastSSTime = now;
      }

      ctxMid.clearRect(0, 0, canvasMid.width, canvasMid.height);
      for (let i = shootingStars.length - 1; i >= 0; i--) {
        shootingStars[i].update(); shootingStars[i].draw(ctxMid);
        if (!shootingStars[i].active) shootingStars.splice(i, 1);
      }
      starsMid.forEach(function(s) {
        s.x += s.vx; s.y += s.vy;
        if (s.x < 0) s.x = canvasMid.width; if (s.x > canvasMid.width) s.x = 0;
        if (s.y < 0) s.y = canvasMid.height; if (s.y > canvasMid.height) s.y = 0;
        ctxMid.fillStyle = 'rgba(255,255,255,' + s.opacity + ')';
        ctxMid.beginPath(); ctxMid.arc(s.x, s.y, s.radius, 0, Math.PI * 2); ctxMid.fill();
      });

      ctxNear.clearRect(0, 0, canvasNear.width, canvasNear.height);
      starsNear.forEach(function(s) {
        s.x += s.vx; s.y += s.vy; s.pulse += 0.02;
        if (s.x < 0) s.x = canvasNear.width; if (s.x > canvasNear.width) s.x = 0;
        if (s.y < 0) s.y = canvasNear.height; if (s.y > canvasNear.height) s.y = 0;
        const po = s.opacity * (0.7 + Math.sin(s.pulse) * 0.3);
        if (isMobile) {
          ctxNear.fillStyle = 'rgba(24,119,242,' + po + ')';
          ctxNear.beginPath(); ctxNear.arc(s.x, s.y, s.radius, 0, Math.PI * 2); ctxNear.fill();
        } else {
          const g = ctxNear.createRadialGradient(s.x, s.y, 0, s.x, s.y, s.radius * 3);
          g.addColorStop(0, 'rgba(24,119,242,' + po + ')');
          g.addColorStop(0.5, 'rgba(0,212,255,' + (po * 0.5) + ')');
          g.addColorStop(1, 'rgba(0,212,255,0)');
          ctxNear.fillStyle = g;
          ctxNear.beginPath(); ctxNear.arc(s.x, s.y, s.radius * 3, 0, Math.PI * 2); ctxNear.fill();
        }
      });
      requestAnimationFrame(animateStarfield);
    }
    animateStarfield();

    // ‚îÄ‚îÄ Constellation ‚îÄ‚îÄ
    if (!isMobile) {
      const canvasCon = document.getElementById('constellation-lines');
      const ctxCon = canvasCon.getContext('2d');
      canvasCon.width = window.innerWidth; canvasCon.height = window.innerHeight;
      const pts = [];
      for (let i = 0; i < 15; i++) {
        pts.push({ x: Math.random() * canvasCon.width, y: Math.random() * canvasCon.height, connections: [] });
      }
      pts.forEach(function(p, i) {
        const n = Math.floor(Math.random() * 2) + 1;
        for (let j = 0; j < n; j++) {
          const t = Math.floor(Math.random() * pts.length);
          if (t !== i && !p.connections.includes(t)) p.connections.push(t);
        }
      });
      let conOp = 0;
      let scrollVel = 0, lastSY = 0;
      window.addEventListener('scroll', function() {
        scrollVel = window.scrollY - lastSY; lastSY = window.scrollY;
      });
      function animateCon() {
        ctxCon.clearRect(0, 0, canvasCon.width, canvasCon.height);
        if (Math.abs(scrollVel) > 5) conOp = Math.min(conOp + 0.02, 0.3);
        else conOp = Math.max(conOp - 0.01, 0);
        if (conOp > 0) {
          pts.forEach(function(p) {
            p.connections.forEach(function(ti) {
              const t = pts[ti];
              const g = ctxCon.createLinearGradient(p.x, p.y, t.x, t.y);
              g.addColorStop(0, 'rgba(24,119,242,' + conOp + ')');
              g.addColorStop(0.5, 'rgba(0,212,255,' + (conOp * 0.7) + ')');
              g.addColorStop(1, 'rgba(138,43,226,' + (conOp * 0.5) + ')');
              ctxCon.strokeStyle = g; ctxCon.lineWidth = 1;
              ctxCon.beginPath(); ctxCon.moveTo(p.x, p.y); ctxCon.lineTo(t.x, t.y); ctxCon.stroke();
            });
          });
        }
        requestAnimationFrame(animateCon);
      }
      animateCon();
    }

    // ‚îÄ‚îÄ Data Particles ‚îÄ‚îÄ
    const canvasData = document.getElementById('data-particles');
    const ctxData = canvasData.getContext('2d');
    canvasData.width = window.innerWidth; canvasData.height = window.innerHeight;
    const particles = [];
    for (let i = 0; i < (isMobile ? 15 : 30); i++) {
      particles.push({
        x: 0, y: 0, radius: Math.random() * 2 + 1,
        path: { centerX: Math.random() * canvasData.width, centerY: Math.random() * canvasData.height, radiusX: Math.random() * 100 + 50, radiusY: Math.random() * 100 + 50, angle: Math.random() * Math.PI * 2, speed: Math.random() * 0.01 + 0.005 },
        pulse: Math.random() * Math.PI * 2, pulseSpeed: Math.random() * 0.02 + 0.01
      });
    }
    function animateParticles() {
      ctxData.clearRect(0, 0, canvasData.width, canvasData.height);
      particles.forEach(function(p) {
        p.path.angle += p.path.speed;
        p.x = p.path.centerX + Math.cos(p.path.angle) * p.path.radiusX;
        p.y = p.path.centerY + Math.sin(p.path.angle) * p.path.radiusY;
        p.pulse += p.pulseSpeed;
        const ps = 1 + Math.sin(p.pulse) * 0.5;
        if (isMobile) {
          ctxData.fillStyle = 'rgba(24,119,242,' + (0.6 * ps) + ')';
          ctxData.beginPath(); ctxData.arc(p.x, p.y, p.radius * ps, 0, Math.PI * 2); ctxData.fill();
        } else {
          const g = ctxData.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.radius * ps * 3);
          g.addColorStop(0, 'rgba(24,119,242,' + (0.8 * ps) + ')');
          g.addColorStop(0.5, 'rgba(0,212,255,' + (0.4 * ps) + ')');
          g.addColorStop(1, 'rgba(0,212,255,0)');
          ctxData.fillStyle = g;
          ctxData.beginPath(); ctxData.arc(p.x, p.y, p.radius * ps * 3, 0, Math.PI * 2); ctxData.fill();
        }
      });
      requestAnimationFrame(animateParticles);
    }
    animateParticles();

    // ‚îÄ‚îÄ Custom Cursor ‚îÄ‚îÄ
    const cursor = document.getElementById('custom-cursor');
    if (cursor && !isTouchDevice) {
      let mouseX = 0, mouseY = 0, cursorX = 0, cursorY = 0;
      let moving = false, hovering = false;
      document.body.style.cursor = 'none';
      document.addEventListener('mousemove', function(e) {
        mouseX = e.clientX; mouseY = e.clientY;
        if (!moving) { moving = true; cursor.style.opacity = '1'; }
      });
      document.addEventListener('mouseleave', function() { moving = false; cursor.style.opacity = '0'; });
      document.addEventListener('mousedown', function() {
        if (typeof gsap !== 'undefined') gsap.to(cursor, { scale: 0.85, duration: 0.15, ease: 'power2.out' });
      });
      document.addEventListener('mouseup', function() {
        if (typeof gsap !== 'undefined') gsap.to(cursor, { scale: hovering ? 1.2 : 1, duration: 0.2, ease: 'power2.out' });
      });
      function animateCursor() {
        if (moving) {
          cursorX += (mouseX - cursorX) * 0.15;
          cursorY += (mouseY - cursorY) * 0.15;
          cursor.style.left = cursorX + 'px';
          cursor.style.top = cursorY + 'px';
        }
        requestAnimationFrame(animateCursor);
      }
      animateCursor();
      document.querySelectorAll('a, button, input, textarea, select').forEach(function(el) {
        el.addEventListener('mouseenter', function() {
          hovering = true;
          if (typeof gsap !== 'undefined') gsap.to(cursor, { scale: 1.2, duration: 0.3, ease: 'back.out(1.7)' });
        });
        el.addEventListener('mouseleave', function() {
          hovering = false;
          if (typeof gsap !== 'undefined') gsap.to(cursor, { scale: 1, duration: 0.3, ease: 'power2.out' });
        });
      });
    }
  })();

  // ============================================================
  //  START
  // ============================================================
  init();
  </script>
</body>
</html>
